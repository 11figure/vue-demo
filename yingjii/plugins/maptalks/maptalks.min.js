(function(){function A(){var a=window.maptalks;c.noConflict=function(){window.maptalks=a;return this};window.maptalks=c}"0.15.0";var c={};c.node=(new Function("try { return this === global; } catch(e) { return false; }"))();c.node?c.Browser={canvas:!0}:function(){var a=navigator.userAgent.toLowerCase(),b=document.documentElement,d="ActiveXObject"in window,e=-1!==a.indexOf("webkit"),f=-1!==a.indexOf("phantom"),g=-1!==a.search("android [23]"),h=-1!==a.indexOf("chrome"),k=-1!==a.indexOf("gecko")&&!e&&
        !window.opera&&!d,l="undefined"!==typeof orientation||-1!==a.indexOf("mobile"),m=!window.PointerEvent&&window.MSPointerEvent,n=window.PointerEvent&&navigator.pointerEnabled||m,p=d&&"transition"in b.style,r="WebKitCSSMatrix"in window&&"m11"in new window.WebKitCSSMatrix&&!g,q="MozPerspective"in b.style,b="OTransition"in b.style,t=(p||r||q)&&!b&&!f,u=!f&&(n||"ontouchstart"in window||window.DocumentTouch&&document instanceof window.DocumentTouch);c.Browser={ie:d,ielt9:d&&!document.addEventListener,edge:"msLaunchUri"in
    navigator&&!("documentMode"in document),webkit:e,gecko:k,android:-1!==a.indexOf("android"),android23:g,chrome:h,safari:!h&&-1!==a.indexOf("safari"),phantomjs:f,ie3d:p,webkit3d:r,gecko3d:q,opera12:b,any3d:t,mobile:l,mobileWebkit:l&&e,mobileWebkit3d:l&&r,mobileOpera:l&&window.opera,mobileGecko:l&&k,touch:!!u,msPointer:!!m,pointer:!!n,retina:1<(window.devicePixelRatio||window.screen.deviceXDPI/window.screen.logicalXDPI),language:navigator.browserLanguage?navigator.browserLanguage:navigator.language,
        ie9:d&&9===document.documentMode,ie10:d&&10===document.documentMode,canvas:!!document.createElement("canvas").getContext}}();c.node||function(){for(var a=document.getElementsByTagName("head")[0],b=a.childNodes,d=null,e=0,f=b.length;e<f;e++)"meta"===b[e].nodeName.toLowerCase()&&"viewport"===(b[e].getAttribute?b[e].getAttribute("name"):null)&&(d=b[e]);c.Browser.mobile&&(null===d?(d=document.createElement("meta"),d.setAttribute("name","viewport"),d.setAttribute("content","user-scalable=no"),a.appendChild(d)):
    (b=d.getAttribute("content"),0>b.indexOf("user-scalable=no")&&d.setAttribute("content",b+",user-scalable=no")));c.Browser.ielt9&&(d=document.createElement("meta"),d.setAttribute("http-equiv","X-UA-Compatible"),d.setAttribute("content","IE=edge,chrome=1"),a.appendChild(d))}();c.internalLayerPrefix="_maptalks__internal_layer_";c.Util={uid:0,now:function(){return Date.now?Date.now():(new Date).getTime()},extend:function(a){for(var b=1;b<arguments.length;b++){var c=arguments[b],e;for(e in c)a[e]=c[e]}return a},
    setOptions:function(a,b){a.hasOwnProperty("options")||(a.options=a.options?c.Util.create(a.options):{});for(var d in b)a.options[d]=b[d];return a.options},isSVG:function(a){return 4<a.length&&".svg"===a.slice(-4)?1:"data:image/svg+xml"===a.slice(0,18)?2:0},loadImage:function(a,b){function d(b){b&&(console.error(b),console.error(b.stack));(b=a.onerror)&&b.call(a)}function e(b,c){if(b)d(b);else{var e=a.onload;e&&(a.onload=function(){e.call(a)});a.src=c}}if(!c.node)return a.src=b[0],this;var f=b[0],
        g=b[1],h=b[2];try{c.Util.isSVG(f)&&c.Util.convertSVG?c.Util.convertSVG(f,g,h,e):c.Util.isURL(f)?this._loadRemoteImage(a,f,e):this._loadLocalImage(a,f,e)}catch(k){d(k)}return this},_loadRemoteImage:function(a,b,c){a=0===b.indexOf("https://")?require("https"):require("http");b=require("url").parse(b);b.headers={Accept:"image/*,*/*;q=0.8","Accept-Encoding":"gzip, deflate","Cache-Control":"no-cache",Connection:"keep-alive",Host:b.host,Pragma:"no-cache","User-Agent":"Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/50.0.2661.94 Safari/537.36"};
        a.request(b,function(a){var b=[];a.on("data",function(a){b.push(a)});a.on("end",function(){c(null,Buffer.concat(b))})}).on("error",c).end()},_loadLocalImage:function(a,b,c){require("fs").readFile(b,c)},fixPNG:function(){},UID:function(){return c.Util.uid++},parseJSON:function(a){return a&&c.Util.isString(a)?JSON.parse(a):a},create:Object.create||function(){function a(){}return function(b){a.prototype=b;return new a}}(),bind:function(a,b){var c=Array.prototype.slice;if(a.bind)return a.bind.apply(a,
        c.call(arguments,1));var e=c.call(arguments,2);return function(){return a.apply(b,e.length?e.concat(c.call(arguments)):arguments)}},throttle:function(a,b,c){var e,f,g,h;h=function(){e=!1;f&&(g.apply(c,f),f=!1)};return g=function(){e?f=arguments:(a.apply(c,arguments),setTimeout(h,b),e=!0)}},executeWhen:function(a,b){var d=function(){b()?a():c.Util.requestAnimFrame(d)};d();return this},removeFromArray:function(a,b){for(var c=b.length-1;0<=c;c--)if(b[c]===a)return b.splice(c,1);return null},mapArrayRecursively:function(a,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  b,d){if(!this.isArray(a))return null;for(var e=[],f,g=0,h=a.length;g<h;g++)f=a[g],c.Util.isNil(f)?e.push(null):c.Util.isArray(f)?e.push(c.Util.mapArrayRecursively(f,b,d)):(f=d?b.call(d,f):b(f),e.push(f));return e},mapArray:function(a,b,d){if(!this.isArray(a))return null;for(var e=[],f,g=0,h=a.length;g<h;g++)f=a[g],c.Util.isNil(f)?e.push(null):(f=d?b.call(d,f):b(f),e.push(f));return e},indexOfArray:function(a,b){if(!c.Util.isArrayHasData(b))return-1;for(var d=0,e=b.length;d<e;d++)if(b[d]===a)return d;
        return-1},getValueOrDefault:function(a,b){return void 0===a?b:a},objEqual:function(a,b){return c.Util._objEqual(a,b)},objDeepEqual:function(a,b){return c.Util._objEqual(a,b,!0)},_objEqual:function(a,b,d){function e(a){if(Object.keys)return Object.keys(a);var b=[],c;for(c in a)Object.prototype.hasOwnProperty.call(a,c)&&b.push(c);return b}if(c.Util.isNil(a)||c.Util.isNil(b)||a.prototype!==b.prototype)return!1;var f,g,h;try{f=e(a),g=e(b)}catch(k){return!1}if(f.length!==g.length)return!1;for(h=f.length-
        1;0<=h;h--)if(f[h]!==g[h])return!1;if(d)for(h=f.length-1;0<=h;h--)if(d=f[h],!c.Util.objEqual(a[d],b[d]))return!1;return!0},round:function(a){return 0<a?.5+a<<0:a-.5<<0},isCoordinate:function(a){return a instanceof c.Coordinate?!0:!1},isNil:function(a){return null==a},isNumber:function(a){return"number"===typeof a&&!isNaN(a)},isObject:function(a){return"object"===typeof a&&!!a},isArrayHasData:function(a){return this.isArray(a)&&0<a.length},isArray:function(a){return a?Array.isArray?Array.isArray(a):
            "[object Array]"===Object.prototype.toString.call(a):!1},isString:function(a){return c.Util.isNil(a)?!1:"string"===typeof a||null!==a.constructor&&a.constructor===String},isFunction:function(a){return this.isNil(a)?!1:"function"===typeof a||null!==a.constructor&&a.constructor===Function},isURL:function(a){if(!a)return!1;a=a.slice(0,6);return"http:/"===a||"https:"===a?!0:!1},cssUrlReWithQuote:/^url\(([\'\"])(.+)\1\)$/i,cssUrlRe:/^url\(([^\'\"].*[^\'\"])\)$/i,isCssUrl:function(a){if(!c.Util.isString(a))return 0;
        var b=a.slice(0,6);return"http:/"===b||"https:"===b?3:c.Util.cssUrlRe.test(a)?1:c.Util.cssUrlReWithQuote.test(a)?2:0},extractCssUrl:function(a){var b=c.Util.isCssUrl(a);return 3===b?a:1===b?(a=c.Util.cssUrlRe.exec(a),a[1]):2===b?(a=c.Util.cssUrlReWithQuote.exec(a),a[2]):a},b64chrs:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",btoa:function(a){if("undefined"!==typeof window&&window.btoa)return window.btoa(a);a=String(a);for(var b,d,e=0,f=c.Util.b64chrs,g="";a.charAt(e|0)||(f=
        "=",e%1);g+=f.charAt(63&b>>8-e%1*8)){d=a.charCodeAt(e+=.75);if(255<d)throw Error("'btoa' failed: The string to be encoded contains characters outside of the Latin1 range.");b=b<<8|d}return g},globalEval:function(a){var b=document.createElement("script");b.text=a;document.head.appendChild(b).parentNode.removeChild(b)},globalScript:function(a){var b=document.createElement("script");b.type="text/javascript";b.src=a;document.head.appendChild(b)},lowerSymbolOpacity:function(a,b){function d(a,b){c.Util.isNil(a.opacity)?
        a.opacity=b:a.opacity*=b}var e;if(c.Util.isArray(a)){e=[];for(var f=0;f<a.length;f++){var g=c.Util.extend({},a[f]);d(g,b);e.push(g)}}else e=c.Util.extend({},a),d(e,b);return e},extendSymbol:function(a){var b=Array.prototype.slice.call(arguments,1);b&&b.length||(b=[{}]);if(c.Util.isArray(a)){var d,e,f,g,h,k,l=[];f=0;for(h=a.length;f<h;f++){d=a[f];e={};g=0;for(k=b.length;g<k;g++)c.Util.isArray(b[g])?c.Util.isNil(b[g][f])?c.Util.extend(e,d?d:{}):c.Util.extend(e,d,b[g][f]):c.Util.extend(e,d,b[g]?b[g]:
            {});l.push(e)}return l}d=[{},a];d.push.apply(d,b);return c.Util.extend.apply(c.Util,d)},computeDegree:function(a,b){return Math.atan2(b.y-a.y,b.x-a.x)},isGradient:function(a){return a&&a.colorStops},getGradientStamp:function(a){var b=[a.type];a.places&&b.push(a.places.join());if(a.colorStops){for(var c=[],e=a.colorStops.length-1;0<=e;e--)c.push(a.colorStops[e].join());b.push(c.join(","))}return b.join("_")},getSymbolStamp:function(a){var b=[];if(c.Util.isArray(a)){for(var d=0;d<a.length;d++)b.push(c.Util.getSymbolStamp(a[d]));
        return"[ "+b.join(" , ")+" ]"}for(d in a)a.hasOwnProperty(d)&&(c.Util.isFunction(a[d])||(c.Util.isGradient(a[d])?b.push(d+"="+c.Util.getGradientStamp(a[d])):b.push(d+"="+a[d])));return b.join(";")},getExternalResources:function(a,b){if(!a)return null;var d=a;c.Util.isArray(a)||(d=[a]);var e=[],f=c.Symbolizer.resourceProperties,g,h,k,l,m;for(g=d.length-1;0<=g;g--)if(a=d[g]){b&&(a=c.Util.convertResourceUrl(a));for(h=0;h<f.length;h++)if(l=a[f[h]],c.Util.isFunctionDefinition(l)&&(l=c.Util.getFunctionTypeResources(l)),
            l)for(c.Util.isArray(l)||(l=[l]),k=0;k<l.length;k++)"url("===l[k].slice(0,4)&&(l[k]=c.Util.extractCssUrl(l[k])),m=c.Symbolizer.resourceSizeProperties[h],e.push([l[k],a[m[0]],a[m[1]]]);if("path"===a.markerType&&a.markerPath)if(h=c.Util.isFunctionDefinition(a.markerWidth)?200:a.markerWidth,m=c.Util.isFunctionDefinition(a.markerHeight)?200:a.markerHeight,c.Util.isFunctionDefinition(a.markerPath)){l=c.Util.getFunctionTypeResources(a.markerPath);var n=a.markerPath;for(k=0;k<l.length;k++)a.markerPath=l[k],
        e.push([c.Geometry.getMarkerPathBase64(a),h,m]);a.markerPath=n}else e.push([c.Geometry.getMarkerPathBase64(a),h,m])}return e},convertResourceUrl:function(a){if(!a)return null;if(c.node)return a;for(var b=c.Symbolizer.resourceProperties,d,e=0,f=b.length;e<f;e++)(d=a[b[e]])&&(a[b[e]]=this._convertUrlToAbsolute(d));return a},_convertUrlToAbsolute:function(a){if(c.Util.isFunctionDefinition(a)){for(var b=a.stops,d=0;d<b.length;d++)b[d][1]=c.Util._convertUrlToAbsolute(b[d][1]);return a}"url("===a.slice(0,
        4)&&(a=c.Util.extractCssUrl(a));!c.Util.isURL(a)&&(5>=a.length||"data:"!==a.substring(0,5))&&(a=this._absolute(location.href,a));return a},_absolute:function(a,b){var c=a.split("/"),e=b.split("/");if(0===b.slice(0,1))return c.slice(0,3).join("/")+b;c.pop();for(var f=0;f<e.length;f++)"."!==e[f]&&(".."===e[f]?c.pop():c.push(e[f]));return c.join("/")},compileStyle:function(a){if(!c.Util.isArray(a))return c.Util.compileStyle([a]);for(var b=[],d=0;d<a.length;d++)!0===a[d].filter?b.push({filter:function(){return!0},
            symbol:a[d].symbol}):b.push({filter:c.Util.createFilter(a[d].filter),symbol:a[d].symbol});return b}};c.Util.GUID=c.Util.UID;(function(){function a(a){var b=+new Date,c=Math.max(0,16-(b-f));f=b+c;return setTimeout(a,c)}function b(a){return window["webkit"+a]||window["moz"+a]||window["ms"+a]}if(c.node)c.Util.requestAnimFrame=function(a){return setTimeout(a,16)},c.Util.cancelAnimFrame=clearTimeout;else{var d,e,f=0;"undefined"!=typeof window?(d=window.requestAnimationFrame||b("RequestAnimationFrame")||
        a,e=window.cancelAnimationFrame||b("CancelAnimationFrame")||b("CancelRequestAnimationFrame")||function(a){window.clearTimeout(a)}):(d=a,e=function(a){clearTimeout(a)});c.Util.requestAnimFrame=function(a){return d(a)};c.Util.cancelAnimFrame=function(a){a&&e(a)}}})();c.StringUtil={trim:function(a){return a.trim?a.trim():a.replace(/^\s+|\s+$/g,"")},splitWords:function(a){return c.StringUtil.trim(a).split(/\s+/)},stringLength:function(a,b){var d=c.DomUtil._getDomRuler("span");d.style.font=b;d.innerHTML=
    a;var e=new c.Size(d.clientWidth,d.clientHeight);c.DomUtil.removeDomNode(d);return e},splitContent:function(a,b,c){var e=Math.ceil(b/c);b=Math.floor(c/(b/a.length));c=[];for(var f=0;f<e;f++)f<e-1?c.push(a.substring(f*b,(f+1)*b)):c.push(a.substring(f*b));return c},replaceVariable:function(a,b){return c.Util.isObject(b)&&c.Util.isString(a)?a.replace(c.StringUtil._contentExpRe,function(a,e){var f=b[e];return c.Util.isNil(f)?a:f}):a},_contentExpRe:/\{([\w_]+)\}/g,splitTextToRow:function(a,b){var d=c.symbolizer.TextMarkerSymbolizer.getFont(b),
    e=b.textLineSpacing||0,f=c.StringUtil.stringLength(a,d),g=f.width,h=f.height,k=b.textWrapCharacter,l=b.textWrapWidth,m=[];if(!l||l>g)l=g;c.Util.isString(a)||(a+="");var n=0,p;if(k&&0<=a.indexOf(k))for(var r=a.split(k),q,t,u,g=0,k=r.length;g<k;g++)if(p=r[g],q=c.StringUtil.stringLength(p,d),t=q.width,t>l)for(q=c.StringUtil.splitContent(p,t,l),t=0,u=q.length;t<u;t++)p=c.StringUtil.stringLength(q[t],d),p.width>n&&(n=p.width),m.push({text:q[t],size:p});else q.width>n&&(n=q.width),m.push({text:p,size:q});
else if(g>l)for(l=c.StringUtil.splitContent(a,g,l),g=0;g<l.length;g++)p=c.StringUtil.stringLength(l[g],d),p.width>n&&(n=p.width),m.push({text:l[g],size:p});else f.width>n&&(n=f.width),m.push({text:a,size:f});d=m.length;e=new c.Size(n,h*d+e*(d-1));return{total:d,size:e,rows:m,rawSize:f}},getAlignPoint:function(a,b,d){var e=a.width;a=a.height;var f,g;"left"===b?f=-e:"middle"===b?f=-e/2:"right"===b&&(f=0);"top"===d?g=-a:"middle"===d?g=-a/2:"bottom"===d&&(g=0);return new c.Point(f,g)}};c.DomUtil={createEl:function(a,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    b){var d=document.createElement(a);b&&c.DomUtil.setClass(d,b);return d},createElOn:function(a,b,c){a=this.createEl(a);b&&this.setStyle(a,b);c&&c.appendChild(a);return a},removeDomNode:function(a){if(a)if(c.Browser.ielt9||c.Browser.ie9){var b=c.DomUtil.createEl("div");b.appendChild(a);b.innerHTML=""}else a.parentNode&&a.parentNode.removeChild(a)},addDomEvent:function(a,b,d,e){if(!a||!b||!d)return c.DomUtil;var f=function(b){b||(b=window.event);return d.call(e||a,b)};b=b.split(" ");for(var g=b.length-
    1;0<=g;g--){var h=b[g];h&&(a["Z__"+h]||(a["Z__"+h]=[]),0<=c.DomUtil.listensDomEvent(a,h,d)&&c.DomUtil.removeDomEvent(a,h,d),a["Z__"+h].push({callback:f,src:d}),"addEventListener"in a?("mousewheel"===h&&void 0!==document.mozHidden&&(h="DOMMouseScroll"),a.addEventListener(h,f,!1)):"attachEvent"in a&&a.attachEvent("on"+h,f))}return c.DomUtil},removeDomEvent:function(a,b,c){function e(b,c){"removeEventListener"in a?("mousewheel"===b&&void 0!==document.mozHidden&&(b="DOMMouseScroll"),a.removeEventListener(b,
        c,!1)):"detachEvent"in a&&a.detachEvent("on"+b,c)}if(!a||!b)return this;for(var f=b.split(" "),g=f.length-1;0<=g;g--)if(b=f[g]){if(!c&&a["Z__"+b]){c=a["Z__"+b];f=0;for(g=c.length;f<g;f++)e(c[f].callback);delete a["Z__"+b];break}var h=this.listensDomEvent(a,b,c);if(0>h)break;e(b,a["Z__"+b][h].callback);a["Z__"+b].splice(h,1)}return this},listensDomEvent:function(a,b,c){if(!a||!a["Z__"+b]||!c)return-1;a=a["Z__"+b];b=0;for(var e=a.length;b<e;b++)if(a[b].src===c)return b;return-1},preventDefault:function(a){a.preventDefault?
    a.preventDefault():a.returnValue=!1},stopPropagation:function(a){a.stopPropagation?a.stopPropagation():a.cancelBubble=!0;return this},preventSelection:function(a){a.onselectstart=function(){return!1};a.ondragstart=function(){return!1};a.setAttribute("unselectable","on");return this},offsetDom:function(a,b){if(!a)return null;c.Browser.any3d?c.DomUtil.setTransform(a,b):(a.style.left=b.x+"px",a.style.top=b.y+"px");return b},getPagePosition:function(a){var b=document.documentElement;a=a.getBoundingClientRect();
    return new c.Point(a.left+b.scrollLeft,a.top+b.scrollTop)},getEventContainerPoint:function(a,b){a||(a=window.event);var d=b.getBoundingClientRect();return new c.Point(a.clientX-d.left-b.clientLeft,a.clientY-d.top-b.clientTop)},setStyle:function(a,b){var c=a.style.cssText,e=c.length-1;0<=e&&c.indexOf(";",e)===e||(c+=";");a.style.cssText=c+b},removeStyle:function(a){a.style.cssText=""},addStyle:function(a,b,c){var e=a.style.cssText;b&&c&&(a.style.cssText=e+(b+":"+c+";"))},hasClass:function(a,b){if(void 0!==
    a.classList)return a.classList.contains(b);var d=c.DomUtil.getClass(a);return 0<d.length&&(new RegExp("(^|\\s)"+b+"(\\s|$)")).test(d)},addClass:function(a,b){if(void 0!==a.classList)for(var d=c.StringUtil.splitWords(b),e=0,f=d.length;e<f;e++)a.classList.add(d[e]);else c.DomUtil.hasClass(a,b)||(d=c.DomUtil.getClass(a),c.DomUtil.setClass(a,(d?d+" ":"")+b))},removeClass:function(a,b){void 0!==a.classList?a.classList.remove(b):c.DomUtil.setClass(a,c.StringUtil.trim((" "+c.DomUtil.getClass(a)+" ").replace(" "+
        b+" "," ")))},setClass:function(a,b){c.Util.isNil(a.className.baseVal)?a.className=b:a.className.baseVal=b},getClass:function(a){return c.Util.isNil(a.className.baseVal)?a.className:a.className.baseVal},setOpacity:function(a,b){"opacity"in a.style?a.style.opacity=b:"filter"in a.style&&c.DomUtil._setOpacityIE(a,b)},_setOpacityIE:function(a,b){var c=!1;try{c=a.filters.item("DXImageTransform.Microsoft.Alpha")}catch(e){if(1===b)return}b=Math.round(100*b);c?(c.Enabled=100!==b,c.Opacity=b):a.style.filter+=
        " progid:DXImageTransform.Microsoft.Alpha(opacity="+b+")"},copyCanvas:function(a){if(c.node)return null;var b=c.DomUtil.createEl("canvas");b.width=a.width;b.height=a.height;b.getContext("2d").drawImage(a,0,0);return b},testCanvasSize:function(){if(c.node)return function(){return!0};var a=null,b=null;return function(d){if(!a){var e=c.DomUtil.createEl("canvas");e.width=1;e.height=1;a=e.getContext("2d");b=a.createImageData(1,1);e=b.data;e[0]=42;e[1]=84;e[2]=126;e[3]=255}var e=a.canvas,f=d.width<=e.width&&
    d.height<=e.height;if(!f){e.width=d.width;e.height=d.height;e=d.width-1;d=d.height-1;a.putImageData(b,e,d);d=a.getImageData(e,d,1,1);e=!0;for(f=d.data.length-1;0<=f;f--)if(d.data[f]!==b.data[f]){e=!1;break}f=e}return f}}(),testProp:function(a){for(var b=document.documentElement.style,c=0;c<a.length;c++)if(a[c]in b)return a[c];return!1},setTransform:function(a,b,d){b=b||new c.Point(0,0);a.style[c.DomUtil.TRANSFORM]=(c.Browser.ie3d?"translate("+b.x+"px,"+b.y+"px)"+(d?" scale("+d+")":""):"translate3d("+
        b.x+"px,"+b.y+"px,0)")+(d?" scale("+d+")":"");return this},setTransformMatrix:function(a,b){a.style[c.DomUtil.TRANSFORM]=b.toCSS();return this},removeTransform:function(a){a.style[c.DomUtil.TRANSFORM]=null;return this},isHTML:function(a){return/<[a-z\][\s\S]*>/i.test(a)},measureDom:function(a,b){var d=c.DomUtil._getDomRuler(a);c.Util.isString(b)?d.innerHTML=b:d.appendChild(b);var e=new c.Size(d.clientWidth,d.clientHeight);c.DomUtil.removeDomNode(d);return e},_getDomRuler:function(a){a=document.createElement(a);
    a.style.cssText="position:absolute;left:-10000px;top:-10000px;";document.body.appendChild(a);return a}};c.DomUtil.on=c.DomUtil.addDomEvent;c.DomUtil.off=c.DomUtil.removeDomEvent;c.node||(c.DomUtil.TRANSFORM=c.DomUtil.testProp(["transform","WebkitTransform","OTransform","MozTransform","msTransform"]),c.DomUtil.TRANSFORMORIGIN=c.DomUtil.testProp(["transformOrigin","WebkitTransformOrigin","OTransformOrigin","MozTransformOrigin","msTransformOrigin"]),c.DomUtil.TRANSITION=c.DomUtil.testProp(["transition",
    "WebkitTransition","OTransition","MozTransition","msTransition"]),c.DomUtil.CSSFILTER=c.DomUtil.testProp(["filter","WebkitFilter","OFilter","MozFilter","msFilter"]));c.Eventable={on:function(a,b,d){if(!a||!b)return this;if(!c.Util.isString(a))return this._switch("on",a,b);this._eventMap||(this._eventMap={});a=a.toLowerCase().split(" ");var e;d||(d=this);for(var f,g,h=0,k=a.length;h<k;h++){e=a[h];f=this._eventMap[e];f||(f=[],this._eventMap[e]=f);g=f.length;if(0<g)for(e=0;e<g;e++)if(b===f[e].handler&&
    f[e].context===d)return this;f.push({handler:b,context:d})}return this},once:function(a,b,d){if(!c.Util.isString(a)){b={};for(var e in a)a.hasOwnProperty(e)&&(b[e]=this._wrapOnceHandler(e,a[e],d));return this._switch("on",b)}a=a.split(" ");e=0;for(var f=a.length;e<f;e++)this.on(a[e],this._wrapOnceHandler(a[e],b,d));return this},_wrapOnceHandler:function(a,b,c){var e=this,f=!1;return function h(){f||(f=!0,c?b.apply(c,arguments):b.apply(this,arguments),e.off(a,h,this))}},off:function(a,b,d){if(!a||
    !this._eventMap||!b)return this;if(!c.Util.isString(a))return this._switch("off",a,b);a=a.split(" ");var e;d||(d=this);for(var f,g=0,h=a.length;g<h;g++){e=a[g].toLowerCase();e=this._eventMap[e];if(!e)break;for(f=e.length-1;0<=f;f--)b===e[f].handler&&e[f].context===d&&e.splice(f,1)}return this},_switch:function(a,b,c){for(var e in b)if(b.hasOwnProperty(e))this[a](e,b[e],c);return this},_clearListeners:function(a){this._eventMap&&c.Util.isString(a)&&this._eventMap[a.toLowerCase()]&&(this._eventMap[a]=
    null)},_clearAllListeners:function(){this._eventMap=null},listens:function(a,b,d){if(!this._eventMap||!c.Util.isString(a))return 0;a=this._eventMap[a.toLowerCase()];if(!a||0===a.length)return 0;for(var e=0,f=0,g=a.length;f<g;f++)if(b){if(b===a[f].handler&&(c.Util.isNil(d)||a[f].context===d))return 1}else e++;return e},copyEventListeners:function(a){a=a._eventMap;if(!a)return this;var b,c,e,f;for(f in a)for(b=a[f],c=0,e=b.length;c<e;c++)this.on(f,b[c].handler,b[c].context);return this},fire:function(){return this._eventParent?
    this._eventParent.fire.apply(this._eventParent,arguments):this._fire.apply(this,arguments)},_setEventParent:function(a){this._eventParent=a;return this},_fire:function(a,b){if(!this._eventMap)return this;var d=this._eventMap[a.toLowerCase()];if(!d)return this;b||(b={});b.type=a;b.target=this;for(var d=d.slice(0),e,f,g=0,h=d.length;g<h;g++)d[g]&&(e=d[g].context,f=c.Util.extend({},b),e=e?d[g].handler.call(e,f):d[g].handler(f),!1===e&&b.domEvent&&c.DomUtil.stopPropagation(b.domEvent));return this}};
    c.Eventable.addEventListener=c.Eventable.on;c.Eventable.removeEventListener=c.Eventable.off;c.Class=function(){};c.Class.extend=function(a){var b=function(){var a=this;this instanceof b||(a=c.Util.create(b.prototype));a.initialize&&a.initialize.apply(a,arguments);a._initHooks&&a.callInitHooks();return a},d=b.__super__=this.prototype,e=c.Util.create(d);e.constructor=b;b.prototype=e;for(var f in this)"_"===f[0]||!this.hasOwnProperty(f)||"prototype"===f||this[f]instanceof c.Class||(b[f]=this[f]);a.statics&&
    (c.Util.extend(b,a.statics),delete a.statics);a.includes&&(c.Util.extend.apply(null,[e].concat(a.includes)),delete a.includes);e.options&&(a.options=c.Util.extend(c.Util.create(e.options),a.options));c.Util.extend(e,a);e._initHooks=[];e.callInitHooks=function(){if(!this._initHooksCalled){d.callInitHooks&&d.callInitHooks.call(this);this._initHooksCalled=!0;for(var a=0,b=e._initHooks.length;a<b;a++)e._initHooks[a].call(this)}};e.config=function(a){if(a){if(2===arguments.length){var b={};b[a]=arguments[1];
        a=b}for(var d in a)a.hasOwnProperty(d)&&(this.options[d]=a[d],this[d]&&this[d]instanceof c.Handler&&(a[d]?this[d].enable():this[d].disable()));if(this.onConfig)this.onConfig(a)}else{d={};for(b in this.options)this.options.hasOwnProperty(b)&&(d[b]=this.options[b]);return d}return this};return b};c.Class.include=function(){for(var a=arguments,b=0,d=a.length;b<d;b++)c.Util.extend(this.prototype,a[b]);return this};c.Class.mergeOptions=function(a){c.Util.extend(this.prototype.options,a);return this};c.Class.addInitHook=
        function(a){var b=Array.prototype.slice.call(arguments,1);this.prototype._initHooks=this.prototype._initHooks||[];this.prototype._initHooks.push("function"===typeof a?a:function(){this[a].apply(this,b)});return this};c.Matrix=function(a){this._t=this.transform;this.a=this.d=1;this.b=this.c=this.e=this.f=0;(this.context=a)&&a.setTransform(1,0,0,1,0,0)};var y=c.Matrix;c.Matrix.prototype={concat:function(a){return this.clone()._t(a.a,a.b,a.c,a.d,a.e,a.f)},flipX:function(){return this._t(-1,0,0,1,0,0)},
        flipY:function(){return this._t(1,0,0,-1,0,0)},reflectVector:function(a,b){var c=this.applyToPoint(0,1),e=2*(c.x*a+c.y*b);a-=e*c.x;b-=e*c.y;return{x:a,y:b}},reset:function(){return this.setTransform(1,0,0,1,0,0)},rotate:function(a){var b=Math.cos(a);a=Math.sin(a);return this._t(b,a,-a,b,0,0)},rotateFromVector:function(a,b){return this.rotate(Math.atan2(b,a))},rotateDeg:function(a){return this.rotate(a*Math.PI/180)},scaleU:function(a){return 1===a?this:this._t(a,0,0,a,0,0)},scale:function(a,b){return this._t(a,
            0,0,b,0,0)},scaleX:function(a){return this._t(a,0,0,1,0,0)},scaleY:function(a){return this._t(1,0,0,a,0,0)},shear:function(a,b){return this._t(1,b,a,1,0,0)},shearX:function(a){return this._t(1,0,a,1,0,0)},shearY:function(a){return this._t(1,a,0,1,0,0)},skew:function(a,b){return this.shear(Math.tan(a),Math.tan(b))},skewX:function(a){return this.shearX(Math.tan(a))},skewY:function(a){return this.shearY(Math.tan(a))},setTransform:function(a,b,c,e,f,g){this.a=a;this.b=b;this.c=c;this.d=e;this.e=f;this.f=
            g;return this._x()},translate:function(a,b){return this._t(1,0,0,1,a,b)},translateX:function(a){return this._t(1,0,0,1,a,0)},translateY:function(a){return this._t(1,0,0,1,0,a)},transform:function(a,b,c,e,f,g){var h=this.a,k=this.b,l=this.c,m=this.d,n=this.e,p=this.f;this.a=h*a+l*b;this.b=k*a+m*b;this.c=h*c+l*e;this.d=k*c+m*e;this.e=h*f+l*g+n;this.f=k*f+m*g+p;return this._x()},divide:function(a){if(!a.isInvertible())throw"Input matrix is not invertible";a=a.inverse();return this._t(a.a,a.b,a.c,a.d,
            a.e,a.f)},divideScalar:function(a){this.a/=a;this.b/=a;this.c/=a;this.d/=a;this.e/=a;this.f/=a;return this._x()},inverse:function(){if(this.isIdentity())return new y;if(this.isInvertible()){var a=this.a,b=this.b,c=this.c,e=this.d,f=this.e,g=this.f,h=new y,k=a*e-b*c;h.a=e/k;h.b=-b/k;h.c=-c/k;h.d=a/k;h.e=(c*g-e*f)/k;h.f=-(a*g-b*f)/k;return h}throw"Matrix is not invertible.";},interpolate:function(a,b,c){c=c?new y(c):new y;c.a=this.a+(a.a-this.a)*b;c.b=this.b+(a.b-this.b)*b;c.c=this.c+(a.c-this.c)*b;
            c.d=this.d+(a.d-this.d)*b;c.e=this.e+(a.e-this.e)*b;c.f=this.f+(a.f-this.f)*b;return c._x()},interpolateAnim:function(a,b,c){c=c?new y(c):new y;var e=this.decompose();a=a.decompose();var f=e.rotation+(a.rotation-e.rotation)*b,g=e.scale.x+(a.scale.x-e.scale.x)*b,h=e.scale.y+(a.scale.y-e.scale.y)*b;c.translate(e.translate.x+(a.translate.x-e.translate.x)*b,e.translate.y+(a.translate.y-e.translate.y)*b);c.rotate(f);c.scale(g,h);return c._x()},decompose:function(a){var b=this.a,c=this.b,e=this.c,f=this.d,
            g=Math.acos,h=Math.atan,k=Math.sqrt,l=Math.PI,m={x:this.e,y:this.f},n=0,p={x:1,y:1},r={x:0,y:0},p=b*f-c*e;a?b?(r={x:h(e/b),y:h(c/b)},p={x:b,y:p/b}):c?(n=.5*l,p={x:c,y:p/c},r.x=h(f/c)):(p={x:e,y:f},r.x=.25*l):b||c?(l=k(b*b+c*c),n=0<c?g(b/l):-g(b/l),p={x:l,y:p/l},r.x=h((b*e+c*f)/(l*l))):e||f?(a=k(e*e+f*f),n=.5*l-(0<f?g(-e/a):-g(e/a)),p={x:p/a,y:a},r.y=h((b*e+c*f)/(a*a))):p={x:0,y:0};return{scale:p,translate:m,rotation:n,skew:r}},determinant:function(){return this.a*this.d-this.b*this.c},applyToPoint:function(a,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            b){return{x:a*this.a+b*this.c+this.e,y:a*this.b+b*this.d+this.f}},applyToPointInstance:function(a){a=this.applyToPoint(a.x,a.y);return new c.Point(a)},applyToArray:function(a){var b=0,d,e,f=[];if("number"===typeof a[0])for(e=a.length;b<e;)d=this.applyToPoint(a[b++],a[b++]),f.push(d.x,d.y);else for(;d=a[b];b++)f.push(new c.Point(this.applyToPoint(d.x,d.y)));return f},applyToTypedArray:function(a,b){for(var c=0,e,f=a.length,g=b?new Float64Array(f):new Float32Array(f);c<f;)e=this.applyToPoint(a[c],a[c+
        1]),g[c++]=e.x,g[c++]=e.y;return g},applyToContext:function(a){a.setTransform(this.a,this.b,this.c,this.d,this.e,this.f);return this},isIdentity:function(){return this._q(this.a,1)&&this._q(this.b,0)&&this._q(this.c,0)&&this._q(this.d,1)&&this._q(this.e,0)&&this._q(this.f,0)},isInvertible:function(){return!this._q(this.determinant(),0)},isValid:function(){return!this._q(this.a*this.d,0)},clone:function(a){var b=new y;b.a=this.a;b.b=this.b;b.c=this.c;b.d=this.d;b.e=this.e;b.f=this.f;a||(b.context=
            this.context);return b},isEqual:function(a){if(!a)return!1;var b=this._q;return b(this.a,a.a)&&b(this.b,a.b)&&b(this.c,a.c)&&b(this.d,a.d)&&b(this.e,a.e)&&b(this.f,a.f)},toArray:function(){return[this.a,this.b,this.c,this.d,this.e,this.f]},toCSS:function(){return"matrix("+this.toArray()+")"},toJSON:function(){return'{"a":'+this.a+',"b":'+this.b+',"c":'+this.c+',"d":'+this.d+',"e":'+this.e+',"f":'+this.f+"}"},toString:function(){return""+this.toArray()},_q:function(a,b){return 1E-14>Math.abs(a-b)},
        _x:function(){this.context&&this.context.setTransform(this.a,this.b,this.c,this.d,this.e,this.f);return this}};c.Matrix.prototype.multi=function(a){var b=this.clone();b.a=this.a*a;b.b=this.b*a;b.c=this.c*a;b.d=this.d*a;b.e=this.e*a;b.f=this.f*a;return b};c.animation={};c.Animation={speed:{slow:2E3,normal:1E3,fast:500},_resolveStyles:function(a){function b(a){if(!c.Util.isArray(a))return c.Animation._resolveStyles(a);for(var b=[],d=[],e=[],f=0;f<a.length;f++){var g=c.Animation._resolveStyles(a[f]);
        g&&(b.push(g[0]),d.push(g[1]),e.push(g[2]))}return 0===b.length?null:[b,d,e]}function d(a){var b=a;c.Util.isArray(a)||(c.Util.isNumber(a)?b=[0,a]:a instanceof c.Point||a instanceof c.Coordinate?(b=a.constructor,b=[new b(0,0),a]):b=[a,a]);a=b[0];var d=b[1];return c.Util.isNumber(a)&&c.Util.isNumber(d)?a===d?null:[a,d-a,d]:c.Util.isArray(a)||a instanceof c.Coordinate||a instanceof c.Point?(c.Util.isArray(a)?(a=new c.Coordinate(a),d=new c.Coordinate(d)):(b=a.constructor,a=new b(a),d=new b(d)),a.equals(d)?
                null:[a,d.substract(a),d]):[a,0,d]}function e(a){return!c.Util.isArray(a)&&a.constructor===Object||c.Util.isArray(a)&&a[0].constructor===Object?!0:!1}if(!a)return null;var f={},g={},h={},k;for(k in a)if(a.hasOwnProperty(k)){var l=a[k];if(l=e(l)?b(l):d(l))g[k]=l[0],f[k]=l[1],h[k]=l[2]}return[g,f,h]},framing:function(a,b){b||(b={});var d=b.easing?c.animation.Easing[b.easing]:c.animation.Easing.linear;d||(d=c.animation.Easing.linear);var e,f,g;if(a=c.Animation._resolveStyles(a))f=a[0],e=a[1],g=a[2];
        var h=function(a,b,d){if(!b||!d)return null;var e={},f;for(f in d)if(d.hasOwnProperty(f))if(b[f]===g[f])e[f]=b[f];else{var r=b[f],q=d[f];if(c.Util.isNumber(q))e[f]=r+a*q;else if(c.Util.isArray(q)){for(var t=[],u=0;u<q.length;u++)t.push(h(a,r[u],q[u]));e[f]=t}else if(q.constructor===Object)e[f]=h(a,r,q);else if(r instanceof c.Point||r instanceof c.Coordinate)e[f]=r.add(q.multi(a))}return e};return function(a,b){var m,n;0>a?(m={playState:"idle",delta:0},n=f):a<b?(n=d(a/b),m={playState:"running",delta:n},
                    n=h(n,f,e)):(m={playState:"finished",delta:1},n=g);m.startStyles=f;m.destStyles=g;return new c.animation.Frame(m,n)}},_requestAnimFrame:function(a){this._frameQueue||(this._frameQueue=[]);this._frameQueue.push(a);this._a()},_a:function(){this._animationFrameId||(this._animationFrameId=c.Util.requestAnimFrame(c.Util.bind(c.Animation._run,c.Animation)))},_run:function(){if(this._frameQueue.length){var a=this._frameQueue;this._frameQueue=[];for(var b=0,d=a.length;b<d;b++)a[b]();this._frameQueue.length?
        this._animationFrameId=c.Util.requestAnimFrame(c.Util.bind(c.Animation._run,c.Animation)):delete this._animationFrameId}},animate:function(a,b,d){b||(b={});a=c.Animation.framing(a,b);return new c.animation.Player(a,b,d)}};c.animation.Player=function(a,b,c){this._animation=a;this._options=b;this._stepFn=c;this.playState="idle";this.ready=!0;this.finished=!1};c.Util.extend(c.animation.Player.prototype,{_prepare:function(){var a=this._options.speed;c.Util.isString(a)&&(a=c.Animation.speed[a]);a||(a=
        c.Animation.speed.normal);this.duration=a},play:function(){if("idle"!==this.playState&&"paused"!==this.playState)return this;"idle"===this.playState&&(this.currentTime=0,this._prepare());var a=c.Util.now();if(!this.startTime){var b=this._options;this.startTime=b.startTime?b.startTime:a}this._playStartTime=Math.max(a,this.startTime);"paused"===this.playState&&(this._playStartTime-=this.currentTime);this.playState="running";this._run();return this},pause:function(){this.playState="paused";return this},
        cancel:function(){this.playState="idle";this.finished=!1;return this},finish:function(){this.playState="finished";this.finished=!0;return this},reverse:function(){},_run:function(){if("finished"!==this.playState&&"paused"!==this.playState){var a=this,b=c.Util.now(),d=b-this._playStartTime;this._options.repeat&&d>=this.duration&&(this._playStartTime=b,d=0);var e=this._animation(d,this.duration);this.playState=e.state.playState;var f=this._stepFn;"idle"===this.playState?setTimeout(c.Util.bind(this._run,
                this),this.startTime-b):"running"===this.playState?this._animeFrameId=c.Animation._requestAnimFrame(function(){"running"===a.playState&&(a.currentTime=b-a._playStartTime,f&&f(e),a._run())}):"finished"===this.playState&&(this.finished=!0,f&&c.Util.requestAnimFrame(function(){f(e)}))}}});c.animation.Easing={in:function(a){return Math.pow(a,2)},out:function(a){return 1-c.animation.Easing.in(1-a)},inAndOut:function(a){return 3*a*a-2*a*a*a},linear:function(a){return a},upAndDown:function(a){return.5>a?
        c.animation.Easing.inAndOut(2*a):1-c.animation.Easing.inAndOut(2*(a-.5))}};c.animation.Frame=function(a,b){this.state=a;this.styles=b};c.Canvas={createCanvas:function(a,b,d){c.node?d=new d(a,b):(d=c.DomUtil.createEl("canvas"),d.width=a,d.height=b);return d},setDefaultCanvasSetting:function(a){a.lineWidth=1;a.lineCap="butt";a.lineJoin="miter";a.strokeStyle="rgba(0,0,0,1)";a.fillStyle="rgba(255,255,255,0)";a.textAlign="start";a.textBaseline="top";a.font="11px monospace";a.shadowBlur=null;a.shadowColor=
        null;a.setLineDash&&a.setLineDash([]);a.globalAlpha=1},prepareCanvasFont:function(a,b){a.textBaseline="top";a.font=c.symbolizer.TextMarkerSymbolizer.getFont(b);var d=b.textFill;d||(d=c.Symbolizer.DEFAULT_TEXT_COLOR);a.fillStyle=c.Canvas.getRgba(d,b.textOpacity)},prepareCanvas:function(a,b,d){if(b){var e=b.lineWidth;c.Util.isNil(e)||a.lineWidth===e||(a.lineWidth=e);var f=b.linePatternFile||b.lineColor||c.Symbolizer.DEFAULT_STROKE_COLOR;c.Util.isCssUrl(f)&&d?(c.Canvas._setStrokePattern(a,f,e,d),b.lineDasharray=
            []):c.Util.isGradient(f)?a.strokeStyle=b.lineGradientExtent?c.Canvas._createGradient(a,f,b.lineGradientExtent):"rgba(0,0,0,1)":a.strokeStyle=f;b.lineJoin&&(a.lineJoin=b.lineJoin);b.lineCap&&(a.lineCap=b.lineCap);a.setLineDash&&c.Util.isArrayHasData(b.lineDasharray)&&a.setLineDash(b.lineDasharray);f=b.polygonPatternFile||b.polygonFill||c.Symbolizer.DEFAULT_FILL_COLOR;if(c.Util.isCssUrl(f)){b=c.Util.extractCssUrl(f);(f=d.getImage([b,null,null]))||(f=d.getImage([b+"-texture",null,e]));if(c.Util.isSVG(b)&&
        f instanceof Image&&(c.Browser.edge||c.Browser.ie)){d=f.width||20;var e=f.height||20,g=c.Canvas.createCanvas(d,e);c.Canvas.image(g.getContext("2d"),f,0,0,d,e);f=g}f?a.fillStyle=a.createPattern(f,"repeat"):!c.Browser.phantomjs&&console&&console.warn("img not found for",b)}else c.Util.isGradient(f)?a.fillStyle=b.polygonGradientExtent?c.Canvas._createGradient(a,f,b.polygonGradientExtent):"rgba(255,255,255,0)":a.fillStyle=f}},_createGradient:function(a,b,c){var e=null,f=b.places,g=c.getMin(),h=c.getMax(),
        k=c.getWidth(),l=c.getHeight();if(!b.type||"linear"===b.type){if(f){if(4!==f.length)throw Error("A linear gradient's places should have 4 numbers.");f=[g.x+f[0]*k,g.y+f[1]*l,g.x+f[2]*k,g.y+f[3]*l]}else f=[g.x,g.y,h.x,g.y];e=a.createLinearGradient.apply(a,f)}else if("radial"===b.type){if(f){if(6!==f.length)throw Error("A radial gradient's places should have 6 numbers.");f=[g.x+f[0]*k,g.y+f[1]*l,k*f[2],g.x+f[3]*k,g.y+f[4]*l,k*f[5]]}else c=c.getCenter()._round(),f=[c.x,c.y,Math.abs(c.x-g.x),c.x,c.y,
        0];e=a.createRadialGradient.apply(a,f)}b.colorStops.forEach(function(a){e.addColorStop.apply(e,a)});return e},_setStrokePattern:function(a,b,d,e){b=c.Util.extractCssUrl(b);var f;if(c.node)f=e.getImage([b,null,d]);else{var g=b+"-texture-"+d;f=e.getImage(g);if(!f){var h=e.getImage([b,null,null]);if(h){f=h.width&&h.height?c.Util.round(h.width*d/h.height):d;var k=c.Canvas.createCanvas(f,d,a.canvas.constructor);c.Canvas.image(k.getContext("2d"),h,0,0,f,d);e.addResource([g,null,d],k);f=k}}}f?a.strokeStyle=
            a.createPattern(f,"repeat"):!c.Browser.phantomjs&&console&&console.warn("img not found for",b)},clearRect:function(a,b,c,e,f){a.clearRect(b,c,e,f)},fillCanvas:function(a,b,d,e){if(0!==b){var f=c.Canvas._isPattern(a.fillStyle);c.Util.isNil(b)&&(b=1);var g;1>b&&(g=a.globalAlpha,a.globalAlpha*=b);f&&a.translate(d,e);a.fill();f&&a.translate(-d,-e);1>b&&(a.globalAlpha=g)}},getRgba:function(a,b){c.Util.isNil(b)&&(b=1);if("#"!==a[0])return a;var d,e,f;7===a.length?(d=parseInt(a.substring(1,3),16),e=parseInt(a.substring(3,
            5),16),f=parseInt(a.substring(5,7),16)):(d=17*parseInt(a.substring(1,2),16),e=17*parseInt(a.substring(2,3),16),f=17*parseInt(a.substring(3,4),16));return"rgba("+d+","+e+","+f+","+b+")"},image:function(a,b,d,e,f,g){try{c.Util.isNumber(f)&&c.Util.isNumber(g)?a.drawImage(b,d,e,f,g):a.drawImage(b,d,e)}catch(h){console&&(console.warn("error when drawing image on canvas:",h),console.warn(b))}},text:function(a,b,d,e,f){c.Canvas._textOnMultiRow(a,f.rows,e,d,f.size,f.rawSize)},_textOnMultiRow:function(a,b,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              d,e,f,g){f=c.StringUtil.getAlignPoint(f,d.textHorizontalAlignment,d.textVerticalAlignment);g=g.height+d.textLineSpacing;e=e.add(0,f.y);for(var h,k=0,l=b.length;k<l;k++)f=b[k].text,h=c.StringUtil.getAlignPoint(b[k].size,d.textHorizontalAlignment,d.textVerticalAlignment),c.Canvas._textOnLine(a,f,e.add(h.x,k*g),d.textHaloRadius,d.textHaloFill,d.textHaloOpacity)},_textOnLine:function(a,b,c,e,f,g){a.textBaseline="top";if(0!==g&&0!==e){if(g){var h=a.globalAlpha;a.globalAlpha*=g}e&&(a.miterLimit=2,a.lineJoin=
        "round",a.lineCap="round",a.lineWidth=2*e-1,a.strokeStyle=f,a.strokeText(b,c.x,c.y),a.lineWidth=1,a.miterLimit=10);g&&(a.globalAlpha=h)}a.fillText(b,c.x,c.y)},fillText:function(a,b,c,e){e&&(a.fillStyle=e);a.fillText(b,c.x,c.y)},_stroke:function(a,b,d,e){var f=c.Canvas._isPattern(a.strokeStyle)&&!c.Util.isNil(d)&&!c.Util.isNil(e);c.Util.isNil(b)&&(b=1);var g;1>b&&(g=a.globalAlpha,a.globalAlpha*=b);f&&a.translate(d,e);a.stroke();f&&a.translate(-d,-e);1>b&&(a.globalAlpha=g)},_path:function(a,b,d,e,f){function g(b,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          d){var f=c.Util.computeDegree(b,d);a.save();a.translate(b.x,b.y-a.lineWidth/2/Math.cos(f));a.rotate(f);c.Canvas._stroke(a,e);a.restore()}function h(b,c,d){var e=b.x;b=b.y;var f=c.x;c=c.y;var g=function(a,b){return a<=b},h=function(a,b){return a>=b},k=function(a,b){return Math.min(a,b)},l=function(a,b){return Math.max(a,b)},m={thereYet:h,cap:k},h={thereYet:h,cap:k};0<b-c&&(h.thereYet=g,h.cap=l);0<e-f&&(m.thereYet=g,m.cap=l);a.moveTo(e,b);for(var g=e,l=b,k=0,p=!0,n,x;!m.thereYet(g,f)||!h.thereYet(l,
        c);)n=Math.atan2(c-b,f-e),x=d[k],g=m.cap(f,g+Math.cos(n)*x),l=h.cap(c,l+Math.sin(n)*x),p?a.lineTo(g,l):a.moveTo(g,l),k=(k+1)%d.length,p=!p}if(c.Util.isArrayHasData(b)){var k=c.Util.isArrayHasData(d);f=!0===f?!1:c.Canvas._isPattern(a.strokeStyle);for(var l,m,n=0,p=b.length;n<p;n++)if(l=b[n],!k||a.setLineDash)a.lineTo(l.x,l.y),f&&0<n&&(m=b[n-1],g(m,l),a.beginPath(),a.moveTo(l.x,l.y));else if(k){if(n===p-1)break;m=b[n+1];h(l,m,d,f)}}},path:function(a,b,d,e,f){a.beginPath();a.moveTo(b[0].x,b[0].y);c.Canvas._path(a,
        b,f,d);c.Canvas._stroke(a,d)},polygon:function(a,b,d,e,f){var g=c.Canvas._isPattern(a.strokeStyle),g=c.Util.isArrayHasData(f)&&!a.setLineDash||g;c.Util.isArrayHasData(b[0])||(b=[b]);var h,k,l;if(g){a.save();k=0;for(l=b.length;k<l;k++)c.Canvas._ring(a,b[k],null,0,!0),h=e,0<k&&(a.globalCompositeOperation="destination-out",h=1),c.Canvas.fillCanvas(a,h,b[k][0].x,b[k][0].y),0<k?a.globalCompositeOperation="source-over":a.fillStyle="#fff",c.Canvas._stroke(a,0);a.restore()}k=0;for(l=b.length;k<l;k++)c.Canvas._ring(a,
        b[k],f,d),g||(h=e,0<k&&(a.globalCompositeOperation="destination-out",h=1),c.Canvas.fillCanvas(a,h,b[k][0].x,b[k][0].y),0<k?a.globalCompositeOperation="source-over":a.fillStyle="#fff"),c.Canvas._stroke(a,d)},_ring:function(a,b,d,e,f){var g=!0===f?!1:c.Canvas._isPattern(a.strokeStyle);g&&!b[0].equals(b[b.length-1])&&(b=b.concat([b[0]]));a.beginPath();a.moveTo(b[0].x,b[0].y);c.Canvas._path(a,b,d,e,f);g||a.closePath()},_arcBetween:function(a,b,c,e){var f=b.distanceTo(c),g=f/2/Math.sin(e/2),f=Math.asin((c.y-
        b.y)/f);b.x>c.x&&(f=Math.PI-f);var h=f-(90*Math.PI/180-e/2),f=b.x+Math.cos(h)*g;b=b.y+Math.sin(h)*g;h=Math.asin((c.y-b)/g);f>c.x&&(h=Math.PI-h);c=h+e;a.beginPath();a.arc(f,b,g,h,c)},_lineTo:function(a,b){a.lineTo(b.x,b.y)},bezierCurveAndFill:function(a,b,d,e){a.beginPath();var f=b[0];a.moveTo(f.x,f.y);c.Canvas._bezierCurveTo.apply(c.Canvas,[a].concat(b.splice(1)));c.Canvas.fillCanvas(a,e);c.Canvas._stroke(a,d)},_bezierCurveTo:function(a,b,c,e){a.bezierCurveTo(b.x,b.y,c.x,c.y,e.x,e.y)},ellipse:function(a,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   b,d,e,f,g){if(d===e)a.beginPath(),a.arc(b.x,b.y,d,0,2*Math.PI);else{var h=b.x,k=b.y,l=.5522848*d,m=.5522848*e;a.beginPath();a.moveTo(h-d,k);a.bezierCurveTo(h-d,k-m,h-l,k-e,h,k-e);a.bezierCurveTo(h+l,k-e,h+d,k-m,h+d,k);a.bezierCurveTo(h+d,k+m,h+l,k+e,h,k+e);a.bezierCurveTo(h-l,k+e,h-d,k+m,h-d,k);a.closePath()}c.Canvas.fillCanvas(a,g,b.x-d,b.y-e);c.Canvas._stroke(a,f,b.x-d,b.y-e)},rectangle:function(a,b,d,e,f){a.beginPath();a.rect(b.x,b.y,d.width,d.height);c.Canvas.fillCanvas(a,f,b.x,b.y);c.Canvas._stroke(a,
        e,b.x,b.y)},sector:function(a,b,d,e,f,g){var h=b.x;b=b.y;var k=Math.PI/180,l=k*-e[1];e=k*-e[0];a.beginPath();a.moveTo(h,b);a.arc(h,b,d,l,e);a.lineTo(h,b);c.Canvas.fillCanvas(a,g,h-d,b-d);c.Canvas._stroke(a,f,h-d,b-d)},_isPattern:function(a){return!c.Util.isString(a)&&!("addColorStop"in a)},quadraticCurve:function(a,b){if(b&&!(2>=b.length)){a.lineTo((b[0].x+b[1].x)/2,(b[0].y+b[1].y)/2);var d=c.Canvas._getQuadCurvePoints(b),e,f=d.length;for(e=0;e<f;e+=4)a.quadraticCurveTo(d[e],d[e+1],d[e+2],d[e+3]);
        a.lineTo(b[b.length-1].x,b[b.length-1].y)}},_getQuadCurvePoints:function(a){var b=[],c,e=a.length,f,g;for(c=1;c<e-1;c++)f=(a[c].x+a[c+1].x)/2,g=(a[c].y+a[c+1].y)/2,b.push(a[c].x,a[c].y,f,g);return b}};(function(){var a;if(c.node){var b=require("url"),d=require("http"),e=require("https");a={get:function(a,c){var d=b.parse(a);this._getClient(d.protocol).get(a,this._wrapCallback(c)).on("error",c);return this},post:function(a,d,e){var k=b.parse(a.url);k.method="POST";a.headers||(a.headers={});a.headers["Content-Type"]||
    (a.headers["Content-Type"]="application/x-www-form-urlencoded");k.headers=a.headers;a=this._getClient(k.protocol).request(k,this._wrapCallback(e));a.on("error",e);c.Util.isString(d)||(d=JSON.stringify(d));a.write(d);a.end();return this},_wrapCallback:function(a){return function(b){var c=[],d=!1;b.setEncoding("utf8");b.on("data",function(a){a instanceof Buffer&&(d=!0);c.push(a)});b.on("end",function(){a(null,d?Buffer.concat(c).toString("utf8"):c.join(""))})}},_getClient:function(a){this._client||(this._client=
        a&&"https:"===a?e:d);return this._client}}}else a={get:function(a,b){var c=this._getClient(b);c.open("GET",a,!0);c.send(null);return this},post:function(a,b,d){d=this._getClient(d);d.open("POST",a.url,!0);a.headers||(a.headers={});a.headers["Content-Type"]||(a.headers["Content-Type"]="application/x-www-form-urlencoded");if("setRequestHeader"in d)for(var e in a.headers)a.headers.hasOwnProperty(e)&&d.setRequestHeader(e,a.headers[e]);c.Util.isString(b)||(b=JSON.stringify(b));d.send(b);return this},_wrapCallback:function(a,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   b){var c=this;return function(){void 0!==a.withCredentials||c._isIE8()?b(null,a.responseText):4===a.readyState&&(200===a.status?b(null,a.responseText):0!==a.status&&b(null,'{"success":false,"error":"Status:'+a.status+","+a.statusText+'"}'))}},_isIE8:function(){return c.Browser.ie&&8===document.documentMode},_getClient:function(a){var b;if(this._isIE8())try{b=new XDomainRequest}catch(c){}try{b=new XMLHttpRequest}catch(c){}try{b=new ActiveXObject("Msxml2.XMLHTTP")}catch(c){}try{b=new ActiveXObject("Microsoft.XMLHTTP")}catch(c){}this._isIE8()||
    void 0!==b.withCredentials?b.onload=this._wrapCallback(b,a):b.onreadystatechange=this._wrapCallback(b,a);return b}};a.getResource=function(a,b){return this.get(a,b)};a.getJSON=function(b,d){return a.getResource(b,function(a,b){var e=b?c.Util.parseJSON(b):null;d(a,e)})};c.Util.getJSON=a.getJSON;c.Ajax=a})();(function(){function a(a){if(!a)return"true";var b=a[0];if(1>=a.length)return"any"===b?"false":"true";"=="===b?a=d(a[1],a[2],"===",!1):"!="===b?a=d(a[1],a[2],"!==",!1):"<"===b||">"===b||"<="===
            b||">="===b?a=d(a[1],a[2],b,!0):"any"===b?a=e(a.slice(1),"||"):"all"===b?a=e(a.slice(1),"&&"):"none"===b?a=g(e(a.slice(1),"||")):"in"===b?a=f(a[1],a.slice(2)):"!in"===b?a=g(f(a[1],a.slice(2))):"has"===b?a=JSON.stringify(a[1])+" in p":"!has"===b?(a=JSON.stringify([a[1]])+" in p",a=g(a)):a="true";return"("+a+")"}function b(a){return"$"===a[0]?"f."+a.substring(1):"p["+JSON.stringify(a)+"]"}function d(a,d,e,f){var g=b(a);a="$type"===a?c.Util.indexOfArray(d,k):JSON.stringify(d);return(f?"typeof "+g+"=== typeof "+
            a+"&&":"")+g+e+a}function e(b,d){return c.Util.mapArray(b,a).join(d)}function f(a,d){"$type"===a&&(d=c.Util.mapArray(d,function(a){return c.Util.indexOfArray(a,k)}));var e=JSON.stringify(d.sort(h)),f=b(a);return 200>=d.length?"maptalks.Util.indexOfArray("+f+", "+e+") !== -1":"function(v, a, i, j) {while (i <= j) { var m = (i + j) >> 1;    if (a[m] === v) return true; if (a[m] > v) j = m - 1; else i = m + 1;}return false; }("+f+", "+e+",0,"+(d.length-1)+")"}function g(a){return"!("+a+")"}function h(a,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   b){return a<b?-1:a>b?1:0}var k="Unknown Point LineString Polygon MultiPoint MultiLineString MultiPolygon GeometryCollection".split(" ");c.Util.createFilter=function(b){return new Function("f","var p = (f && f.properties || {}); return "+a(b))};c.Util.getFilterFeature=function(a){a=a._toJSON();var b=a.feature;b.type=c.Util.indexOfArray(b.geometry.type,k);b.subType=a.subType;return b}})();(function(){function a(c,f){var g;if(k(c)){var h="object"===typeof c.stops[0][0],r=h||void 0!==c.property,r=h||
        !r,q=c.type||f||"exponential",t;if("exponential"===q)t=e;else if("interval"===q)t=d;else if("categorical"===q)t=b;else throw Error('Unknown function type "'+q+'"');if(h){for(var h={},u=[],r=0;r<c.stops.length;r++)q=c.stops[r],void 0===h[q[0].zoom]&&(h[q[0].zoom]={zoom:q[0].zoom,type:c.type,property:c.property,stops:[]}),h[q[0].zoom].stops.push([q[0].value,q[1]]);for(g in h)u.push([h[g].zoom,a(h[g])]);g=function(a,b){return e({stops:u,base:c.base},a)(a,b)};g.isFeatureConstant=!1;g.isZoomConstant=!1}else r?
        (g=function(a){return t(c,a)},g.isFeatureConstant=!0,g.isZoomConstant=!1):(g=function(a,b){return t(c,b[c.property])},g.isFeatureConstant=!1,g.isZoomConstant=!0)}else g=function(){return c},g.isFeatureConstant=!0,g.isZoomConstant=!0;return g}function b(a,b){for(var c=0;c<a.stops.length;c++)if(b===a.stops[c][0])return a.stops[c][1];return a.stops[0][1]}function d(a,b){for(var c=0;c<a.stops.length&&!(b<a.stops[c][0]);c++);return a.stops[Math.max(c-1,0)][1]}function e(a,b){for(var c=void 0!==a.base?
        a.base:1,d=0;!(d>=a.stops.length||b<=a.stops[d][0]);)d++;return 0===d?a.stops[d][1]:d===a.stops.length?a.stops[d-1][1]:f(b,c,a.stops[d-1][0],a.stops[d][0],a.stops[d-1][1],a.stops[d][1])}function f(a,b,c,d,e,k){return"function"===typeof e?function(){var g=e.apply(void 0,arguments),h=k.apply(void 0,arguments);return f(a,b,c,d,g,h)}:e.length?h(a,b,c,d,e,k):g(a,b,c,d,e,k)}function g(a,b,c,d,e,f){d-=c;a-=c;b=1===b?a/d:(Math.pow(b,a)-1)/(Math.pow(b,d)-1);return e*(1-b)+f*b}function h(a,b,c,d,e,f){for(var h=
        [],k=0;k<e.length;k++)h[k]=g(a,b,c,d,e[k],f[k]);return h}function k(a){return a&&"object"===typeof a&&a.stops}c.Util.isFunctionDefinition=k;c.Util.interpolated=function(b){return a(b,"exponential")};c.Util["piecewise-constant"]=function(b){return a(b,"interval")};c.Util.loadFunctionTypes=function(a,b){if(!a)return null;if(c.Util.isArray(a)){for(var d=[],e=0;e<a.length;e++)d.push(c.Util.loadFunctionTypes(a[e],b));return d}var f={},d=[],g;for(g in a)a.hasOwnProperty(g)&&d.push(g);for(var e=0,h=d.length;e<
    h;e++)g=d[e],c.Util.isFunctionDefinition(a[g])?(f["_"+g]=a[g],function(a){Object.defineProperty(f,a,{get:function(){this["__fn_"+a]||(this["__fn_"+a]=c.Util.interpolated(this["_"+a]));return this["__fn_"+a].apply(this,b())},set:function(b){this["_"+a]=b},configurable:!0,enumerable:!0})}(g)):f[g]=a[g];return f};c.Util.getFunctionTypeResources=function(a){if(!a||!a.stops)return null;for(var b=[],c=0,d=a.stops.length;c<d;c++)b.push(a.stops[c][1]);return b}})();"undefined"!==typeof Promise?c.Promise=
            Promise:function(a){function b(a){if(a){var b=this;a(function(a){b.resolve(a)},function(a){b.reject(a)})}}function c(a,b){if("function"===typeof a.y)try{var d=a.y.call(f,b);a.p.resolve(d)}catch(e){a.p.reject(e)}else a.p.resolve(b)}function e(a,b){if("function"===typeof a.n)try{var c=a.n.call(f,b);a.p.resolve(c)}catch(d){a.p.reject(d)}else a.p.reject(b)}var f,g=function(){function a(){for(;b.length-c;)b[c](),b[c++]=f,1024==c&&(b.splice(0,1024),c=0)}var b=[],c=0,d=function(){if("undefined"!==typeof MutationObserver){var b=
            document.createElement("div");(new MutationObserver(a)).observe(b,{attributes:!0});return function(){b.setAttribute("a",0)}}return"undefined"!==typeof setImmediate?function(){setImmediate(a)}:function(){setTimeout(a,0)}}();return function(a){b.push(a);1==b.length-c&&d()}}();b.prototype={resolve:function(a){if(void 0===this.state){if(a===this)return this.reject(new TypeError("Attempt to resolve promise with self"));var b=this;if(a&&("function"===typeof a||"object"===typeof a))try{var e=!0,f=a.then;
            if("function"===typeof f){f.call(a,function(a){e&&(e=!1,b.resolve(a))},function(a){e&&(e=!1,b.reject(a))});return}}catch(n){e&&this.reject(n);return}this.state="fulfilled";this.v=a;b.c&&g(function(){for(var e=0,f=b.c.length;e<f;e++)c(b.c[e],a)})}},reject:function(a){if(void 0===this.state){this.state="rejected";this.v=a;var c=this.c;c?g(function(){for(var b=0,d=c.length;b<d;b++)e(c[b],a)}):b.suppressUncaughtRejectionError||console.log("You upset Zousan. Please catch rejections: ",a,a.stack)}},then:function(a,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            f){var l=new b,m={y:a,n:f,p:l};if(void 0===this.state)this.c?this.c.push(m):this.c=[m];else{var n=this.state,p=this.v;g(function(){"fulfilled"===n?c(m,p):e(m,p)})}return l},"catch":function(a){return this.then(null,a)},"finally":function(a){return this.then(a,a)},timeout:function(a,c){c=c||"Timeout";var d=this;return new b(function(b,e){setTimeout(function(){e(Error(c))},a);d.then(function(a){b(a)},function(a){e(a)})})}};b.resolve=function(a){var c=new b;c.resolve(a);return c};b.reject=function(a){var c=
            new b;c.reject(a);return c};b.all=function(a){function c(g,k){"function"!==typeof g.then&&(g=b.resolve(g));g.then(function(b){d[k]=b;e++;e==a.length&&f.resolve(d)},function(a){f.reject(a)})}for(var d=[],e=0,f=new b,g=0;g<a.length;g++)c(a[g],g);a.length||f.resolve(d);return f};a.Promise=b}(c);c.Coordinate=function(a,b){c.Util.isNil(a)||c.Util.isNil(b)?c.Util.isArray(a)?(this.x=+a[0],this.y=+a[1]):c.Util.isNil(a.x)||c.Util.isNil(a.y)||(this.x=+a.x,this.y=+a.y):(this.x=+a,this.y=+b);if(this.isNaN())throw Error("coordinate is NaN");
    };c.Util.extend(c.Coordinate.prototype,{copy:function(){return new c.Coordinate(this.x,this.y)},_add:function(a,b){a instanceof c.Coordinate?(this.x+=a.x,this.y+=a.y):(this.x+=a,this.y+=b);return this},add:function(a,b){var d,e;a instanceof c.Coordinate?(d=this.x+a.x,e=this.y+a.y):(d=this.x+a,e=this.y+b);return new c.Coordinate(d,e)},_substract:function(a,b){a instanceof c.Coordinate?(this.x-=a.x,this.y-=a.y):(this.x-=a,this.y-=b);return this},substract:function(a,b){var d,e;a instanceof c.Coordinate?
        (d=this.x-a.x,e=this.y-a.y):(d=this.x-a,e=this.y-b);return new c.Coordinate(d,e)},multi:function(a){return new c.Coordinate(this.x*a,this.y*a)},_multi:function(a){this.x*=a;this.y*=a;return this},equals:function(a){return c.Util.isCoordinate(a)?this.x===a.x&&this.y===a.y:!1},isNaN:function(){return isNaN(this.x)||isNaN(this.y)},toArray:function(){return[this.x,this.y]},toJSON:function(){return{x:this.x,y:this.y}}});c.Point=function(a,b){c.Util.isNil(a)||c.Util.isNil(b)?c.Util.isNil(a.x)||c.Util.isNil(a.y)?
            c.Util.isArrayHasData(a)&&(this.x=a[0],this.y=a[1]):(this.x=a.x,this.y=a.y):(this.x=a,this.y=b);if(this.isNaN())throw Error("point is NaN");};c.Util.extend(c.Point.prototype,{abs:function(){return new c.Point(Math.abs(this.x),Math.abs(this.y))},_abs:function(){this.x=Math.abs(this.x);this.y=Math.abs(this.y);return this},copy:function(){return new c.Point(this.x,this.y)},_round:function(){this.x=c.Util.round(this.x);this.y=c.Util.round(this.y);return this},round:function(){return new c.Point(c.Util.round(this.x),
        c.Util.round(this.y))},equals:function(a){return this.x===a.x&&this.y===a.y},distanceTo:function(a){var b=a.x-this.x;a=a.y-this.y;return Math.sqrt(b*b+a*a)},_add:function(a,b){a instanceof c.Point?(this.x+=a.x,this.y+=a.y):(this.x+=a,this.y+=b);return this},add:function(a,b){var d,e;a instanceof c.Point?(d=this.x+a.x,e=this.y+a.y):(d=this.x+a,e=this.y+b);return new c.Point(d,e)},_substract:function(a,b){a instanceof c.Point?(this.x-=a.x,this.y-=a.y):(this.x-=a,this.y-=b);return this},substract:function(a,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    b){var d,e;a instanceof c.Point?(d=this.x-a.x,e=this.y-a.y):(d=this.x-a,e=this.y-b);return new c.Point(d,e)},_multi:function(a){this.x*=a;this.y*=a;return this},multi:function(a){return new c.Point(this.x*a,this.y*a)},div:function(a){return this.multi(1/a)},_div:function(a){return this._multi(1/a)},isNaN:function(){return isNaN(this.x)||isNaN(this.y)},toArray:function(){return[this.x,this.y]},toJSON:function(){return{x:this.x,y:this.y}},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},
        unit:function(){return this.copy()._unit()},_unit:function(){this._div(this.mag());return this},perp:function(){return this.copy()._perp()},_perp:function(){var a=this.y;this.y=this.x;this.x=-a;return this}});c.Size=function(a,b){this.width=a;this.height=b};c.Util.extend(c.Size.prototype,{copy:function(){return new c.Size(this.width,this.height)},add:function(a){return new c.Size(this.width+a.width,this.height+a.height)},equals:function(a){return this.width===a.width&&this.height===a.height},multi:function(a){return new c.Size(this.width*
        a,this.height*a)},_multi:function(a){this.width*=a;this.height*=a;return this},_round:function(){this.width=c.Util.round(this.width);this.height=c.Util.round(this.height);return this},toPoint:function(){return new c.Point(this.width,this.height)},toArray:function(){return[this.width,this.height]},toJSON:function(){return{width:this.width,height:this.height}}});c.CRS=function(a,b){this.type=a;this.properties=b};c.CRS.createProj4=function(a){return new c.CRS("proj4",{proj:a})};c.CRS.WGS84=c.CRS.createProj4("+proj=longlat +datum=WGS84 +no_defs");
    c.CRS.EPSG4326=c.CRS.WGS84;c.CRS.EPSG3857=c.CRS.createProj4("+proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +wktext  +no_defs");c.CRS.IDENTITY=c.CRS.createProj4("+proj=identity +no_defs");c.CRS.CGCS2000=c.CRS.createProj4("+proj=longlat +datum=CGCS2000");c.CRS.EPSG4490=c.CRS.CGCS2000;c.CRS.BD09LL=c.CRS.createProj4("+proj=longlat +datum=BD09");c.CRS.GCJ02=c.CRS.createProj4("+proj=longlat +datum=GCJ02");c.Extent=function(a,b,d,e){this._clazz=c.Coordinate;
        this._initialize(a,b,d,e)};c.Util.extend(c.Extent.prototype,{_initialize:function(a,b,d,e){this.ymax=this.ymin=this.xmax=this.xmin=null;c.Util.isNil(a)||(c.Util.isNumber(a)&&c.Util.isNumber(b)&&c.Util.isNumber(d)&&c.Util.isNumber(e)?(this.xmin=Math.min(a,d),this.ymin=Math.min(b,e),this.xmax=Math.max(a,d),this.ymax=Math.max(b,e)):c.Util.isNumber(a.x)&&c.Util.isNumber(b.x)&&c.Util.isNumber(a.y)&&c.Util.isNumber(b.y)?(a.x>b.x?(this.xmin=b.x,this.xmax=a.x):(this.xmin=a.x,this.xmax=b.x),a.y>b.y?(this.ymin=
                    b.y,this.ymax=a.y):(this.ymin=a.y,this.ymax=b.y)):c.Util.isNumber(a.xmin)&&c.Util.isNumber(a.xmax)&&c.Util.isNumber(a.ymin)&&c.Util.isNumber(a.ymax)&&(this.xmin=a.xmin,this.ymin=a.ymin,this.xmax=a.xmax,this.ymax=a.ymax))},_add:function(a){this.xmin+=a.x;this.ymin+=a.y;this.xmax+=a.x;this.ymax+=a.y;return this},add:function(a){return new this.constructor(this.xmin+a.x,this.ymin+a.y,this.xmax+a.x,this.ymax+a.y)},_substract:function(a){this.xmin-=a.x;this.ymin-=a.y;this.xmax-=a.x;this.ymax-=a.y;return this},
        substract:function(a){return new this.constructor(this.xmin-a.x,this.ymin-a.y,this.xmax-a.x,this.ymax-a.y)},round:function(){return new this.constructor(c.Util.round(this.xmin),c.Util.round(this.ymin),c.Util.round(this.xmax),c.Util.round(this.ymax))},_round:function(){this.xmin=c.Util.round(this.xmin);this.ymin=c.Util.round(this.ymin);this.xmax=c.Util.round(this.xmax);this.ymax=c.Util.round(this.ymax);return this},getMin:function(){return new this._clazz(this.xmin,this.ymin)},getMax:function(){return new this._clazz(this.xmax,
            this.ymax)},getCenter:function(){return new this._clazz((this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2)},isValid:function(){return c.Util.isNumber(this.xmin)&&c.Util.isNumber(this.ymin)&&c.Util.isNumber(this.xmax)&&c.Util.isNumber(this.ymax)},equals:function(a){return this.xmin===a.xmin&&this.xmax===a.xmax&&this.ymin===a.ymin&&this.ymax===a.ymax},intersects:function(a){var b=Math.max(this.ymin,a.ymin),c=Math.min(this.ymax,a.ymax);return!(Math.max(this.xmin,a.xmin)>Math.min(this.xmax,a.xmax)||b>c)},
        contains:function(a){return a.x>=this.xmin&&a.x<=this.xmax&&a.y>=this.ymin&&a.y<=this.ymax},getWidth:function(){return this.xmax-this.xmin},getHeight:function(){return this.ymax-this.ymin},__combine:function(a){a instanceof c.Point&&(a={xmin:a.x,xmax:a.x,ymin:a.y,ymax:a.y});var b=this.xmin;c.Util.isNumber(b)?c.Util.isNumber(a.xmin)&&b>a.xmin&&(b=a.xmin):b=a.xmin;var d=this.xmax;c.Util.isNumber(d)?c.Util.isNumber(a.xmax)&&d<a.xmax&&(d=a.xmax):d=a.xmax;var e=this.ymin;c.Util.isNumber(e)?c.Util.isNumber(a.ymin)&&
            e>a.ymin&&(e=a.ymin):e=a.ymin;var f=this.ymax;c.Util.isNumber(f)?c.Util.isNumber(a.ymax)&&f<a.ymax&&(f=a.ymax):f=a.ymax;return[b,e,d,f]},_combine:function(a){if(!a)return this;a=this.__combine(a);this.xmin=a[0];this.ymin=a[1];this.xmax=a[2];this.ymax=a[3];return this},combine:function(a){if(!a)return this;a=this.__combine(a);return new this.constructor(a[0],a[1],a[2],a[3])},intersection:function(a){return this.intersects(a)?new this.constructor(Math.max(this.xmin,a.xmin),Math.max(this.ymin,a.ymin),
                Math.min(this.xmax,a.xmax),Math.min(this.ymax,a.ymax)):null},expand:function(a){return a instanceof c.Size?new this.constructor(this.xmin-a.width,this.ymin-a.height,this.xmax+a.width,this.ymax+a.height):new this.constructor(this.xmin-a,this.ymin-a,this.xmax+a,this.ymax+a)},_expand:function(a){a instanceof c.Size?(this.xmin-=a.width,this.ymin-=a.height,this.xmax+=a.width,this.ymax+=a.height):(this.xmin-=a,this.ymin-=a,this.xmax+=a,this.ymax+=a);return this},toJSON:function(){return{xmin:this.xmin,
            ymin:this.ymin,xmax:this.xmax,ymax:this.ymax}},toArray:function(){var a=this.xmin,b=this.ymin,c=this.xmax,e=this.ymax;return[new this._clazz([a,e]),new this._clazz([c,e]),new this._clazz([c,b]),new this._clazz([a,b]),new this._clazz([a,e])]},copy:function(){return new this.constructor(this.xmin,this.ymin,this.xmax,this.ymax)}});c.PointExtent=function(a,b,d,e){this._clazz=c.Point;this._initialize(a,b,d,e)};c.Util.extend(c.PointExtent.prototype,c.Extent.prototype,{getSize:function(){return new c.Size(this.getWidth(),
        this.getHeight())}});c.Transformation=function(a){this.matrix=a};c.Util.extend(c.Transformation.prototype,{transform:function(a,b){return new c.Point(this.matrix[0]*(a.x-this.matrix[2])/b,this.matrix[1]*(a.y-this.matrix[3])/b)},untransform:function(a,b){return new c.Coordinate(a.x*b/this.matrix[0]+this.matrix[2],a.y*b/this.matrix[1]+this.matrix[3])}});c.measurer={};c.MeasurerUtil={getInstance:function(a){if(!a)return c.MeasurerUtil.DEFAULT;for(var b in c.measurer)if(c.measurer.hasOwnProperty(b)){var d=
        c.measurer[b].measure;if(d&&a.toLowerCase()===d.toLowerCase())return c.measurer[b]}return null},isSphere:function(a){return!c.Util.isNil(a.sphere)},DEFAULT:c.measurer.WGS84Sphere};c.measurer.Sphere=function(a){this.radius=a};c.Util.extend(c.measurer.Sphere.prototype,{rad:function(a){return a*Math.PI/180},measureLength:function(a,b){if(!a||!b)return 0;var c=this.rad(a.y),e=this.rad(b.y),f=c-e,g=this.rad(a.x)-this.rad(b.x),c=2*Math.asin(Math.sqrt(Math.pow(Math.sin(f/2),2)+Math.cos(c)*Math.cos(e)*Math.pow(Math.sin(g/
                2),2))),c=c*this.radius;return Math.round(1E5*c)/1E5},measureArea:function(a){var b=this.radius*Math.PI/180,c=0,e=a.length;if(3>e)return 0;for(var f=0;f<e-1;f++)var g=a[f],h=a[f+1],c=c+(g.x*b*Math.cos(g.y*Math.PI/180)*h.y*b-h.x*b*Math.cos(h.y*Math.PI/180)*g.y*b);e=a[f];a=a[0];c+=e.x*b*Math.cos(e.y*Math.PI/180)*a.y*b-a.x*b*Math.cos(a.y*Math.PI/180)*e.y*b;return.5*Math.abs(c)},locate:function(a,b,d){if(!a)return null;b||(b=0);d||(d=0);if(!b&&!d)return a;var e=Math.abs(b),f=Math.abs(d),g=this.rad(a.y);
        a=this.rad(a.x);g+=2*Math.sin(f/(2*this.radius))*(0<d?1:-1);a+=2*Math.sqrt(Math.pow(Math.sin(e/(2*this.radius)),2)/Math.pow(Math.cos(g),2))*(0<b?1:-1);return new c.Coordinate(180*a/Math.PI,180*g/Math.PI)}});c.measurer.WGS84Sphere={measure:"EPSG:4326",sphere:new c.measurer.Sphere(6378137),measureLength:function(){return this.sphere.measureLength.apply(this.sphere,arguments)},measureArea:function(){return this.sphere.measureArea.apply(this.sphere,arguments)},locate:function(){return this.sphere.locate.apply(this.sphere,
        arguments)}};c.measurer.BaiduSphere={measure:"BAIDU",sphere:new c.measurer.Sphere(6370996.81),measureLength:function(){return this.sphere.measureLength.apply(this.sphere,arguments)},measureArea:function(){return this.sphere.measureArea.apply(this.sphere,arguments)},locate:function(){return this.sphere.locate.apply(this.sphere,arguments)}};c.measurer.Identity={measure:"IDENTITY",measureLength:function(a,b){if(!a||!b)return 0;try{return Math.sqrt(Math.pow(a.x-b.x,2)+Math.pow(a.y-b.y,2))}catch(c){return 0}},
        measureArea:function(a){if(!c.Util.isArrayHasData(a))return 0;for(var b=0,d=0,e=a.length;d<e;d++)var f=a[d],g=null,g=d===e-1?a[0]:a[d+1],b=b+(f.x*g.y-f.y*g.x);return Math.abs(b/2)},locate:function(a,b,d){if(!a)return null;b||(b=0);d||(d=0);return b||d?new c.Coordinate(a.x+b,a.y+d):a}};c.projection={};c.projection.Common={project:function(){},unproject:function(){},projectCoords:function(a){return c.Util.mapArrayRecursively(a,this.project,this)},unprojectCoords:function(a){return c.Util.mapArrayRecursively(a,
        this.unproject,this)}};c.projection.EPSG3857=c.Util.extend({},c.projection.Common,{code:"EPSG:3857",rad:Math.PI/180,metersPerDegree:111319.49077777777,maxLatitude:85.0511287798,project:function(a){var b=this.rad,d=this.metersPerDegree,e=this.maxLatitude,e=Math.max(Math.min(e,a.y),-e);return new c.Coordinate(a.x*d,(0===e?0:Math.log(Math.tan((90+e)*b/2))/b)*d)},unproject:function(a){var b=a.x,d=a.y,e=this.rad;a=this.metersPerDegree;d=0===d?0:(2*Math.atan(Math.exp(d/a*e))-Math.PI/2)/e;return new c.Coordinate(b/
        a,d)}},c.measurer.WGS84Sphere);c.projection.DEFAULT=c.projection.EPSG3857;c.projection.EPSG4326=c.Util.extend({},c.projection.Common,{code:"EPSG:4326",project:function(a){return new c.Coordinate(a)},unproject:function(a){return new c.Coordinate(a)}},c.measurer.WGS84Sphere);c.projection.BAIDU=c.Util.extend({},c.projection.Common,{code:"BAIDU",project:function(a){return this.convertLL2MC(a)},unproject:function(a){return this.convertMC2LL(a)}},c.measurer.BaiduSphere,{EARTHRADIUS:6370996.81,MCBAND:[1.289059486E7,
        8362377.87,5591021,3481989.83,1678043.12,0],LLBAND:[75,60,45,30,15,0],MC2LL:[[1.410526172116255E-8,8.98305509648872E-6,-1.9939833816331,200.9824383106796,-187.2403703815547,91.6087516669843,-23.38765649603339,2.57121317296198,-.03801003308653,1.73379812E7],[-7.435856389565537E-9,8.983055097726239E-6,-.78625201886289,96.32687599759846,-1.85204757529826,-59.36935905485877,47.40033549296737,-16.50741931063887,2.28786674699375,1.026014486E7],[-3.030883460898826E-8,8.98305509983578E-6,.30071316287616,
        59.74293618442277,7.357984074871,-25.38371002664745,13.45380521110908,-3.29883767235584,.32710905363475,6856817.37],[-1.981981304930552E-8,8.983055099779535E-6,.03278182852591,40.31678527705744,.65659298677277,-4.44255534477492,.85341911805263,.12923347998204,-.04625736007561,4482777.06],[3.09191371068437E-9,8.983055096812155E-6,6.995724062E-5,23.10934304144901,-2.3663490511E-4,-.6321817810242,-.00663494467273,.03430082397953,-.00466043876332,2555164.4],[2.890871144776878E-9,8.983055095805407E-6,
        -3.068298E-8,7.47137025468032,-3.53937994E-6,-.02145144861037,-1.234426596E-5,1.0322952773E-4,-3.23890364E-6,826088.5]],LL2MC:[[-.0015702102444,111320.7020616939,0x60e374c3105a3,-0x24bb4115e2e164,0x5cc55543bb0ae8,-0x7ce070193f3784,0x5e7ca61ddf8150,-0x261a578d8b24d0,0x665d60f3742ca,82.5],[8.277824516172526E-4,111320.7020463578,6.477955746671607E8,-4.082003173641316E9,1.077490566351142E10,-1.517187553151559E10,1.205306533862167E10,-5.124939663577472E9,9.133119359512032E8,67.5],[.00337398766765,111320.7020202162,
        4481351.045890365,-2.339375119931662E7,7.968221547186455E7,-1.159649932797253E8,9.723671115602145E7,-4.366194633752821E7,8477230.501135234,52.5],[.00220636496208,111320.7020209128,51751.86112841131,3796837.749470245,992013.7397791013,-1221952.21711287,1340652.697009075,-620943.6990984312,144416.9293806241,37.5],[-3.441963504368392E-4,111320.7020576856,278.2353980772752,2485758.690035394,6070.750963243378,54821.18345352118,9540.606633304236,-2710.55326746645,1405.483844121726,22.5],[-3.218135878613132E-4,
        111320.7020701615,.00369383431289,823725.6402795718,.46104986909093,2351.343141331292,1.58060784298199,8.77738589078284,.37238884252424,7.45]],convertMC2LL:function(a){var b,d;b=Math.abs(a.y);for(var e=0,f=this.MCBAND.length;e<f;e++)if(b>=this.MCBAND[e]){d=this.MC2LL[e];break}a=this.convertor(a,d);return new c.Coordinate(a.x.toFixed(6),a.y.toFixed(6))},convertLL2MC:function(a){var b,d,e,f;a.x=this.getLoop(a.x,-180,180);a.y=this.getRange(a.y,-74,74);b=new c.Coordinate(a.x,a.y);e=0;for(f=this.LLBAND.length;e<
    f;e++)if(b.y>=this.LLBAND[e]){d=this.LL2MC[e];break}if(!d)for(e=this.LLBAND.length-1;0<=e;e--)if(b.y<=-this.LLBAND[e]){d=this.LL2MC[e];break}a=this.convertor(a,d);return new c.Coordinate(a.x.toFixed(2),a.y.toFixed(2))},convertor:function(a,b){if(!a||!b)return null;var d=b[0]+b[1]*Math.abs(a.x),e=Math.abs(a.y)/b[9],e=b[2]+b[3]*e+b[4]*e*e+b[5]*e*e*e+b[6]*e*e*e*e+b[7]*e*e*e*e*e+b[8]*e*e*e*e*e*e,d=d*(0>a.x?-1:1),e=e*(0>a.y?-1:1);return new c.Coordinate(d,e)},toRadians:function(a){return Math.PI*a/180},
        toDegrees:function(a){return 180*a/Math.PI},getRange:function(a,b,c){null!=b&&(a=Math.max(a,b));null!=c&&(a=Math.min(a,c));return a},getLoop:function(a,b,c){for(;a>c;)a-=c-b;for(;a<b;)a+=c-b;return a}});c.projection.IDENTITY=c.Util.extend({},c.projection.Common,{code:"IDENTITY",project:function(a){return a.copy()},unproject:function(a){return a.copy()}},c.measurer.Identity);c.GeoUtil={distanceToSegment:function(a,b,c){var e=a.x;a=a.y;var f=b.x;b=b.y;var g=c.x;c=c.y;var h=(g-f)*(e-f)+(c-b)*(a-b);if(0>=
        h)return Math.sqrt((e-f)*(e-f)+(a-b)*(a-b));var k=(g-f)*(g-f)+(c-b)*(c-b);if(h>=k)return Math.sqrt((e-g)*(e-g)+(a-c)*(a-c));h/=k;f+=(g-f)*h;b+=(c-b)*h;return Math.sqrt((e-f)*(e-f)+(a-b)*(a-b))},pointInsidePolygon:function(a,b){var c,e,f,g=b.length,h=!1;c=0;for(e=g-1;c<g;e=c++)f=b[c],e=b[e],f.y>a.y!==e.y>a.y&&a.x<(e.x-f.x)*(a.y-f.y)/(e.y-f.y)+f.x&&(h=!h);return h},_computeLength:function(a,b){for(var c=0,e=0,f=a.length;e<f-1;e++)c+=b.measureLength(a[e],a[e+1]);return c},_computeArea:function(a,b){return b.measureArea(a)}};
    c.Simplify={getSqDist:function(a,b){var c=a.x-b.x,e=a.y-b.y;return c*c+e*e},getSqSegDist:function(a,b,c){var e=b.x;b=b.y;var f=c.x-e,g=c.y-b;if(0!==f||0!==g){var h=((a.x-e)*f+(a.y-b)*g)/(f*f+g*g);1<h?(e=c.x,b=c.y):0<h&&(e+=f*h,b+=g*h)}f=a.x-e;g=a.y-b;return f*f+g*g},simplifyRadialDist:function(a,b){for(var c=a[0],e=[c],f,g=1,h=a.length;g<h;g++)f=a[g],this.getSqDist(f,c)>b&&(e.push(f),c=f);c!==f&&e.push(f);return e},simplifyDPStep:function(a,b,c,e,f){for(var g=e,h,k=b+1;k<c;k++){var l=this.getSqSegDist(a[k],
        a[b],a[c]);l>g&&(h=k,g=l)}g>e&&(1<h-b&&this.simplifyDPStep(a,b,h,e,f),f.push(a[h]),1<c-h&&this.simplifyDPStep(a,h,c,e,f))},simplifyDouglasPeucker:function(a,b){var c=a.length-1,e=[a[0]];this.simplifyDPStep(a,0,c,b,e);e.push(a[c]);return e},simplify:function(a,b,c){if(2>=a.length)return a;b=void 0!==b?b*b:1;a=c?a:this.simplifyRadialDist(a,b);return a=this.simplifyDouglasPeucker(a,b)}};c.Handler=c.Class.extend({includes:c.Eventable,initialize:function(a){this.target=a},enable:function(){if(this._enabled)return this;
        this._enabled=!0;this.addHooks();return this},disable:function(){if(!this._enabled)return this;this._enabled=!1;this.removeHooks();return this},enabled:function(){return!!this._enabled},remove:function(){this.disable();delete this.target;delete this.dom}});c.Handlerable={addHandler:function(a,b){if(!b)return this;this._handlers||(this._handlers=[]);if(this[a])return this[a].enable(),this;var c=this[a]=new b(this);this._handlers.push(c);this.options[a]&&c.enable();return this},removeHandler:function(a){if(!a)return this;
        var b=this[a];b&&(b=c.Util.indexOfArray(b,this._handlers),0<=b&&this._handlers.splice(b,1),this[a].remove(),delete this[a]);return this},_clearHandlers:function(){for(var a=0,b=this._handlers.length;a<b;a++)this._handlers[a].remove();this._handlers=[]}};c.Handler.Drag=c.Handler.extend({START:c.Browser.touch?["touchstart","mousedown"]:["mousedown"],END:{mousedown:"mouseup",touchstart:"touchend",pointerdown:"touchend",MSPointerDown:"touchend"},MOVE:{mousedown:"mousemove",touchstart:"touchmove",pointerdown:"touchmove",
        MSPointerDown:"touchmove"},initialize:function(a,b){this.dom=a;this.options=b},enable:function(){if(this.dom)c.DomUtil.on(this.dom,this.START.join(" "),this.onMouseDown,this)},disable:function(){this.dom&&c.DomUtil.off(this.dom,this.START.join(" "),this.onMouseDown)},onMouseDown:function(a){if(!c.Util.isNumber(a.button)||2!==a.button)if(!this.options||!this.options.cancelOn||!0!==this.options.cancelOn(a)){var b=this.dom;b.setCapture?b.setCapture():window.captureEvents&&window.captureEvents(window.Event.MOUSEMOVE|
            window.Event.MOUSEUP);b.ondragstart=function(){return!1};this.moved=!1;b=a.touches?a.touches[0]:a;this.startPos=new c.Point(b.clientX,b.clientY);c.DomUtil.on(document,this.MOVE[a.type],this.onMouseMove,this).on(document,this.END[a.type],this.onMouseUp,this);this.fire("mousedown",{domEvent:a,mousePos:new c.Point(b.clientX,b.clientY)})}},onMouseMove:function(a){if(!(a.touches&&1<a.touches.length)){var b=a.touches?a.touches[0]:a,d=(new c.Point(b.clientX,b.clientY)).substract(this.startPos);if(d.x||d.y)this.moved?
        this.fire("dragging",{domEvent:a,mousePos:new c.Point(b.clientX,b.clientY)}):(this.fire("dragstart",{domEvent:a,mousePos:this.startPos.copy()}),this.moved=!0)}},onMouseUp:function(a){var b=this.dom,d=a.changedTouches?a.changedTouches[0]:a,e;for(e in this.MOVE)c.DomUtil.off(document,this.MOVE[e],this.onMouseMove,this).off(document,this.END[e],this.onMouseUp,this);b.releaseCapture?b.releaseCapture():window.captureEvents&&window.captureEvents(window.Event.MOUSEMOVE|window.Event.MOUSEUP);a={domEvent:a};
        c.Util.isNumber(d.clientX)&&(a.mousePos=new c.Point(parseInt(d.clientX,0),parseInt(d.clientY,0)));this.moved&&this.fire("dragend",a);this.fire("mouseup",a)}});c.MapTool=c.Class.extend({includes:[c.Eventable],addTo:function(a){if(!a)return this;this._map=a;var b="_tool"+this.name;a[b]&&a[b].disable();if(this.onAdd)this.onAdd();this.enable();a[b]=this;this._fireEvent("add");return this},getMap:function(){return this._map},enable:function(){if(!this._map||this._enabled)return this;this._enabled=!0;this._switchEvents("off");
        this._registerEvents();if(this.onEnable)this.onEnable();this._fireEvent("enable");return this},disable:function(){if(!this._enabled||!this._map)return this;this._enabled=!1;this._switchEvents("off");if(this.onDisable)this.onDisable();this._fireEvent("disable");return this},isEnabled:function(){return this._enabled?!0:!1},_registerEvents:function(){this._switchEvents("on")},_switchEvents:function(a){var b=this.getEvents();if(b)this._map[a](b,this)},_fireEvent:function(a,b){b||(b={});this.fire(a,b)}});
    c.DrawTool=c.MapTool.extend({options:{symbol:{lineColor:"#000",lineWidth:2,lineOpacity:1,polygonFill:"#fff",polygonOpacity:.3},mode:null,once:!1},initialize:function(a){c.Util.setOptions(this,a);this._checkMode()},getMode:function(){return this.options.mode?this.options.mode.toLowerCase():null},setMode:function(a){this._geometry&&(this._geometry.remove(),delete this._geometry);this._clearStage();this._switchEvents("off");this.options.mode=a;this._checkMode();this.isEnabled()&&this._switchEvents("on");
        return this},getSymbol:function(){var a=this.options.symbol;return a?c.Util.extendSymbol(a):c.Util.extendSymbol(this.options.symbol)},setSymbol:function(a){if(!a)return this;this.options.symbol=a;this._geometry&&this._geometry.setSymbol(a);return this},onAdd:function(){this._checkMode()},onEnable:function(){var a=this.getMap();this._mapDraggable=a.options.draggable;this._mapDoubleClickZoom=a.options.doubleClickZoom;this._autoBorderPanning=a.options.autoBorderPanning;a.config({autoBorderPanning:!0,
        draggable:!1,doubleClickZoom:!1});this._drawToolLayer=this._getDrawLayer();this._clearStage();this._loadResources();return this},_checkMode:function(){this._getRegisterMode()},onDisable:function(){var a=this.getMap();a.config({autoBorderPanning:this._autoBorderPanning,draggable:this._mapDraggable,doubleClickZoom:this._mapDoubleClickZoom});delete this._autoBorderPanning;delete this._mapDraggable;delete this._mapDoubleClickZoom;this._endDraw();a.removeLayer(this._getDrawLayer());return this},_loadResources:function(){var a=
        this.getSymbol(),a=c.Util.getExternalResources(a);c.Util.isArrayHasData(a)&&this._drawToolLayer._getRenderer().loadResources(a)},_getProjection:function(){return this._map.getProjection()},_getRegisterMode:function(){var a=this.getMode(),b=c.DrawTool.getRegisterMode(a);if(!b)throw Error(a+" is not a valid mode of maptalks.DrawTool.");return b},getEvents:function(){var a=this._getRegisterMode().action;return"clickDblclick"===a?{click:this._clickForPath,mousemove:this._mousemoveForPath,dblclick:this._dblclickForPath}:
        "click"===a?{click:this._clickForPoint}:"drag"===a?{mousedown:this._mousedownToDraw}:null},_addGeometryToStage:function(a){this._getDrawLayer().addGeometry(a)},_clickForPoint:function(a){this._geometry=this._getRegisterMode().create(a.coordinate);this.options.symbol&&this.options.hasOwnProperty("symbol")&&this._geometry.setSymbol(this.options.symbol);this._endDraw()},_clickForPath:function(a){var b=this._getRegisterMode(),c=a.coordinate,e=this.getSymbol();this._geometry?(this._clickCoords.push(c),
            b.update(this._clickCoords,this._geometry),this._fireEvent("drawvertex",a)):(this._clickCoords=[c],this._geometry=b.create(this._clickCoords),e&&this._geometry.setSymbol(e),this._addGeometryToStage(this._geometry),this._fireEvent("drawstart",a))},_mousemoveForPath:function(a){if(this._geometry){var b=this._getMouseContainerPoint(a);if(this._isValidContainerPoint(b)){var b=a.coordinate,c=this._getRegisterMode(),e=this._clickCoords;e&&0<e.length&&b.equals(e[e.length-1])||(c.update(e.concat([b]),this._geometry),
        this._fireEvent("mousemove",a))}}},_dblclickForPath:function(a){if(this._geometry){var b=this._getMouseContainerPoint(a);if(this._isValidContainerPoint(b)){var b=this._getRegisterMode(),d=this._clickCoords;d.push(a.coordinate);if(!(2>d.length)){var e=[],f,g;f=1;for(g=d.length;f<g;f++)d[f].x===d[f-1].x&&d[f].y===d[f-1].y&&e.push(f);for(f=e.length-1;0<=f;f--)d.splice(e[f],1);2>d.length||this._geometry&&this._geometry instanceof c.Polygon&&3>d.length||(b.update(d,this._geometry),this._endDraw(a))}}}},
        _mousedownToDraw:function(a){function b(a){var b=f.getSymbol(),c=f._geometry;c?e.update(a,c):(c=e.create(a),c.setSymbol(b),f._addGeometryToStage(c),f._geometry=c)}function c(d){if(!this._geometry)return!1;var e=this._getMouseContainerPoint(d);if(!this._isValidContainerPoint(e))return!1;b(d.coordinate);this._fireEvent("mousemove",a);return!1}var e=this._getRegisterMode(),f=this,g=this._getMouseContainerPoint(a);if(!this._isValidContainerPoint(g))return!1;var g=a.coordinate,h=function(e){if(!this._geometry)return!1;
            var f=this._getMouseContainerPoint(e);this._isValidContainerPoint(f)&&b(e.coordinate);this._map.off("mousemove",c,this);this._map.off("mouseup",h,this);this._endDraw(a);return!1};this._fireEvent("drawstart",a);b(g);this._map.on("mousemove",c,this);this._map.on("mouseup",h,this);return!1},_endDraw:function(a){if(this._geometry&&!this._ending){this._ending=!0;var b=this._geometry;this._clearStage();a||(a={});this._geometry=b;this._fireEvent("drawend",a);delete this._geometry;this.options.once&&this.disable();
            delete this._ending}},_clearStage:function(){this._getDrawLayer().clear();delete this._geometry;delete this._clickCoords},_getMouseContainerPoint:function(a){c.DomUtil.stopPropagation(a.domEvent);return a.containerPoint},_isValidContainerPoint:function(a){var b=this._map.getSize(),c=b.width,b=b.height;return 0>a.x||0>a.y||a.x>c||a.y>b?!1:!0},_getDrawLayer:function(){var a=c.internalLayerPrefix+"drawtool",b=this._map.getLayer(a);b||(b=new c.VectorLayer(a,{enableSimplify:!1}),this._map.addLayer(b));
            return b},_fireEvent:function(a,b){b||(b={});this._geometry&&(b.geometry=this._getRegisterMode().generate(this._geometry).copy());c.MapTool.prototype._fireEvent.call(this,a,b)}});c.DrawTool.registerMode=function(a,b){c.DrawTool._registeredMode||(c.DrawTool._registeredMode={});c.DrawTool._registeredMode[a.toLowerCase()]=b};c.DrawTool.getRegisterMode=function(a){return c.DrawTool._registeredMode?c.DrawTool._registeredMode[a.toLowerCase()]:null};c.DrawTool.registerMode("circle",{action:"drag",geometryClass:c.Circle,
        create:function(a){return new c.Circle(a,0)},update:function(a,b){var c=b.getMap(),e=b.getCenter(),c=c.computeLength(e,a);b.setRadius(c)},generate:function(a){return a}});c.DrawTool.registerMode("ellipse",{action:"drag",geometryClass:c.Ellipse,create:function(a){return c.Ellipse(a,0,0)},update:function(a,b){var d=b.getMap(),e=b.getCenter(),f=d.computeLength(e,new c.Coordinate({x:a.x,y:e.y})),d=d.computeLength(e,new c.Coordinate({x:e.x,y:a.y}));b.setWidth(2*f);b.setHeight(2*d)},generate:function(a){return a}});
    c.DrawTool.registerMode("rectangle",{action:"drag",geometryClass:c.Rectangle,create:function(a){var b=c.Rectangle(a,0,0);b._firstClick=a;return b},update:function(a,b){var d=b._firstClick,e=b.getMap(),f=e.computeLength(d,new c.Coordinate(a.x,d.y)),g=e.computeLength(d,new c.Coordinate(d.x,a.y)),d=e.coordinateToContainerPoint(d),h=e.coordinateToContainerPoint(a);b.setCoordinates(e.containerPointToCoordinate(new c.Point(Math.min(d.x,h.x),Math.min(d.y,h.y))));b.setWidth(f);b.setHeight(g)},generate:function(a){return a}});
    c.DrawTool.registerMode("point",{action:"click",create:function(a){return new c.Marker(a)},generate:function(a){return a}});c.DrawTool.registerMode("polygon",{action:"clickDblclick",create:function(a){return new c.LineString(a)},update:function(a,b){var d=b.getSymbol();b.setCoordinates(a);if(3<=a.length){var e=b.getLayer();if(e){var f=e.getGeometryById("polygon");f||(f=new c.Polygon([a],{id:"polygon"}),d&&(d=c.Util.extendSymbol(d,{lineOpacity:0}),f.setSymbol(d)),f.addTo(e));f.setCoordinates(a)}}},
        generate:function(a){return new c.Polygon(a.getCoordinates(),{symbol:a.getSymbol()})}});c.DrawTool.registerMode("linestring",{action:"clickDblclick",create:function(a){return new c.LineString(a)},update:function(a,b){b.setCoordinates(a)},generate:function(a){return a}});c.DrawTool.registerMode("arccurve",{action:"clickDblclick",create:function(a){return new c.ArcCurve(a)},update:function(a,b){b.setCoordinates(a)},generate:function(a){return a}});c.DrawTool.registerMode("quadbeziercurve",{action:"clickDblclick",
        create:function(a){return new c.QuadBezierCurve(a)},update:function(a,b){b.setCoordinates(a)},generate:function(a){return a}});c.DrawTool.registerMode("cubicbeziercurve",{action:"clickDblclick",create:function(a){return new c.CubicBezierCurve(a)},update:function(a,b){b.setCoordinates(a)},generate:function(a){return a}});c.DistanceTool=c.DrawTool.extend({options:{mode:"LineString",language:"zh-CN",metric:!0,imperial:!1,symbol:{lineColor:"#000",lineWidth:3,lineOpacity:1},vertexSymbol:{markerType:"ellipse",
        markerFill:"#fff",markerLineColor:"#000",markerLineWidth:3,markerWidth:10,markerHeight:10},labelOptions:{symbol:{textWrapCharacter:"\n",textFaceName:"monospace",textLineSpacing:1,textHorizontalAlignment:"right",markerLineColor:"#b4b3b3",textDx:15},boxPadding:{width:6,height:4}}},initialize:function(a){c.Util.setOptions(this,a);this.on("enable",this._afterEnable,this).on("disable",this._afterDisable,this);this._measureLayers=[]},clear:function(){if(c.Util.isArrayHasData(this._measureLayers))for(var a=
        0;a<this._measureLayers.length;a++)this._measureLayers[a].remove();delete this._lastMeasure;delete this._lastVertex;this._measureLayers=[];return this},getMeasureLayers:function(){return this._measureLayers},getLastMeasure:function(){return this._lastMeasure?this._lastMeasure:0},_measure:function(a){var b=this.getMap(),d;a instanceof c.Geometry?d=b.computeGeometryLength(a):c.Util.isArray(a)&&(d=c.GeoUtil._computeLength(a,b.getProjection()));this._lastMeasure=d;a="zh-CN"===this.options.language?[" \u7c73",
            " \u516c\u91cc"," \u82f1\u5c3a"," \u82f1\u91cc"]:[" m"," km"," feet"," mile"];b="";this.options.metric&&(b+=1E3>d?d.toFixed(0)+a[0]:(d/1E3).toFixed(2)+a[1]);this.options.imperial&&(d*=3.2808399,0<b.length&&(b+="\n"),b+=5280>d?d.toFixed(0)+a[2]:(d/5280).toFixed(2)+a[3]);return b},_registerMeasureEvents:function(){this.on("drawstart",this._msOnDrawStart,this).on("drawvertex",this._msOnDrawVertex,this).on("mousemove",this._msOnMouseMove,this).on("drawend",this._msOnDrawEnd,this)},_afterEnable:function(){this._registerMeasureEvents()},
        _afterDisable:function(){this.off("drawstart",this._msOnDrawStart,this).off("drawvertex",this._msOnDrawVertex,this).off("mousemove",this._msOnMouseMove,this).off("drawend",this._msOnDrawEnd,this)},_msOnDrawStart:function(a){var b=this.getMap(),d=c.Util.UID(),e="distancetool_"+d,d="distancetool_markers_"+d;b.getLayer(e)?(this._measureLineLayer=b.getLayer(e),this._measureMarkerLayer=b.getLayer(d)):(this._measureLineLayer=(new c.VectorLayer(e,{drawImmediate:!0})).addTo(b),this._measureMarkerLayer=(new c.VectorLayer(d,
                {drawImmediate:!0})).addTo(b));this._measureLayers.push(this._measureLineLayer);this._measureLayers.push(this._measureMarkerLayer);(new c.Marker(a.coordinate,{symbol:this.options.vertexSymbol})).addTo(this._measureMarkerLayer);a=new c.Label("zh-CN"===this.options.language?"\u8d77\u70b9":"start",a.coordinate,this.options.labelOptions);this._measureMarkerLayer.addGeometry(a)},_msOnMouseMove:function(a){var b=this._measure(a.geometry.getCoordinates().concat([a.coordinate]));if(!this._tailMarker){var d=
            c.Util.extendSymbol(this.options.vertexSymbol);d.markerWidth/=2;d.markerHeight/=2;this._tailMarker=(new c.Marker(a.coordinate,{symbol:d})).addTo(this._measureMarkerLayer);this._tailLabel=(new c.Label(b,a.coordinate,this.options.labelOptions)).addTo(this._measureMarkerLayer)}this._tailMarker.setCoordinates(a.coordinate);this._tailLabel.setContent(b);this._tailLabel.setCoordinates(a.coordinate)},_msOnDrawVertex:function(a){var b=a.geometry;(new c.Marker(a.coordinate,{symbol:this.options.vertexSymbol})).addTo(this._measureMarkerLayer);
            b=this._measure(b);a=new c.Label(b,a.coordinate,this.options.labelOptions);this._measureMarkerLayer.addGeometry(a);this._lastVertex=a},_msOnDrawEnd:function(a){this._clearTailMarker();var b=this._lastVertex.getSize();b||(b=new c.Size(10,10));this._addClearMarker(this._lastVertex.getCoordinates(),b.width);a=a.geometry.copy();a.addTo(this._measureLineLayer);this._lastMeasure=a.getLength()},_addClearMarker:function(a,b){var d=new c.Marker(a,{symbol:[{markerType:"square",markerFill:"#ffffff",markerLineColor:"#b4b3b3",
            markerLineWidth:2,markerWidth:15,markerHeight:15,markerDx:20+b},{markerType:"x",markerWidth:10,markerHeight:10,markerDx:20+b}]}),e=this._measureLineLayer,f=this._measureMarkerLayer;d.on("click",function(){e.remove();f.remove();return!1},this);d.addTo(this._measureMarkerLayer)},_clearTailMarker:function(){this._tailMarker&&(this._tailMarker.remove(),delete this._tailMarker);this._tailLabel&&(this._tailLabel.remove(),delete this._tailLabel)}});c.AreaTool=c.DistanceTool.extend({options:{mode:"Polygon",
        symbol:{lineColor:"#000000",lineWidth:2,lineOpacity:1,lineDasharray:"",polygonFill:"#ffffff",polygonOpacity:.5}},initialize:function(a){c.Util.setOptions(this,a);this.on("enable",this._afterEnable,this).on("disable",this._afterDisable,this);this._measureLayers=[]},_measure:function(a){var b=this.getMap(),d;a instanceof c.Geometry?d=b.computeGeometryArea(a):c.Util.isArray(a)&&(d=c.GeoUtil._computeArea(a,b.getProjection()));this._lastMeasure=d;a="zh-CN"===this.options.language?[" \u5e73\u65b9\u7c73",
            " \u5e73\u65b9\u516c\u91cc"," \u5e73\u65b9\u82f1\u5c3a"," \u5e73\u65b9\u82f1\u91cc"]:[" sq.m"," sq.km"," sq.ft"," sq.mi"];b="";this.options.metric&&(b+=1E6>d?d.toFixed(0)+a[0]:(d/1E6).toFixed(2)+a[1]);this.options.imperial&&(d*=3.2808399,0<b.length&&(b+="\n"),b+=27878400>d?d.toFixed(0)+a[2]:(d/27878400).toFixed(2)+a[3]);return b},_msOnDrawVertex:function(a){this._lastVertex=(new c.Marker(a.coordinate,{symbol:this.options.vertexSymbol})).addTo(this._measureMarkerLayer)},_msOnDrawEnd:function(a){this._clearTailMarker();
        var b=this._measure(a.geometry);(b=(new c.Label(b,a.coordinate,this.options.labelOptions)).addTo(this._measureMarkerLayer).getSize())||(b=new c.Size(10,10));this._addClearMarker(a.coordinate,b.width);a=a.geometry.copy();a.addTo(this._measureLineLayer);this._lastMeasure=a.getArea()}});c.TileSystem=function(a,b,d,e){c.Util.isArray(a)?(this.scale={x:a[0],y:a[1]},this.origin={x:a[2],y:a[3]}):(this.scale={x:a,y:b},this.origin={x:d,y:e})};c.Util.extend(c.TileSystem,{"web-mercator":new c.TileSystem([1,-1,
        -2.003750834E7,2.003750834E7]),"tms-global-mercator":new c.TileSystem([1,1,-2.003750834E7,-2.003750834E7]),"tms-global-geodetic":new c.TileSystem([1,1,-180,-90]),baidu:new c.TileSystem([1,1,0,0])});c.TileSystem.getDefault=function(a){return"baidu"===a.code.toLowerCase()?"baidu":"epsg:4326"===a.code.toLowerCase()?"tms-global-geodetic":"identity"===a.code.toLowerCase()?[1,-1,0,0]:"web-mercator"};c.TileConfig=c.Class.extend({initialize:function(a,b,c){this.tileSize=c;this.fullExtent=b;this.prepareTileInfo(a,
        b)},prepareTileInfo:function(a,b){c.Util.isString(a)?a=c.TileSystem[a.toLowerCase()]:c.Util.isArray(a)&&(a=new c.TileSystem(a));if(!a)throw Error("Invalid TileSystem");this.tileSystem=a;this.transformation=new c.Transformation([b.right>b.left?1:-1,b.top>b.bottom?-1:1,a.origin.x,a.origin.y]);a.transOrigin=this.transformation.transform(a.origin,1)},getTileIndex:function(a,b){var c=this.tileSystem,e=this.tileSize,f=c.transOrigin;return{x:c.scale.x*Math.floor(1E-7+(a.x-f.x)/(e.width*b)),y:c.scale.y*-Math.floor(1E-7+
        (a.y-f.y)/(e.height*b))}},getCenterTile:function(a,b){var c=this.tileSystem,e=this.tileSize,f=this.transformation.transform(a,1),g=this.getTileIndex(f,b),h=f.x/b-c.scale.x*g.x*e.width,e=f.y/b+c.scale.y*g.y*e.height;0>c.scale.x&&--g.x;0<c.scale.y&&--g.y;g=this.getNeighorTileIndex(g.y,g.x,0,0,!0);return{x:g.x,y:g.y,offsetLeft:h,offsetTop:e}},getNeighorTileIndex:function(a,b,c,e,f,g){var h=this.tileSystem;b+=h.scale.x*e;a-=h.scale.y*c;g&&(f=this._getTileFullIndex(f),b<f.xmin?(b=f.xmax-(f.xmin-b)%(f.xmax-
            f.xmin),b===f.xmax&&(b=f.xmin)):b>=f.xmax&&(b=f.xmin+(b-f.xmin)%(f.xmax-f.xmin)),a>=f.ymax?a=f.ymin+(a-f.ymin)%(f.ymax-f.ymin):a<f.ymin&&(a=f.ymax-(f.ymin-a)%(f.ymax-f.ymin),a===f.ymax&&(a=f.ymin)));return{x:b,y:a}},_getTileFullIndex:function(a){var b=this.fullExtent,d=this.transformation,e=this.getTileIndex(d.transform(new c.Coordinate(b.left,b.top),1),a);a=this.getTileIndex(d.transform(new c.Coordinate(b.right,b.bottom),1),a);return new c.Extent(e,a)},getTileProjectedSw:function(a,b,c){var e=this.tileSystem,
        f=this.tileSize;return[e.scale.x*(b+(1===e.scale.x?0:1))*c*f.width+e.origin.x,e.origin.y+e.scale.y*(a+(1===e.scale.y?0:1))*c*f.height]}});c.Renderable={registerRenderer:function(a,b){this._regRenderers||(this._regRenderers={});this._regRenderers[a.toLowerCase()]=b;return this},getRendererClass:function(a){return this._regRenderers?this._regRenderers[a.toLowerCase()]:null}};c.Layer=c.Class.extend({includes:c.Eventable,options:{minZoom:null,maxZoom:null,visible:!0,opacity:1,drawImmediate:!1,globalCompositeOperation:null,
        renderer:"canvas",dx:0,dy:0},initialize:function(a,b){this.setId(a);c.Util.setOptions(this,b)},load:function(){if(!this.getMap())return this;this._initRenderer();var a=this.getZIndex();this.onAdd()&&(c.Util.isNil(a)||this._renderer.setZIndex(a),this._renderer.render(!0));return this},getId:function(){return this._id},setId:function(a){var b=this._id;c.Util.isNil(a)||(a+="");this._id=a;this.fire("idchange",{old:b,"new":a});return this},addTo:function(a){a.addLayer(this);return this},setZIndex:function(a){this._zIndex=
        a;if(this.map){var b=this._getLayerList();this.map._sortLayersByZIndex(b)}this._renderer&&this._renderer.setZIndex(a);return this},getZIndex:function(){return this._zIndex},isCanvasRender:function(){var a=this._getRenderer();return a?a.isCanvasRender():!1},getMap:function(){return this.map?this.map:null},bringToFront:function(){var a=this._getLayerList();if(!a)return this;var b=a[a.length-1];if(1===a.length||b===this)return this;a=b.getZIndex();this.setZIndex(a+1);return this},bringToBack:function(){var a=
        this._getLayerList();if(!a)return this;var b=a[0];if(1===a.length||b===this)return this;a=b.getZIndex();this.setZIndex(a-1);return this},show:function(){this.options.visible||(this.options.visible=!0,this._getRenderer()&&this._getRenderer().show());this.fire("show");return this},hide:function(){this.options.visible&&(this.options.visible=!1,this._getRenderer()&&this._getRenderer().hide());this.fire("hide");return this},isLoaded:function(){return this._renderer?this._renderer.isLoaded():!1},isVisible:function(){if(c.Util.isNumber(this.options.opacity)&&
        0>=this.options.opacity)return!1;var a=this.getMap();if(a&&(a=a.getZoom(),!c.Util.isNil(this.options.maxZoom)&&this.options.maxZoom<a||!c.Util.isNil(this.options.minZoom)&&this.options.minZoom>a))return!1;c.Util.isNil(this.options.visible)&&(this.options.visible=!0);return this.options.visible},remove:function(){this.map&&this.map.removeLayer(this);return this},getMask:function(){return this._mask},setMask:function(a){if(!(a instanceof c.Marker&&c.symbolizer.VectorMarkerSymbolizer.test(a.getSymbol())||
        a instanceof c.Polygon))throw Error("Mask for a layer must be either a marker with vector marker symbol, a Polygon or a MultiPolygon.");a instanceof c.Marker?a.updateSymbol({markerLineColor:"rgba(0, 0, 0, 0)",markerFillOpacity:0}):a.setSymbol({lineColor:"rgba(0, 0, 0, 0)",polygonOpacity:0});a._bindLayer(this);this._mask=a;if(!this.getMap()||this.getMap()._isBusy())return this;this._getRenderer()&&this._getRenderer().render();return this},removeMask:function(){delete this._mask;if(!this.getMap()||
        this.getMap()._isBusy())return this;this._getRenderer()&&this._getRenderer().render();return this},onAdd:function(){return!0},_refreshMask:function(){if(this._mask)this._mask.onZoomEnd()},_bindMap:function(a,b){a&&(this.map=a,this.setZIndex(b),this._registerEvents(),this._switchEvents("on",this),this.fire("add"))},_initRenderer:function(){var a=this.options.renderer;if(this.constructor.getRendererClass){var b=this.constructor.getRendererClass(a);if(!b)throw Error("Invalid renderer for Layer("+this.getId()+
        "):"+a);this._renderer=new b(this);this._renderer.layer=this;this._renderer.setZIndex(this.getZIndex());this._switchEvents("on",this._renderer)}},_doRemove:function(){if(this.onRemove)this.onRemove();this._switchEvents("off",this);this._removeEvents();this._renderer&&(this._switchEvents("off",this._renderer),this._renderer.remove(),delete this._renderer);delete this._mask;delete this.map},_switchEvents:function(a,b){if(b&&b.getEvents)this.getMap()[a](b.getEvents(),b)},_registerEvents:function(){this.getMap().on("_zoomend",
        this._refreshMask,this)},_removeEvents:function(){this.getMap().off("_zoomend",this._refreshMask,this)},_getRenderer:function(){return this._renderer},_getLayerList:function(){return this.map?this.map._layers:null}});c.Util.extend(c.Layer,c.Renderable);c.Layer.extend=function(a){a=c.Class.extend.call(this,a);this._regRenderers&&(a._regRenderers=c.Util.extend({},this._regRenderers));return a};c.TileLayer=c.Layer.extend({options:{errorTileUrl:null,urlTemplate:null,subdomains:null,gradualLoading:!0,
        repeatWorld:!0,renderWhenPanning:!1,updateInterval:c.Browser.mobile?-1:200,cssFilter:null,crossOrigin:null,tileSize:{width:256,height:256},tileSystem:null,debug:!1,cacheTiles:!0,keepBuffer:0,baseLayerRenderer:c.node?"canvas":"dom"},getTileSize:function(){var a=this.options.tileSize;return new c.Size(a.width,a.height)},clear:function(){this._renderer&&this._renderer.clear();this.fire("clear");return this},_initRenderer:function(){var a=this.options.renderer;this.getMap().getBaseLayer()===this&&(a=
        this.options.baseLayerRenderer,this.getMap()._getRenderer()._isCanvasContainer&&(a="canvas"));this.constructor.getRendererClass&&(a=this.constructor.getRendererClass(a))&&(this._renderer=new a(this),this._renderer.setZIndex(this.getZIndex()),this._switchEvents("on",this._renderer))},_initTileConfig:function(){var a=this.getMap();this._defaultTileConfig=new c.TileConfig(c.TileSystem.getDefault(a.getProjection()),a.getFullExtent(),this.getTileSize());this.options.tileSystem&&(this._tileConfig=new c.TileConfig(this.options.tileSystem,
        a.getFullExtent(),this.getTileSize()))},_getTileConfig:function(){this._defaultTileConfig||this._initTileConfig();var a=this._tileConfig;return a?a:(a=this.getMap())&&a.getBaseLayer()&&a.getBaseLayer()._getTileConfig?a.getBaseLayer()._getTileConfig():this._defaultTileConfig},_getTiles:function(){var a=this.getMap();if(!a||!this.isVisible())return null;var b=this._getTileConfig();if(!b)return null;var d=this.getTileSize(),e=a.getZoom(),f=a._getResolution(),g=a.offsetPlatform(),h=a.width,k=a.height,
        l=new c.Point(h/2,k/2),m=a.getContainerExtent(),n=b.getCenterTile(a._getPrjCenter(),f),p=new c.Point(h/2-n.offsetLeft,k/2-n.offsetTop),r=this.options.keepBuffer||0,h=Math.ceil(Math.abs(l.y-m.ymin-n.offsetTop)/d.height)+r,q=Math.ceil(Math.abs(l.x-m.xmin-n.offsetLeft)/d.width)+r,k=Math.ceil(Math.abs(m.ymax-l.y+n.offsetTop)/d.height)+r,l=Math.ceil(Math.abs(m.xmax-l.x+n.offsetLeft)/d.width)+r;p._substract(g)._round();g=[];m=new c.PointExtent;r=new c.PointExtent;for(q=-q;q<l;q++)for(var t=-h;t<k;t++){var u=
        b.getNeighorTileIndex(n.y,n.x,t,q,f,this.options.repeatWorld),w=this._getTileUrl(u.x,u.y,e),v=p.x+d.width*q,z=p.y+d.height*t,u=[u.y,u.x,e,v,z].join("__"),v=new c.Point(v,z),w={url:w,viewPoint:v,"2dPoint":a._viewPointToPoint(v),id:u,zoom:e};g.push(w);m=m.combine(new c.PointExtent(w.viewPoint,w.viewPoint.add(d.width,d.height)));r=r.combine(new c.PointExtent(w["2dPoint"],w["2dPoint"].add(d.width,d.height)))}g.sort(function(a,b){return b.viewPoint.distanceTo(p)-a.viewPoint.distanceTo(p)});return{tiles:g,
        fullExtent:r,viewExtent:m}},_getTileUrl:function(a,b,d){if(!this.options.urlTemplate)return this.options.errorTileUrl;var e=this.options.urlTemplate,f="";if(this.options.subdomains){var g=this.options.subdomains;c.Util.isArrayHasData(g)&&(f=(a+b)%g.length,0>f&&(f=0),f=g[f])}if(c.Util.isFunction(e))return e(a,b,d,f);var h={x:a,y:b,z:d,s:f};return e.replace(/\{ *([\w_]+) *\}/g,function(a,b){var c=h[b];if(void 0===c)throw Error("No value provided for variable "+a);"function"===typeof c&&(c=c(h));return c})}});
    c.TileLayer.prototype.toJSON=function(){return{type:"TileLayer",id:this.getId(),options:this.config()}};c.TileLayer.fromJSON=function(a){return a&&"TileLayer"===a.type?new c.TileLayer(a.id,a.options):null};c.CanvasTileLayer=c.TileLayer.extend({});c.CanvasTileLayer.prototype.toJSON=function(){return{type:"CanvasTileLayer",id:this.getId(),options:this.config()}};c.CanvasTileLayer.fromJSON=function(a){return a&&"CanvasTileLayer"===a.type?new c.CanvasTileLayer(a.id,a.options):null};c.OverlayLayer=c.Layer.extend({getGeometryById:function(a){return c.Util.isNil(a)||
    ""===a||!this._geoMap[a]?null:this._geoMap[a]},getGeometries:function(a,b){if(!a)return this._geoList.slice(0);for(var c=[],e,f,g=0,h=this._geoList.length;g<h;g++)e=this._geoList[g],(f=b?a.call(b,e):a(e))&&c.push(e);return c},getFirstGeometry:function(){return 0===this._geoList.length?null:this._geoList[0]},getLastGeometry:function(){var a=this._geoList.length;return 0===a?null:this._geoList[a-1]},getCount:function(){return this._geoList.length},getExtent:function(){if(0===this.getCount())return null;
        var a=new c.Extent;this.forEach(function(b){a._combine(b.getExtent())});return a},forEach:function(a,b){for(var c=this._geoList.slice(0),e=0,f=c.length;e<f;e++)b?a.call(b,c[e],e):a(c[e],e);return this},filter:function(a,b){var d=[];if(c.Util.isFunction(a))a&&this.forEach(function(c){(b?a.call(b,c):a(c))&&d.push(c)});else{var e=c.Util.createFilter(a);this.forEach(function(a){var b=c.Util.getFilterFeature(a);e(b)&&d.push(a)},this)}return 0<d.length?new c.GeometryCollection(d):null},isEmpty:function(){return 0===
        this._geoList.length},addGeometry:function(a,b){if(!a)return this;if(!c.Util.isArray(a)){var d=arguments.length,e=arguments[d-1];a=Array.prototype.slice.call(arguments,0,d-1);b=e;e instanceof c.Geometry&&(a.push(e),b=!1);return this.addGeometry(a,b)}if(!c.Util.isArrayHasData(a))return this;this._initCache();for(var d=0,e=new c.Coordinate(0,0),f=null,g,h,k,l=0,m=a.length;l<m;l++){g=a[l];if(!g)throw Error("Invalid geometry to add to layer("+this.getId()+") at index:"+l);g instanceof c.Geometry||(g=
        c.Geometry.fromJSON(g));h=g.getId();if(!c.Util.isNil(h)){if(!c.Util.isNil(this._geoMap[h]))throw Error("Duplicate geometry id in layer("+this.getId()+"):"+h+", at index:"+l);this._geoMap[h]=g}h=c.Util.UID();g._setInternalId(h);this._geoList.push(g);!0===b&&(h=g.getCenter(),k=g.getExtent(),h&&k&&(e._add(h),f=null==f?k:f._combine(k),d++));if(this.onAddGeometry)this.onAddGeometry(g);g._bindLayer(this);g._fireEvent("add",{layer:this})}this._sortGeometries();if(g=this.getMap())this._getRenderer().onGeometryAdd(a),
    b&&f&&(f=g.getFitZoom(f),d=e._multi(1/d),g.setCenterAndZoom(d,f));this.fire("addgeo",{geometries:a});return this},removeGeometry:function(a){if(!c.Util.isArray(a))return this.removeGeometry([a]);for(var b=a.length-1;0<=b;b--)a[b]instanceof c.Geometry||(a[b]=this.getGeometryById(a[b])),a[b]&&this===a[b].getLayer()&&a[b].remove();this.fire("removegeo",{geometries:a});return this},clear:function(){this._clearing=!0;this.forEach(function(a){a.remove()});this._geoMap={};this._geoList=[];this._clearing=
        !1;this.fire("clear");return this},onRemoveGeometry:function(a){if(a&&this===a.getLayer()){var b=a._getInternalId();if(!c.Util.isNil(b)&&(b=a.getId(),c.Util.isNil(b)||delete this._geoMap[b],this._clearing||(b=this._findInList(a),0<=b&&this._geoList.splice(b,1)),this._getRenderer()))this._getRenderer().onGeometryRemove([a])}},hide:function(){for(var a=0,b=this._geoList.length;a<b;a++)this._geoList[a].onHide();return c.Layer.prototype.hide.call(this)},identify:function(a,b){for(var d=this._geoList,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             e=b?b.filter:null,f,g=[],h=d.length-1;0<=h;h--){var k=d[h];if(k&&k.isVisible()&&k._getPainter()){if(!(k instanceof c.LineString&&k._getArrowStyle()||(f=k._getPainter().get2DExtent(),f&&f.contains(a))))continue;if(k._containsPoint(a)&&(!e||e(k))&&(g.push(k),b.count&&g.length>=b.count))break}}return g},_initCache:function(){this._geoList||(this._geoList=[],this._geoMap={})},_sortGeometries:function(){var a=this;this._geoList.sort(function(b,c){return a._compare(b,c)})},_compare:function(a,b){return a._zIndex===
    b._zIndex?a._getInternalId()-b._getInternalId():a._zIndex-b._zIndex},_findInList:function(a){var b=this._geoList.length;if(0===b)return-1;for(var c=0,b=b-1,e;c<=b;){e=Math.floor((c+b)/2);if(this._geoList[e]===a)return e;0<this._compare(this._geoList[e],a)?b=e-1:c=e+1}return-1},_onGeometryEvent:function(a){if(a&&a.target){var b=a.type;"idchange"===b?this._onGeometryIdChange(a):"zindexchange"===b?this._onGeometryZIndexChange(a):"positionchange"===b?this._onGeometryPositionChange(a):"shapechange"===
                b?this._onGeometryShapeChange(a):"symbolchange"===b?this._onGeometrySymbolChange(a):"show"===b?this._onGeometryShow(a):"hide"===b?this._onGeometryHide(a):"propertieschange"===b&&this._onGeometryPropertiesChange(a)}},_onGeometryIdChange:function(a){if(a["new"]!==a.old||!this._geoMap[a.old]||this._geoMap[a.old]!==a.target){if(!c.Util.isNil(a["new"])){if(this._geoMap[a["new"]])throw Error("Duplicate geometry id in layer("+this.getId()+"):"+a["new"]);this._geoMap[a["new"]]=a.target}c.Util.isNil(a.old)||
    a["new"]===a.old||delete this._geoMap[a.old]}},_onGeometryZIndexChange:function(a){if(a.old!==a["new"]&&(this._sortGeometries(),this._getRenderer()))this._getRenderer().onGeometryZIndexChange(a)},_onGeometryPositionChange:function(a){if(this._getRenderer())this._getRenderer().onGeometryPositionChange(a)},_onGeometryShapeChange:function(a){if(this._getRenderer())this._getRenderer().onGeometryShapeChange(a)},_onGeometrySymbolChange:function(a){if(this._getRenderer())this._getRenderer().onGeometrySymbolChange(a)},
        _onGeometryShow:function(a){if(this._getRenderer())this._getRenderer().onGeometryShow(a)},_onGeometryHide:function(a){if(this._getRenderer())this._getRenderer().onGeometryHide(a)},_onGeometryPropertiesChange:function(a){if(this._getRenderer())this._getRenderer().onGeometryPropertiesChange(a)}});c.OverlayLayer.addInitHook(function(){this._initCache()});c.VectorLayer=c.OverlayLayer.extend({options:{debug:!1,enableSimplify:!0,cursor:"pointer",geometryEvents:!0,thresholdOfTransforming:150,defaultIconSize:[20,
        20],cacheVectorOnCanvas:!0,cacheSvgOnCanvas:!1},initialize:function(a,b,d){!b||b instanceof c.Geometry||c.Util.isArray(b)||(d=b,b=null);d=c.Util.extend({},d);d.style&&(this.setStyle(d.style),delete d.style);c.Layer.prototype.initialize.call(this,a,d);b&&this.addGeometry(b)},getStyle:function(){return this._style?this._style:null},setStyle:function(a){this._style=a;this._cookedStyles=c.Util.compileStyle(a);this.forEach(function(a){this._styleGeometry(a)},this);this.fire("setstyle",{style:a});return this},
        removeStyle:function(){if(!this._style)return this;delete this._style;delete this._cookedStyles;this.forEach(function(a){a._setExternSymbol(null)},this);this.fire("removestyle");return this},onAddGeometry:function(a){this.getStyle()&&this._styleGeometry(a)},_styleGeometry:function(a){if(!this._cookedStyles)return!1;for(var b=c.Util.getFilterFeature(a),d=0,e=this._cookedStyles.length;d<e;d++)if(!0===this._cookedStyles[d].filter(b))return a._setExternSymbol(this._cookedStyles[d].symbol),!0;return!1},
        toJSON:function(a){a||(a={});var b={type:"VectorLayer",id:this.getId(),options:this.config()};(c.Util.isNil(a.style)||a.style)&&this.getStyle()&&(b.style=this.getStyle());if(c.Util.isNil(a.geometries)||a.geometries){var d;a.clipExtent&&(d=new c.Extent(a.clipExtent));for(var e=[],f=this.getGeometries(),g,h=0,k=f.length;h<k;h++)!(g=f[h].getExtent())||d&&!d.intersects(g)||(g=f[h].toJSON(a.geometries),g.symbol&&this.getStyle()&&(g.symbol=f[h]._symbolBeforeStyle?c.Util.extend({},f[h]._symbolBeforeStyle):
            null),e.push(g));b.geometries=e}return b}});c.VectorLayer.fromJSON=function(a){if(!a||"VectorLayer"!==a.type)return null;for(var b=new c.VectorLayer(a.id,a.options),d=a.geometries,e=[],f,g=0;g<d.length;g++)(f=c.Geometry.fromJSON(d[g]))&&e.push(f);b.addGeometry(e);a.style&&b.setStyle(a.style);return b};c.Geometry=c.Class.extend({includes:[c.Eventable,c.Handlerable],statics:{TYPE_POINT:"Point",TYPE_LINESTRING:"LineString",TYPE_POLYGON:"Polygon",TYPE_MULTIPOINT:"MultiPoint",TYPE_MULTILINESTRING:"MultiLineString",
        TYPE_MULTIPOLYGON:"MultiPolygon",TYPE_GEOMETRYCOLLECTION:"GeometryCollection"},options:{id:null,visible:!0,editable:!0,cursor:null,shadowBlur:0,shadowColor:"black",measure:"EPSG:4326"},getFirstCoordinate:function(){if(this instanceof c.GeometryCollection){var a=this.getGeometries();return a&&c.Util.isArrayHasData(a)?a[0].getFirstCoordinate():null}a=this.getCoordinates();if(!c.Util.isArray(a))return a;do a=a[0];while(c.Util.isArray(a));return a},getLastCoordinate:function(){if(this instanceof c.GeometryCollection){var a=
        this.getGeometries();return a&&c.Util.isArrayHasData(a)?a[a.length-1].getLastCoordinate():null}a=this.getCoordinates();if(!c.Util.isArray(a))return a;do a=a[a.length-1];while(c.Util.isArray(a));return a},addTo:function(a,b){a.addGeometry(this,b);return this},getLayer:function(){return this._layer?this._layer:null},getMap:function(){return this._layer?this._layer.getMap():null},getId:function(){return this._id},setId:function(a){var b=this.getId();this._id=a;this._fireEvent("idchange",{old:b,"new":a});
        return this},getProperties:function(){return this.properties?this.properties:this._getParent()?this._getParent().getProperties():null},setProperties:function(a){var b=this.properties;this.properties=c.Util.isObject(a)?c.Util.extend({},a):a;this._fireEvent("propertieschange",{old:b,"new":a});return this},getType:function(){return this.type},getSymbol:function(){var a=this._symbol;return a?c.Util.isArray(a)?c.Util.extendSymbol(a):c.Util.extend({},a):null},setSymbol:function(a){this._symbol=this._prepareSymbol(a);
        this.onSymbolChanged();return this},updateSymbol:function(a){if(!a)return this;var b=this.getSymbol(),b=b?c.Util.extendSymbol(b,a):c.Util.extendSymbol(this._getInternalSymbol(),a);return this.setSymbol(b)},getCenter:function(){return this._computeCenter(this._getMeasurer()).copy()},getExtent:function(){var a=this._getPrjExtent();if(a){var b=this._getProjection();return new c.Extent(b.unproject(new c.Coordinate(a.xmin,a.ymin)),b.unproject(new c.Coordinate(a.xmax,a.ymax)))}return this._computeExtent(this._getMeasurer())},
        getSize:function(){return this.getMap()?this._getPainter().get2DExtent().getSize():null},containsPoint:function(a,b){if(!this.getMap())throw Error('The geometry is required to be added on a map to perform "containsPoint".');a instanceof c.Coordinate&&(a=this.getMap().coordinateToContainerPoint(a));return this._containsPoint(this.getMap()._containerPointToPoint(new c.Point(a)),b)},show:function(){this.options.visible=!0;if(this.getMap()){var a=this._getPainter();a&&a.show();this._fireEvent("show")}return this},
        hide:function(){this.options.visible=!1;if(this.getMap()){this.onHide();var a=this._getPainter();a&&a.hide();this._fireEvent("hide")}return this},isVisible:function(){if(!this.options.visible)return!1;var a=this._getInternalSymbol();if(!a)return!0;if(c.Util.isArray(a)){if(0===a.length)return!0;for(var b=0,d=a.length;b<d;b++)if(c.Util.isNil(a[b].opacity)||0<a[b].opacity)return!0;return!1}return c.Util.isNil(a.opacity)||c.Util.isNumber(a.opacity)&&0<a.opacity},getZIndex:function(){return this._zIndex},
        setZIndex:function(a){var b=this._zIndex;this._zIndex=a;this._fireEvent("zindexchange",{old:b,"new":a});return this},setZIndexSilently:function(a){this._zIndex=a;return this},bringToFront:function(){var a=this.getLayer();if(!(a&&a instanceof c.OverlayLayer))return this;a=a.getLastGeometry().getZIndex();this.setZIndex(a+1);return this},bringToBack:function(){var a=this.getLayer();if(!(a&&a instanceof c.OverlayLayer))return this;a=a.getFirstGeometry().getZIndex();this.setZIndex(a-1);return this},translate:function(a){if(!a)return this;
            a=new c.Coordinate(a);if(0===a.x&&0===a.y)return this;var b=this.getCoordinates();b&&(c.Util.isArray(b)?(b=c.Util.mapArrayRecursively(b,function(b){return b.add(a)}),this.setCoordinates(b)):this.setCoordinates(b.add(a)));return this},flash:function(a,b,c,e){function f(){0===b?(g.show(),c&&(e?c.call(e):c())):(0===b%2?g.hide():g.show(),b--,g._flashTimeout=setTimeout(f,a))}a||(a=100);b||(b=4);var g=this;b*=2;this._flashTimeout&&clearTimeout(this._flashTimeout);this._flashTimeout=setTimeout(f,a);return this},
        copy:function(){var a=this.toJSON(),a=c.Geometry.fromJSON(a);a.options.visible=!0;return a},remove:function(){if(!this.getLayer())return this;this._fireEvent("removestart");this._unbind();this._fireEvent("removeend");this._fireEvent("remove");return this},toGeoJSONGeometry:function(){return this._exportGeoJSONGeometry()},toGeoJSON:function(a){a||(a={});var b={type:"Feature",geometry:null};if(c.Util.isNil(a.geometry)||a.geometry){var d=this._exportGeoJSONGeometry();b.geometry=d}d=this.getId();c.Util.isNil(d)||
        (b.id=d);var e;if(c.Util.isNil(a.properties)||a.properties)e=this._exportProperties();b.properties=e;return b},toJSON:function(a){a||(a={});var b=this._toJSON(a);a=this._exportGraphicOptions(a);c.Util.extend(b,a);return b},getLength:function(){return this._computeGeodesicLength(this._getMeasurer())},getArea:function(){return this._computeGeodesicArea(this._getMeasurer())},_getConnectPoints:function(){return[this.getCenter()]},_initOptions:function(a){a||(a={});var b=a.symbol,d=a.properties,e=a.id;
            c.Util.setOptions(this,a);delete this.options.symbol;delete this.options.id;delete this.options.properties;b&&this.setSymbol(b);d&&this.setProperties(d);c.Util.isNil(e)||this.setId(e);this._zIndex=0},_bindLayer:function(a){if(this.getLayer())throw Error("Geometry cannot be added to two or more layers at the same time.");this._layer=a;this._clearProjection()},_prepareSymbol:function(a){if(c.Util.isArray(a)){for(var b=[],d=0;d<a.length;d++)b.push(c.Util.convertResourceUrl(c.Util.extend({},a[d])));return b}return a?
            (a=c.Util.extend({},a),c.Util.convertResourceUrl(a)):null},_setExternSymbol:function(a){this._externSymbol=this._prepareSymbol(a);this.onSymbolChanged();return this},_getInternalSymbol:function(){return this._symbol?this._symbol:this._externSymbol?this._externSymbol:this.options.symbol?this.options.symbol:null},_getPrjExtent:function(){var a=this._getProjection();if(!this._extent&&a){var b=this._computeExtent(a);if(b){var d=this.options.antiMeridian&&c.MeasurerUtil.isSphere(a);if(d&&"default"!==d){var e=
            this.getFirstCoordinate();"continuous"===d&&180<b.xmax-b.xmin&&(0<e.x?b.xmin+=360:b.xmax-=360);b.xmax<b.xmin&&(d=b.xmax,b.xmax=b.xmin,b.xmin=d)}this._extent=new c.Extent(a.project(new c.Coordinate(b.xmin,b.ymin)),a.project(new c.Coordinate(b.xmax,b.ymax)))}}return this._extent},_unbind:function(){var a=this.getLayer();if(a)if(this._animPlayer)this._animPlayer.finish();else{this._unbindMenu();this._unbindInfoWindow();this.isEditing()&&this.endEdit();this._removePainter();if(this.onRemove)this.onRemove();
            if(a.onRemoveGeometry)a.onRemoveGeometry(this);delete this._layer;delete this._internalId;delete this._extent}},_getInternalId:function(){return this._internalId},_setInternalId:function(a){this._internalId=a},_getMeasurer:function(){return this._getProjection()?this._getProjection():c.MeasurerUtil.getInstance(this.options.measure)},_getProjection:function(){var a=this.getMap();return a&&a.getProjection()?a.getProjection():null},_getExternalResources:function(){var a=this._getInternalSymbol();return c.Util.getExternalResources(a)},
        _getPainter:function(){!this._painter&&this.getMap()&&(this._painter=this instanceof c.GeometryCollection?new c.CollectionPainter(this):new c.Painter(this));return this._painter},_removePainter:function(){this._painter&&this._painter.remove();delete this._painter},onHide:function(){this.closeMenu();this.closeInfoWindow()},onZoomEnd:function(){if(this._painter)this._painter.onZoomEnd()},onShapeChanged:function(){this._extent=null;var a=this._getPainter();a&&a.repaint();this._fireEvent("shapechange")},
        onPositionChanged:function(){this._extent=null;var a=this._getPainter();a&&a.repaint();this._fireEvent("positionchange")},onSymbolChanged:function(){var a=this._getPainter();a&&a.refreshSymbol();this._fireEvent("symbolchange")},onConfig:function(a){var b=!1,c;for(c in a)if(a.hasOwnProperty(c)){var e=c.slice(0,5);if("arrow"===e||"shado"===e){b=!0;break}}if(b)this.onShapeChanged()},_setParent:function(a){a&&(this._parent=a)},_getParent:function(){return this._parent},_fireEvent:function(a,b){this.getLayer()&&
        this.getLayer()._onGeometryEvent&&(b||(b={}),b.type=a,b.target=this,this.getLayer()._onGeometryEvent(b));this.fire(a,b)},_toJSON:function(a){return{feature:this.toGeoJSON(a)}},_exportGraphicOptions:function(a){var b={};if(c.Util.isNil(a.options)||a.options)b.options=this.config();if(c.Util.isNil(a.symbol)||a.symbol)b.symbol=this.getSymbol();(c.Util.isNil(a.infoWindow)||a.infoWindow)&&this._infoWinOptions&&(b.infoWindow=this._infoWinOptions);return b},_exportGeoJSONGeometry:function(){var a=this.getCoordinates(),
            a=c.GeoJSON.toNumberArrays(a);return{type:this.getType(),coordinates:a}},_exportProperties:function(){var a=null,b=this.getProperties();b&&c.Util.isObject(b)&&(a=c.Util.extend({},b));return a}});c.Geometry.fromJSON=function(a){if(c.Util.isArray(a)){for(var b=[],d,e=0,f=a.length;e<f;e++)d=c.Geometry.fromJSON(a[e]),c.Util.isArray(a)?b=b.concat(d):b.push(d);return b}if(a&&!a.feature)return c.GeoJSON.toGeometry(a);a.subType?(b=c[a.subType].fromJSON(a),c.Util.isNil(a.feature.id)||b.setId(a.feature.id)):
        (b=c.GeoJSON.toGeometry(a.feature),a.options&&b.config(a.options));a.symbol&&b.setSymbol(a.symbol);a.infoWindow&&b.setInfoWindow(a.infoWindow);return b};c.Geometry.getMarkerPathBase64=function(a){if(!a.markerPath)return null;var b=1,d=c.symbolizer.VectorMarkerSymbolizer.translateToSVGStyles(a);c.Util.isNumber(a.markerOpacity)&&(b=a.markerOpacity);c.Util.isNumber(a.opacity)&&(b*=a.opacity);var e,f={};if(d){for(e in d.stroke)d.stroke.hasOwnProperty(e)&&(c.Util.isNil(d.stroke[e])||(f[e]=d.stroke[e]));
        for(e in d.fill)d.fill.hasOwnProperty(e)&&(c.Util.isNil(d.fill[e])||(f[e]=d.fill[e]))}for(var g=c.Util.isArray(a.markerPath)?a.markerPath:[a.markerPath],h,k=[],d=0;d<g.length;d++)h=c.Util.isString(g[d])?{path:g[d]}:g[d],h=c.Util.extend({},h,f),h.d=h.path,delete h.path,k.push(h);f=['<svg version="1.1"','xmlns="http://www.w3.org/2000/svg"'];1>b&&f.push('opacity="'+b+'"');a.markerPathWidth&&a.markerPathHeight&&f.push('viewBox="0 0 '+a.markerPathWidth+" "+a.markerPathHeight+'"');f.push('preserveAspectRatio="none"');
        f.push("><defs></defs>");for(d=0;d<k.length;d++){a="<path ";for(e in k[d])k[d].hasOwnProperty(e)&&(a+=" "+e+'="'+k[d][e]+'"');a+="></path>";f.push(a)}f.push("</svg>");return"data:image/svg+xml;base64,"+c.Util.btoa(f.join(" "))};c.Geometry.include({startEdit:function(a){if(!this.getMap()||!this.options.editable)return this;this.endEdit();this._editor=new c.Geometry.Editor(this,a);this._editor.start();this.fire("editstart");return this},endEdit:function(){this._editor&&(this._editor.stop(),delete this._editor,
        this.fire("editend"));return this},isEditing:function(){return this._editor?this._editor.isEditing():!1}});c.Geometry.mergeOptions({draggable:!1,dragShadow:!0,dragOnAxis:null});c.Geometry.Drag=c.Handler.extend({dragStageLayerId:c.internalLayerPrefix+"_drag_stage",START:c.Browser.touch?["touchstart","mousedown"]:["mousedown"],addHooks:function(){this.target.on(this.START.join(" "),this._startDrag,this)},removeHooks:function(){this.target.off(this.START.join(" "),this._startDrag,this)},_startDrag:function(a){if(this.target.getMap()&&
        !this.target._getParent()&&!this.isDragging()){var b=a.domEvent;b.touches&&1<b.touches.length||(this.target.on("click",this._endDrag,this),this._lastPos=a.coordinate,this._prepareMap(),this._prepareDragHandler(),this._dragHandler.onMouseDown(a.domEvent),this._moved=!1,this.target._fireEvent("dragstart",a))}},_prepareMap:function(){var a=this.target.getMap();this._mapDraggable=a.options.draggable;this._mapHitDetect=a.options.hitDetect;a._trySetCursor("move");a.config({hitDetect:!1,draggable:!1})},
        _prepareDragHandler:function(){var a=this.target.getMap();this._dragHandler=new c.Handler.Drag(a._panels.mapWrapper||a._containerDOM);this._dragHandler.on("dragging",this._dragging,this);this._dragHandler.on("mouseup",this._endDrag,this);this._dragHandler.enable()},_prepareShadow:function(){var a=this.target;this._prepareDragStageLayer();var b=this._dragStageLayer._getRenderer().resources;this._shadow&&this._shadow.remove();this._shadow=a.copy();this._shadow.setSymbol(a._getInternalSymbol());var d=
            this._shadow;if(a.options.dragShadow){var e=c.Util.lowerSymbolOpacity(d._getInternalSymbol(),.5);d.setSymbol(e)}d.setId(null);e=[];if(c.ConnectorLine._hasConnectors(a))for(var f=c.ConnectorLine._getConnectors(a),g=0;g<f.length;g++){var h=f[g],k=h.config(),l=h._getInternalSymbol();k.symbol=c.Util.lowerSymbolOpacity(l,.5);k=h.getConnectSource()===a?new c.ConnectorLine(d,h.getConnectTarget(),k):new c.ConnectorLine(h.getConnectSource(),d,k);e.push(k);h.getLayer()&&h.getLayer()._getRenderer()&&b.merge(h.getLayer()._getRenderer().resources)}this._shadowConnectors=
            e;e.push(d);this._dragStageLayer.bringToFront().addGeometry(e)},_onTargetUpdated:function(){this._shadow&&this._shadow.setSymbol(this.target.getSymbol())},_prepareDragStageLayer:function(){var a=this.target.getMap(),b=this.target.getLayer();this._dragStageLayer=a.getLayer(this.dragStageLayerId);this._dragStageLayer||(this._dragStageLayer=new c.VectorLayer(this.dragStageLayerId,{drawImmediate:!0}),a.addLayer(this._dragStageLayer));a=new c.renderer.Canvas.Resources;a.merge(b._getRenderer().resources);
            this._dragStageLayer._getRenderer().resources=a},_dragging:function(a){var b=this.target;a=b.getMap()._parseEvent(a.domEvent);var c=a.domEvent;if(!(c.touches&&1<c.touches.length))if(!this._moved)this._moved=!0,b.on("symbolchange",this._onTargetUpdated,this),this._isDragging=!0,this._prepareShadow(),b.options.dragShadow||b.hide(),this._shadow._fireEvent("dragstart",a);else if(this._shadow){var c=this._shadow.options.dragOnAxis,e=a.coordinate;this._lastPos||(this._lastPos=e);var f=e.substract(this._lastPos);
            "x"===c?f.y=0:"y"===c&&(f.x=0);this._lastPos=e;this._shadow.translate(f);b.options.dragShadow||b.translate(f);a.dragOffset=f;this._shadow._fireEvent("dragging",a);b._fireEvent("dragging",a)}},_endDrag:function(a){var b=this.target,d=b.getMap();this._dragHandler&&(b.off("click",this._endDrag,this),this._dragHandler.disable(),delete this._dragHandler);if(d){var e;d&&(e=d._parseEvent(a.domEvent));b.off("symbolchange",this._onTargetUpdated,this);b.options.dragShadow||b.show();if(a=this._shadow)b.options.dragShadow&&
        b.setCoordinates(a.getCoordinates()),a._fireEvent("dragend",e),a.remove(),delete this._shadow;this._shadowConnectors&&(d.getLayer(this.dragStageLayerId).removeGeometry(this._shadowConnectors),delete this._shadowConnectors);delete this._lastPos;d._trySetCursor("default");c.Util.isNil(this._mapDraggable)&&(this._mapDraggable=!0);d.config({hitDetect:this._mapHitDetect,draggable:this._mapDraggable});delete this._autoBorderPanning;delete this._mapDraggable;this._dragStageLayer&&this._dragStageLayer.remove();
            this._isDragging=!1;b._fireEvent("dragend",e)}},isDragging:function(){return this._isDragging?!0:!1}});c.Geometry.addInitHook("addHandler","draggable",c.Geometry.Drag);c.Geometry.include({isDragging:function(){return this._getParent()?this._getParent().isDragging():this.draggable?this.draggable.isDragging():!1}});c.Geometry.include({_onEvent:function(a){if(this.getMap()){var b=this._getEventTypeToFire(a);"contextmenu"===b&&this.listens("contextmenu")&&(c.DomUtil.stopPropagation(a),c.DomUtil.preventDefault(a));
        a=this._getEventParams(a);this._fireEvent(b,a)}},_getEventTypeToFire:function(a){var b=a.type;"click"!==b&&"mousedown"!==b||2!==a.button||(b="contextmenu");return b},_getEventParams:function(a){var b=this.getMap(),d={domEvent:a};if(a=a.touches?a.touches[0]:a)a=c.DomUtil.getEventContainerPoint(a,b._containerDOM),d.coordinate=b.containerPointToCoordinate(a),d.containerPoint=a,d.viewPoint=b.containerPointToViewPoint(a),d.pont2d=b._containerPointToPoint(a);return d},_onMouseOver:function(a){this.getMap()&&
    (a=this._getEventParams(a),this._fireEvent("mouseover",a))},_onMouseOut:function(a){this.getMap()&&(a=this._getEventParams(a),this._fireEvent("mouseout",a))}});c.Geometry.include({animate:function(a,b,d){this._animPlayer&&this._animPlayer.finish();c.Util.isFunction(b)&&(d=b,b=null);var e=this.getMap(),f=this._getProjection(),g=this._getInternalSymbol();a=this._prepareAnimationStyles(a);var h,k;b&&(k=b.focus);delete this._animationStarted;var l=c.Animation.animate(a,b,c.Util.bind(function(a){if(!this._animationStarted&&
        k)e.onMoveStart();var b=a.styles,p;for(p in b)if("symbol"!==p&&"translate"!==p&&b.hasOwnProperty(p))this["set"+p[0].toUpperCase()+p.slice(1)](b[p]);if(p=b.translate){var r=p;h&&(r=p.substract(h));h=p;this.translate(r)}(b=b.symbol)&&this.setSymbol(c.Util.extendSymbol(g,b));if(k)if(b=f.project(this.getCenter()),e._setPrjCenterAndMove(b),"running"!==l.playState)e.onMoveEnd();else e.onMoving();this._fireAnimateEvent(l.playState);d&&d(a)},this));this._animPlayer=l;return this._animPlayer.play()},_prepareAnimationStyles:function(a){var b=
        this._getInternalSymbol(),d={},e;for(e in a)if(a.hasOwnProperty(e)){var f=a[e],g;if("translate"!==e&&"symbol"!==e){var h=this["get"+e[0].toUpperCase()+e.substring(1)]();d[e]=[h,f]}else if("symbol"===e){if(c.Util.isArray(a.symbol)){if(!c.Util.isArray(b))throw Error("geometry'symbol isn't a composite symbol, while the symbol in styles is.");for(var h=[],f=a.symbol,k=0;k<f.length;k++)if(f[k]){var l={};for(g in f[k])f[k].hasOwnProperty(g)&&(l[g]=[b[k][g],f[k][g]]);h.push(l)}else h.push(null)}else{if(c.Util.isArray(b))throw Error("geometry'symbol is a composite symbol, while the symbol in styles isn't.");
        h={};for(g in f)f.hasOwnProperty(g)&&(h[g]=[b[g],f[g]])}d.symbol=h}else"translate"===e&&(d.translate=new c.Coordinate(f))}return d},_fireAnimateEvent:function(a){"finished"===a?(delete this._animationStarted,this._fireEvent("animateend")):"running"===a&&(this._animationStarted?this._fireEvent("animating"):(this._fireEvent("animatestart"),this._animationStarted=!0))}});c.Vector=c.Geometry.extend({options:{symbol:{lineColor:"#000",lineWidth:2,lineOpacity:1,polygonFill:"#fff",polygonOpacity:1,opacity:1}},
        _hitTestTolerance:function(){var a=this._getInternalSymbol(),b;if(c.Util.isArray(a))for(var d=b=0;d<a.length;d++)c.Util.isNumber(a[d].lineWidth)&&a[d].lineWidth>b&&(b=a[d].lineWidth);else b=a.lineWidth;return b?b/2:1.5}});c.Geometry.Center={getCoordinates:function(){return this._coordinates},setCoordinates:function(a){a=new c.Coordinate(a);if(a.equals(this._coordinates))return this;this._coordinates=a;if(!this.getMap())return this.onPositionChanged(),this;a=this._getProjection();this._setPrjCoordinates(a.project(this._coordinates));
        return this},_getCenter2DPoint:function(){var a=this._getPrjCoordinates();if(!a)return null;var b=this.getMap();return b?b._prjToPoint(a):null},_getPrjCoordinates:function(){var a=this._getProjection();if(!a)return null;!this._pcenter&&this._coordinates&&(this._pcenter=a.project(this._coordinates));return this._pcenter},_setPrjCoordinates:function(a){this._pcenter=a;this.onPositionChanged()},_updateCache:function(){delete this._extent;var a=this._getProjection();this._pcenter&&a&&(this._coordinates=
        a.unproject(this._pcenter))},_clearProjection:function(){this._pcenter=null},_computeCenter:function(){return this._coordinates}};c.Geometry.Poly={_getPath2DPoints:function(a,b){var d=[];if(!c.Util.isArrayHasData(a))return d;var d=this.getMap(),e=d.getFullExtent(),f=this._getProjection(),g=this.options.antiMeridian&&c.MeasurerUtil.isSphere(f),h=d.options.clipFullExtent,k=!b&&this.getLayer()&&this.getLayer().options.enableSimplify,l=2*d._getResolution(),m=c.Util.isArray(a[0]);k&&!m&&(a=c.Simplify.simplify(a,
        l,!1));for(var n,p,r,q,t,u=[],w=[],v=u,k=0,l=a.length;k<l;k++)n=a[k],m?v.push(this._getPath2DPoints(n)):c.Util.isNil(n)||h&&!e.contains(n)||(0<k&&("continuous"===g||"split"===g)&&(r=f.unproject(n),"split"!==g&&p||(p=f.unproject(a[k-1])),p&&r&&(q=r.x-p.x,t=r.y-p.y,180<Math.abs(q)&&("continuous"===g?(p=r=this._anti(r,q),n=f.project(r)):"split"===g&&(0<q?(r=p.y+t*(p.x- -180)/(360-q)*(p.y>r.y?-1:1),v.push(d.coordinateToPoint(new c.Coordinate(-180,r))),v=v===u?w:u,v.push(d.coordinateToPoint(new c.Coordinate(180,
                    r)))):(r=p.y+t*(180-p.x)/(360+q)*(p.y>r.y?1:-1),v.push(d.coordinateToPoint(new c.Coordinate(180,r))),v=v===u?w:u,v.push(d.coordinateToPoint(new c.Coordinate(-180,r)))))))),v.push(d._prjToPoint(n)));return d=0<w.length?[u,w]:v},_anti:function(a,b){return 0<b?a.substract(360,0):a.add(360,0)},_setPrjCoordinates:function(a){this._prjCoords=a;this.onShapeChanged()},_getPrjCoordinates:function(){this._prjCoords||(this._prjCoords=this._projectCoords(this._coordinates));return this._prjCoords},_updateCache:function(){delete this._extent;
        this._getProjection()&&(this._prjCoords&&(this._coordinates=this._unprojectCoords(this._getPrjCoordinates())),this._prjHoles&&(this._holes=this._unprojectCoords(this._getPrjHoles())))},_clearProjection:function(){this._prjCoords=null;this._prjHoles&&(this._prjHoles=null)},_projectCoords:function(a){var b=this._getProjection();return b?b.projectCoords(a):null},_unprojectCoords:function(a){var b=this._getProjection();return b?b.unprojectCoords(a):null},_computeCenter:function(){var a=this._coordinates;
        if(!c.Util.isArrayHasData(a))return null;for(var b=0,d=0,e=0,f=a.length,g=0;g<f;g++)a[g]&&c.Util.isNumber(a[g].x)&&c.Util.isNumber(a[g].y)&&(b+=a[g].x,d+=a[g].y,e++);return new c.Coordinate(b/e,d/e)},_computeExtent:function(){var a=this._coordinates;if(!c.Util.isArrayHasData(a))return null;a=[a];this.hasHoles&&this.hasHoles()&&(a=a.concat(this.getHoles()));return this._computeCoordsExtent(a)},_computeCoordsExtent:function(a){for(var b=null,d=this.options.antiMeridian,e,f,g,h=0,k=a.length;h<k;h++)for(var l=
        0,m=a[h].length;l<m;l++)e=a[h][l],0<l&&d&&(g||(g=a[h][l-1]),f=e.x-g.x,180<Math.abs(f)&&(g=e=this._anti(e,f))),e=new c.Extent(e,e),b=e.combine(b);return b},_get2DLength:function(){for(var a=this._getPath2DPoints(this._getPrjCoordinates()),b=0,c=1,e=a.length;c<e;c++)b+=a[c].distanceTo(a[c-1]);return b}};c.Marker=c.Geometry.extend({includes:[c.Geometry.Center],type:c.Geometry.TYPE_POINT,options:{symbol:{markerType:"path",markerPath:[{path:"M8 23l0 0 0 0 0 0 0 0 0 0c-4,-5 -8,-10 -8,-14 0,-5 4,-9 8,-9l0 0 0 0c4,0 8,4 8,9 0,4 -4,9 -8,14z M5,9 a3,3 0,1,0,0,-0.9Z",
        fill:"#DE3333"}],markerPathWidth:16,markerPathHeight:23,markerWidth:24,markerHeight:34}},initialize:function(a,b){!a||a instanceof c.Coordinate||(a=new c.Coordinate(a));this._coordinates=a;this._initOptions(b)},_canEdit:function(){var a=this._getInternalSymbol();return c.Util.isArray(a)?!1:c.symbolizer.VectorMarkerSymbolizer.test(a)||c.symbolizer.VectorPathMarkerSymbolizer.test(a)||c.symbolizer.ImageMarkerSymbolizer.test(a)},_containsPoint:function(a){return this._getPainter().get2DExtent().contains(a)},
        _computeExtent:function(){var a=this.getCenter();return a?new c.Extent(a,a):null},_computeGeodesicLength:function(){return 0},_computeGeodesicArea:function(){return 0},_getSprite:function(a){return this._getPainter()?this._getPainter().getSprite(a):(new c.Painter(this)).getSprite(a)}});c.TextMarker=c.Marker.extend({options:{box:!0},defaultSymbol:{textFaceName:"monospace",textSize:12,textWrapBefore:!1,textWrapCharacter:"\n",textLineSpacing:8,textHorizontalAlignment:"middle",textVerticalAlignment:"middle",
        textOpacity:1,textDx:0,textDy:0},defaultBoxSymbol:{markerType:"square",markerLineColor:"#000",markerLineWidth:2,markerLineOpacity:1,markerFill:"#fff",markerOpacity:1},initialize:function(a,b,d){this._content=a;this._coordinates=new c.Coordinate(b);this._initOptions(d);this._registerEvents();this._refresh()},getContent:function(){return this._content},setContent:function(a){var b=this._content;this._content=a;this._refresh();this._fireEvent("contentchange",{old:b,"new":a});return this},getSymbol:function(){return this._textSymbolChanged?
        c.Geometry.prototype.getSymbol.call(this):null},setSymbol:function(a){a&&a!==this.options.symbol?this._textSymbolChanged=!0:(this._textSymbolChanged=!1,a={});a=this._prepareSymbol(a);var b=this._getDefaultTextSymbol();c.Util.extend(b,a);this._symbol=b;this._refresh();return this},onConfig:function(a){var b=!1,d;for(d in a)if(a.hasOwnProperty(d)&&"box"===d.slice(0,3)){b=!0;break}b&&this._refresh();return c.Marker.prototype.onConfig.apply(this,arguments)},_getBoxSize:function(a){a.markerType||(a.markerType=
        "square");a=c.StringUtil.splitTextToRow(this._content,a).size;var b,d;this.options.boxAutoSize&&(d=this.options.boxPadding,b=a.width+2*d.width,d=a.height+2*d.height);this.options.boxMinWidth&&(!b||b<this.options.boxMinWidth)&&(b=this.options.boxMinWidth);this.options.boxMinHeight&&(!d||d<this.options.boxMinHeight)&&(d=this.options.boxMinHeight);return[b&&d?new c.Size(b,d):null,a]},_getInternalSymbol:function(){return this._symbol},_getDefaultTextSymbol:function(){var a={};c.Util.extend(a,this.defaultSymbol);
        this.options.box&&c.Util.extend(a,this.defaultBoxSymbol);return a},_registerEvents:function(){this.on("shapechange",this._refresh,this)},onRemove:function(){this.off("shapechange",this._refresh,this)}});c.Label=c.TextMarker.extend({options:{boxAutoSize:!0,boxMinWidth:0,boxMinHeight:0,boxPadding:{width:12,height:8},boxTextAlign:"middle"},_toJSON:function(a){return{feature:this.toGeoJSON(a),subType:"Label",content:this._content}},_refresh:function(){var a=this.getSymbol()||this._getDefaultTextSymbol();
        a.textName=this._content;if(this.options.box){var b=this._getBoxSize(a),d=b[0],b=b[1],e=this.options.boxPadding;d||a.markerWidth||a.markerHeight?d&&(a.markerWidth=d.width,a.markerHeight=d.height):(d=new c.Size(b.width+2*e.width,b.height+2*e.height),a.markerWidth=d.width,a.markerHeight=d.height);if(d=this.options.boxTextAlign){var f=c.StringUtil.getAlignPoint(b,a.textHorizontalAlignment,a.textVerticalAlignment),f=f._add(a.textDx||0,a.textDy||0);a.markerDx=f.x;a.markerDy=f.y+b.height/2;a.markerDx="left"===
        d?a.markerDx+(a.markerWidth/2-e.width):"right"===d?a.markerDx-(a.markerWidth/2-b.width-e.width):a.markerDx+b.width/2}}this._symbol=a;this.onSymbolChanged()}});c.Label.fromJSON=function(a){var b=a.feature;a=new c.Label(a.content,b.geometry.coordinates,a.options);a.setProperties(b.properties);a.setId(b.id);return a};c.TextBox=c.TextMarker.extend({options:{boxAutoSize:!1,boxMinWidth:0,boxMinHeight:0,boxPadding:{width:12,height:8}},_toJSON:function(a){return{feature:this.toGeoJSON(a),subType:"TextBox",
        content:this._content}},_refresh:function(){var a=this.getSymbol()||this._getDefaultTextSymbol();a.textName=this._content;var b=this._getBoxSize(a),d=b[0],b=b[1];d||a.markerWidth||a.markerHeight?d&&(a.markerWidth=d.width,a.markerHeight=d.height):(d=this.options.boxPadding,d=new c.Size(b.width+2*d.width,b.height+2*d.height),a.markerWidth=d.width,a.markerHeight=d.height);if(d=a.textHorizontalAlignment)a.textDx=a.markerDx||0,"left"===d?a.textDx-=a.markerWidth/2:"right"===d&&(a.textDx+=a.markerWidth/
            2);if(d=a.textVerticalAlignment)a.textDy=a.markerDy||0,"top"===d?a.textDy-=a.markerHeight/2:"bottom"===d&&(a.textDy+=a.markerHeight/2);this._symbol=a;this.onSymbolChanged()},_getInternalSymbol:function(){var a=c.Util.extend({},this._symbol);"left"===a.textHorizontalAlignment?a.textHorizontalAlignment="right":"right"===a.textHorizontalAlignment&&(a.textHorizontalAlignment="left");"top"===a.textVerticalAlignment?a.textVerticalAlignment="bottom":"bottom"===a.textVerticalAlignment&&(a.textVerticalAlignment=
            "top");return a}});c.TextBox.fromJSON=function(a){var b=a.feature;a=new c.TextBox(a.content,b.geometry.coordinates,a.options);a.setProperties(b.properties);a.setId(b.id);return a};c.Polygon=c.Vector.extend({includes:[c.Geometry.Poly],type:c.Geometry.TYPE_POLYGON,options:{antiMeridian:"continuous"},initialize:function(a,b){this.setCoordinates(a);this._initOptions(b)},setCoordinates:function(a){if(!a)return this._holes=this._coordinates=null,this._projectRings(),this;a=c.GeoJSON.toCoordinates(a);var b=
        a.length;if(c.Util.isArray(a[0])){if(this._coordinates=this._trimRing(a[0]),1<b){for(var d=[],e=1;e<b;e++)a[e]&&d.push(this._trimRing(a[e]));this._holes=d}}else this._coordinates=this._trimRing(a);this._projectRings();return this},getCoordinates:function(){if(!this._coordinates)return[];if(c.Util.isArrayHasData(this._holes)){for(var a=[],b=0;b<this._holes.length;b++)a.push(this._closeRing(this._holes[b]));return[this._closeRing(this._coordinates)].concat(a)}return[this._closeRing(this._coordinates)]},
        getShell:function(){return this._coordinates},getHoles:function(){return this.hasHoles()?this._holes:null},hasHoles:function(){return c.Util.isArrayHasData(this._holes)&&c.Util.isArrayHasData(this._holes[0])?!0:!1},_projectRings:function(){this.getMap()&&(this._prjCoords=this._projectCoords(this._coordinates),this._prjHoles=this._projectCoords(this._holes));this.onShapeChanged()},_cleanRing:function(a){for(var b=a.length-1;0<=b;b--)a[b]||a.splice(b,1)},_checkRing:function(a){this._cleanRing(a);if(!a||
            !c.Util.isArrayHasData(a))return!1;var b=a[a.length-1],d=!0;if(a[0].x!==b.x||a[0].y!==b.y)d=!1;return d},_trimRing:function(a){var b=this._checkRing(a);return c.Util.isArrayHasData(a)&&b?a.slice(0,a.length-1):a},_closeRing:function(a){var b=this._checkRing(a);return c.Util.isArrayHasData(a)&&!b?a.concat([new c.Coordinate(a[0].x,a[0].y)]):a},_getPrjHoles:function(){this._prjHoles||(this._prjHoles=this._projectCoords(this._holes));return this._prjHoles},_computeGeodesicLength:function(a){var b=this.getCoordinates();
            if(!c.Util.isArrayHasData(b))return 0;for(var d=0,e=0,f=b.length;e<f;e++)d+=c.GeoUtil._computeLength(b[e],a);return d},_computeGeodesicArea:function(a){var b=this.getCoordinates();if(!c.Util.isArrayHasData(b))return 0;for(var d=a.measureArea(b[0]),e=1,f=b.length;e<f;e++)d-=a.measureArea(b[e]);return d},_containsPoint:function(a,b){function d(b){var d=c.GeoUtil.pointInsidePolygon(a,b);if(d)return d;var f,g,n=b.length,d=0;for(f=n-1;d<n;f=d++)if(g=b[d],f=b[f],c.GeoUtil.distanceToSegment(a,g,f)<=e)return!0;
            return!1}var e=c.Util.isNil(b)?this._hitTestTolerance():b;if(!this._getPainter().get2DExtent().expand(e).contains(a))return!1;var f=this._getPath2DPoints(this._getPrjCoordinates());if(c.Util.isArray(f[0])){for(var g=0;g<f.length;g++)if(d(f[g]))return!0;return!1}return d(f)}});c.LineString=c.Polyline=c.Vector.extend({includes:[c.Geometry.Poly],type:c.Geometry.TYPE_LINESTRING,options:{antiMeridian:"continuous",arrowStyle:null,arrowPlacement:"vertex-last"},initialize:function(a,b){this.setCoordinates(a);
        this._initOptions(b)},setCoordinates:function(a){if(!a)return this._coordinates=null,this._setPrjCoordinates(null),this;this._coordinates=c.GeoJSON.toCoordinates(a);if(this.getMap())this._setPrjCoordinates(this._projectCoords(this._coordinates));else this.onShapeChanged();return this},getCoordinates:function(){return this._coordinates?this._coordinates:[]},animateShow:function(a){a||(a={});var b=this.getCoordinates(),d=a.duration||1E3,e=this.getLength();a=a.easing||"out";this.setCoordinates([]);var f=
        c.Animation.animate({t:d},{speed:d,easing:a},c.Util.bind(function(a){this.getMap()?this._drawAnimFrame(a.styles.t,d,e,b):(f.finish(),this.setCoordinates(b))},this));f.play();return this},_drawAnimFrame:function(a,b,d,e){if(0===a)this.setCoordinates([]);else{var f=this.getMap();a=a/b*d;this._animIdx||(this._animLenSoFar=this._animIdx=0,this.show());var g;b=0;d=this._animIdx;for(g=e.length;d<g-1;d++){b=f.computeLength(e[d],e[d+1]);if(this._animLenSoFar+b>a)break;this._animLenSoFar+=b}this._animIdx=
        d;this._animIdx>=g-1||(d=this._animIdx,f=e[d],d=e[d+1],a=(a-this._animLenSoFar)/b,f=new c.Coordinate(f.x+(d.x-f.x)*a,f.y+(d.y-f.y)*a),e=e.slice(0,this._animIdx+1),e.push(f));this.setCoordinates(e)}},_computeGeodesicLength:function(a){return c.GeoUtil._computeLength(this.getCoordinates(),a)},_computeGeodesicArea:function(){return 0},_containsPoint:function(a,b){function d(b){var d,f,g,h=b.length;d=0;for(h=b.length;d<h-1;d++)if(f=b[d],g=b[d+1],c.GeoUtil.distanceToSegment(a,f,g)<=e)return!0;return!1}
        var e=c.Util.isNil(b)?this._hitTestTolerance():b;2>e&&(e=2);var f=this._getArrowStyle(),g=this._getInternalSymbol().lineWidth,h=this.getMap(),k=this._getPrjExtent(),l=new c.Coordinate(k.xmin,k.ymax),k=new c.Coordinate(k.xmax,k.ymin),l=h._prjToPoint(l),h=h._prjToPoint(k),h=new c.PointExtent(l.x-e,l.y-e,h.x+e,h.y+e);f&&h._expand(Math.max(f[0]*g,f[1]*g));if(!h.contains(a))return!1;var m;if(this._getArrowStyle())for(m=this._getPath2DPoints(this._getPrjCoordinates(),!0),f=this._getArrows(m,g,(b?b:2)+g/
            2),g=f.length-1;0<=g;g--)if(c.GeoUtil.pointInsidePolygon(a,f[g]))return!0;m=m||this._getPath2DPoints(this._getPrjCoordinates());if(0<m.length&&c.Util.isArray(m[0])){f=0;for(g=m.length;f<g;f++)if(d(m[f]))return!0;return!1}return d(m)}});c.Curve=c.LineString.extend({_arc:function(a,b,d){for(var e=this.options.arcDegree*Math.PI/180,f=1,g=b.length;f<g;f++)c.Canvas._arcBetween(a,b[f-1],b[f],e),c.Canvas._stroke(a,d)},_quadraticCurve:function(a,b){2>=b.length?c.Canvas._path(a,b):c.Canvas.quadraticCurve(a,
            b)},_getCubicCurvePoints:function(a){for(var b=[],c=0,e=0,f=0,g,h,k=a[0],l=1,m=a.length;l<m;l++)h=a[l],(g=a[l+1])?(c=(g.y-k.y)/(g.x-k.x),g=-.3*(g.x-h.x),c=g*c*.6):c=g=0,b.push(k.x-e,k.y-f,h.x+g,h.y+c,h.x,h.y),e=g,f=c,k=h;return b},_bezierCurve:function(a,b){if(2>=b.length)c.Canvas._path(a,b);else{var d=this._getCubicCurvePoints(b),e,f=d.length;for(e=0;e<f;e+=6)a.bezierCurveTo(d[e],d[e+1],d[e+2],d[e+3],d[e+4],d[e+5])}}});c.ArcCurve=c.Curve.extend({options:{arcDegree:90},_toJSON:function(a){return{feature:this.toGeoJSON(a),
        subType:"ArcCurve"}},_paintOn:function(a,b,d){a.beginPath();this._arc(a,b,d);c.Canvas._stroke(a,d);this._paintArrow(a,b,d)}});c.ArcCurve.fromJSON=function(a){var b=a.feature;a=new c.ArcCurve(b.geometry.coordinates,a.options);a.setProperties(b.properties);return a};c.QuadBezierCurve=c.Curve.extend({_toJSON:function(a){return{feature:this.toGeoJSON(a),subType:"QuadBezierCurve"}},_paintOn:function(a,b,d){a.beginPath();a.moveTo(b[0].x,b[0].y);this._quadraticCurve(a,b,d);c.Canvas._stroke(a,d);this._paintArrow(a,
        b,d)},_getArrowPlacement:function(){var a=this.options.arrowPlacement;"point"===a&&(a="vertex-last");return a}});c.QuadBezierCurve.fromJSON=function(a){var b=a.feature;a=new c.QuadBezierCurve(b.geometry.coordinates,a.options);a.setProperties(b.properties);return a};c.CubicBezierCurve=c.Curve.extend({_toJSON:function(a){return{feature:this.toGeoJSON(a),subType:"CubicBezierCurve"}},_paintOn:function(a,b,d){a.beginPath();a.moveTo(b[0].x,b[0].y);this._bezierCurve(a,b,d);c.Canvas._stroke(a,d);this._paintArrow(a,
        b,d)}});c.CubicBezierCurve.fromJSON=function(a){var b=a.feature;a=new c.CubicBezierCurve(b.geometry.coordinates,a.options);a.setProperties(b.properties);return a};(function(){var a={initialize:function(a,c,e){1===arguments.length&&(e=a,c=a=null);this._connSource=a;this._connTarget=c;this._initOptions(e);this._registEvents()},getConnectSource:function(){return this._connSource},setConnectSource:function(a){var c=this._connTarget;this.onRemove();this._connSource=a;this._connTarget=c;this._updateCoordinates();
        this._registEvents();return this},getConnectTarget:function(){return this._connTarget},setConnectTarget:function(a){var c=this._connSource;this.onRemove();this._connSource=c;this._connTarget=a;this._updateCoordinates();this._registEvents();return this},_updateCoordinates:function(){var a=this.getMap();!a&&this._connSource&&(a=this._connSource.getMap());!a&&this._connTarget&&(a=this._connTarget.getMap());if(a&&this._connSource&&this._connTarget){for(var d=this._connSource._getConnectPoints(),e=this._connTarget._getConnectPoints(),
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 f=0,g=this.getCoordinates(),h,k,l=0,m=d.length;l<m;l++)for(var n=d[l],p=0,r=e.length;p<r;p++){var q=e[p],t=a.computeLength(n,q);0===l&&0===p?(h=n,k=q,f=t):t<f&&(h=n,k=q)}c.Util.isArrayHasData(g)&&g[0].equals(h)&&g[1].equals(k)||this.setCoordinates([h,k])}},onRemove:function(){this._connSource&&(this._connSource.__connectors&&c.Util.removeFromArray(this,this._connSource.__connectors),this._connSource.off("dragging positionchange",this._updateCoordinates,this).off("remove",this.onRemove,this),this._connSource.off("dragstart mousedown mouseover",
        this._showConnect,this),this._connSource.off("dragend mouseup mouseout",this.hide,this),this._connSource.off("show",this._showConnect,this).off("hide",this.hide,this),delete this._connSource);this._connTarget&&(c.Util.removeFromArray(this,this._connTarget.__connectors),this._connTarget.off("dragging positionchange",this._updateCoordinates,this).off("remove",this.onRemove,this),this._connTarget.off("show",this._showConnect,this).off("hide",this.hide,this),delete this._connTarget)},_showConnect:function(){this._connSource&&
    this._connTarget&&(this._connSource instanceof c.control.Control||this._connSource.isVisible())&&(this._connTarget instanceof c.control.Control||this._connTarget.isVisible())&&(this._updateCoordinates(),this.show())},_registEvents:function(){if(this._connSource&&this._connTarget){this._connSource.__connectors||(this._connSource.__connectors=[]);this._connTarget.__connectors||(this._connTarget.__connectors=[]);this._connSource.__connectors.push(this);this._connTarget.__connectors.push(this);this._connSource.on("dragging positionchange",
        this._updateCoordinates,this).on("remove",this.remove,this);this._connTarget.on("dragging positionchange",this._updateCoordinates,this).on("remove",this.remove,this);this._connSource.on("show",this._showConnect,this).on("hide",this.hide,this);this._connTarget.on("show",this._showConnect,this).on("hide",this.hide,this);var a=this.options.showOn;this.hide();"moving"===a?(this._connSource.on("dragstart",this._showConnect,this).on("dragend",this.hide,this),this._connTarget.on("dragstart",this._showConnect,
            this).on("dragend",this.hide,this)):"click"===a?(this._connSource.on("mousedown",this._showConnect,this).on("mouseup",this.hide,this),this._connTarget.on("mousedown",this._showConnect,this).on("mouseup",this.hide,this)):"mouseover"===a?(this._connSource.on("mouseover",this._showConnect,this).on("mouseout",this.hide,this),this._connTarget.on("mouseover",this._showConnect,this).on("mouseout",this.hide,this)):this._showConnect()}}};c.ConnectorLine=c.LineString.extend({includes:[a],options:{showOn:"always"}});
        c.Util.extend(c.ConnectorLine,{_hasConnectors:function(a){return!c.Util.isNil(a.__connectors)&&0<a.__connectors.length},_getConnectors:function(a){return a.__connectors}});c.ArcConnectorLine=c.ArcCurve.extend({includes:[a],options:{showOn:"always"}})})();c.Ellipse=c.Polygon.extend({includes:[c.Geometry.Center],options:{numberOfShellPoints:60},initialize:function(a,b,d,e){this._coordinates=new c.Coordinate(a);this.width=b;this.height=d;this._initOptions(e)},getWidth:function(){return this.width},setWidth:function(a){this.width=
        a;this.onShapeChanged();return this},getHeight:function(){return this.height},setHeight:function(a){this.height=a;this.onShapeChanged();return this},getShell:function(){for(var a=this._getMeasurer(),b=this.getCoordinates(),c=this.options.numberOfShellPoints,e=this.getWidth(),f=this.getHeight(),g=[],h=Math.pow(e/2,2)*Math.pow(f/2,2),e=Math.pow(e/2,2),f=Math.pow(f/2,2),k,l,m,n=0;n<c;n++)k=360*n/c,l=k*Math.PI/180,m=Math.sqrt(h/(e*Math.pow(Math.tan(l),2)+f)),l=Math.sqrt(h/(f*Math.pow(1/Math.tan(l),2)+
        e)),90<k&&270>k&&(m*=-1),180<k&&360>k&&(l*=-1),k=a.locate(b,m,l),g.push(k);return g},getHoles:function(){return null},_containsPoint:function(a,b){var d=this.getMap(),e=c.Util.isNil(b)?this._hitTestTolerance():b,f=d.distanceToPixel(this.width/2,0),d=d.distanceToPixel(0,this.height/2),f=f.width,d=d.height,g=Math.sqrt(Math.abs(f*f-d*d)),h=f>=d,k=this._getCenter2DPoint();h?(h=new c.Point(k.x-g,k.y),g=new c.Point(k.x+g,k.y),f*=2):(h=new c.Point(k.x,k.y-g),g=new c.Point(k.x,k.y+g),f=2*d);a=new c.Point(a.x,
        a.y);return a.distanceTo(h)+a.distanceTo(g)<=f+2*e},_computeExtent:function(a){if(!a||!this._coordinates||c.Util.isNil(this.width)||c.Util.isNil(this.height))return null;var b=this.getWidth(),d=this.getHeight(),e=a.locate(this._coordinates,b/2,d/2);a=a.locate(this._coordinates,-b/2,-d/2);return new c.Extent(e,a)},_computeGeodesicLength:function(){return c.Util.isNil(this.width)||c.Util.isNil(this.height)?0:2*Math.PI*(this.width>this.height?this.width:this.height)/2-4*Math.abs(this.width-this.height)},
        _computeGeodesicArea:function(){return c.Util.isNil(this.width)||c.Util.isNil(this.height)?0:Math.PI*this.width*this.height/4},_exportGeoJSONGeometry:function(){return{type:"Polygon",coordinates:c.GeoJSON.toNumberArrays([this.getShell()])}},_toJSON:function(a){var b=c.Util.extend({},a);a=this.getCenter();b.geometry=!1;b=this.toGeoJSON(b);b.geometry={type:"Polygon"};return{feature:b,subType:"Ellipse",coordinates:[a.x,a.y],width:this.getWidth(),height:this.getHeight()}}});c.Ellipse.fromJSON=function(a){var b=
        a.feature;a=new c.Ellipse(a.coordinates,a.width,a.height,a.options);a.setProperties(b.properties);return a};c.Circle=c.Polygon.extend({includes:[c.Geometry.Center],options:{numberOfShellPoints:60},initialize:function(a,b,d){this._coordinates=new c.Coordinate(a);this._radius=b;this._initOptions(d)},getRadius:function(){return this._radius},setRadius:function(a){this._radius=a;this.onShapeChanged();return this},getShell:function(){for(var a=this._getMeasurer(),b=this.getCoordinates(),c=this.options.numberOfShellPoints,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                 e=this.getRadius(),f=[],g,h,k=0;k<c;k++)g=360*k/c*Math.PI/180,h=e*Math.cos(g),g=e*Math.sin(g),h=a.locate(b,h,g),f.push(h);return f},getHoles:function(){return null},_containsPoint:function(a,b){var d=this._getCenter2DPoint(),e=this.getSize(),f=c.Util.isNil(b)?this._hitTestTolerance():b;return d.distanceTo(a)<=e.width/2+f},_computeExtent:function(a){if(!a||!this._coordinates||c.Util.isNil(this._radius))return null;var b=this._radius,d=a.locate(this._coordinates,b,b);a=a.locate(this._coordinates,-b,
        -b);return new c.Extent(d,a)},_computeGeodesicLength:function(){return c.Util.isNil(this._radius)?0:2*Math.PI*this._radius},_computeGeodesicArea:function(){return c.Util.isNil(this._radius)?0:Math.PI*Math.pow(this._radius,2)},_exportGeoJSONGeometry:function(){return{type:"Polygon",coordinates:c.GeoJSON.toNumberArrays([this.getShell()])}},_toJSON:function(a){var b=this.getCenter();a=c.Util.extend({},a);a.geometry=!1;a=this.toGeoJSON(a);a.geometry={type:"Polygon"};return{feature:a,subType:"Circle",
        coordinates:[b.x,b.y],radius:this.getRadius()}}});c.Circle.fromJSON=function(a){var b=a.feature;a=new c.Circle(a.coordinates,a.radius,a.options);a.setProperties(b.properties);return a};c.Sector=c.Polygon.extend({includes:[c.Geometry.Center],options:{numberOfShellPoints:60},initialize:function(a,b,d,e,f){this._coordinates=new c.Coordinate(a);this._radius=b;this.startAngle=d;this.endAngle=e;this._initOptions(f)},getRadius:function(){return this._radius},setRadius:function(a){this._radius=a;this.onShapeChanged();
        return this},getStartAngle:function(){return this.startAngle},setStartAngle:function(a){this.startAngle=a;this.onShapeChanged();return this},getEndAngle:function(){return this.endAngle},setEndAngle:function(a){this.endAngle=a;this.onShapeChanged();return this},getShell:function(){for(var a=this._getMeasurer(),b=this.getCoordinates(),c=this.options.numberOfShellPoints,e=this.getRadius(),f=[],g=this.getEndAngle()-this.getStartAngle(),h,k,l=0;l<c;l++)h=(g*l/(c-1)+this.getStartAngle())*Math.PI/180,k=
        e*Math.cos(h),h=e*Math.sin(h),k=a.locate(b,k,h),f.push(k);return f},getHoles:function(){return null},_containsPoint:function(a,b){var d=this._getCenter2DPoint(),e=c.Util.isNil(b)?this._hitTestTolerance():b,f=this.getSize(),g=Math.atan2(d.y-a.y,a.x-d.x),g=0>g?360*(g+2*Math.PI)/(2*Math.PI):360*g/(2*Math.PI),h=this.startAngle%360,k=this.endAngle%360,l=!1,l=h>k?!(g>k&&g<h):g>=h&&g<=k;return a.distanceTo(d)<=f.width/2+e&&l},_computeExtent:function(a){if(!a||!this._coordinates||c.Util.isNil(this._radius))return null;
        var b=this._radius,d=a.locate(this._coordinates,b,b);a=a.locate(this._coordinates,-b,-b);return new c.Extent(d,a)},_computeGeodesicLength:function(){return c.Util.isNil(this._radius)?0:2*Math.PI*this._radius*Math.abs(this.startAngle-this.endAngle)/360+2*this._radius},_computeGeodesicArea:function(){return c.Util.isNil(this._radius)?0:Math.PI*Math.pow(this._radius,2)*Math.abs(this.startAngle-this.endAngle)/360},_exportGeoJSONGeometry:function(){return{type:"Polygon",coordinates:c.GeoJSON.toNumberArrays([this.getShell()])}},
        _toJSON:function(a){var b=c.Util.extend({},a);a=this.getCenter();b.geometry=!1;b=this.toGeoJSON(b);b.geometry={type:"Polygon"};return{feature:b,subType:"Sector",coordinates:[a.x,a.y],radius:this.getRadius(),startAngle:this.getStartAngle(),endAngle:this.getEndAngle()}}});c.Sector.fromJSON=function(a){var b=a.feature;a=new c.Sector(a.coordinates,a.radius,a.startAngle,a.endAngle,a.options);a.setProperties(b.properties);return a};c.Rectangle=c.Polygon.extend({initialize:function(a,b,d,e){this._coordinates=
        new c.Coordinate(a);this._width=b;this._height=d;this._initOptions(e)},getCoordinates:function(){return this._coordinates},setCoordinates:function(a){this._coordinates=new c.Coordinate(a);if(!this._coordinates||!this.getMap())return this.onPositionChanged(),this;a=this._getProjection();this._setPrjCoordinates(a.project(this._coordinates));return this},getWidth:function(){return this._width},setWidth:function(a){this._width=a;this.onShapeChanged();return this},getHeight:function(){return this._height},
        setHeight:function(a){this._height=a;this.onShapeChanged();return this},getShell:function(){var a=this._getMeasurer(),b=this._coordinates,c=this.getMap(),e=-1;c&&(c=c.getFullExtent(),c.bottom>c.top&&(e=1));c=[];c.push(b);c.push(a.locate(b,this._width,0));c.push(a.locate(b,this._width,e*this._height));c.push(a.locate(b,0,e*this._height));c.push(b);return c},getHoles:function(){return null},_getPrjCoordinates:function(){var a=this._getProjection();if(!a)return null;!this._pnw&&this._coordinates&&(this._pnw=
            a.project(this._coordinates));return this._pnw},_setPrjCoordinates:function(a){this._pnw=a;this.onPositionChanged()},_updateCache:function(){delete this._extent;var a=this._getProjection();this._pnw&&a&&(this._coordinates=a.unproject(this._pnw))},_clearProjection:function(){this._pnw=null},_computeCenter:function(a){return a.locate(this._coordinates,this._width/2,-this._height/2)},_containsPoint:function(a,b){var d=this.getMap(),e=c.Util.isNil(b)?this._hitTestTolerance():b,f=d.coordinateToPoint(this._coordinates),
            g=d.distanceToPixel(this._width,this._height),d=new c.Point(f.x,f.y),f=new c.Point(f.x+g.width,f.y+g.height),e=new c.PointExtent(d.x-e,d.y-e,f.x+e,f.y+e);a=new c.Point(a.x,a.y);return e.contains(a)},_computeExtent:function(a){if(!a||!this._coordinates||c.Util.isNil(this._width)||c.Util.isNil(this._height))return null;var b=this.getWidth(),d=this.getHeight();a=a.locate(this._coordinates,b,-d);return new c.Extent(a,this._coordinates)},_computeGeodesicLength:function(){return c.Util.isNil(this._width)||
        c.Util.isNil(this._height)?0:2*(this._width+this._height)},_computeGeodesicArea:function(){return c.Util.isNil(this._width)||c.Util.isNil(this._height)?0:this._width*this._height},_exportGeoJSONGeometry:function(){return{type:"Polygon",coordinates:c.GeoJSON.toNumberArrays([this.getShell()])}},_toJSON:function(a){var b=c.Util.extend({},a);a=this.getCoordinates();b.geometry=!1;b=this.toGeoJSON(b);b.geometry={type:"Polygon"};return{feature:b,subType:"Rectangle",coordinates:[a.x,a.y],width:this.getWidth(),
            height:this.getHeight()}}});c.Rectangle.fromJSON=function(a){var b=a.feature;a=new c.Rectangle(a.coordinates,a.width,a.height,a.options);a.setProperties(b.properties);return a};c.GeometryCollection=c.Geometry.extend({type:c.Geometry.TYPE_GEOMETRYCOLLECTION,initialize:function(a,b){this._initOptions(b);this.setGeometries(a)},setGeometries:function(a){a=this._checkGeometries(a);if(c.Util.isArray(a))for(var b=a.length-1;0<=b;b--)a[b]._initOptions(this.config()),a[b]._setParent(this),a[b]._setEventParent(this),
        a[b].setSymbol(this.getSymbol());this._geometries=a;this.getLayer()&&(this._bindGeometriesToLayer(),this.onShapeChanged());return this},getGeometries:function(){return this._geometries?this._geometries:[]},forEach:function(a,b){for(var c=this.getGeometries(),e=0,f=c.length;e<f;e++)c[e]&&(b?a.call(b,c[e],e):a(c[e],e));return this},filter:function(){return c.VectorLayer.prototype.filter.apply(this,arguments)},translate:function(a){if(!a||this.isEmpty())return this;this.forEach(function(b){b&&b.translate&&
    b.translate(a)});return this},isEmpty:function(){return!c.Util.isArrayHasData(this.getGeometries())},remove:function(){this.forEach(function(a){a._unbind()});return c.Geometry.prototype.remove.apply(this,arguments)},show:function(){this.options.visible=!0;this.forEach(function(a){a.show()});return this},hide:function(){this.options.visible=!1;this.forEach(function(a){a.hide()});return this},setSymbol:function(a){this._symbol=a=this._prepareSymbol(a);this.forEach(function(b){b.setSymbol(a)});this.onSymbolChanged();
        return this},updateSymbol:function(a){this.forEach(function(b){b.updateSymbol(a)});this.onSymbolChanged();return this},onConfig:function(a){this.forEach(function(b){b.config(a)})},_setExternSymbol:function(a){this._externSymbol=a=this._prepareSymbol(a);this.forEach(function(b){b._setExternSymbol(a)});this.onSymbolChanged();return this},_bindLayer:function(){c.Geometry.prototype._bindLayer.apply(this,arguments);this._bindGeometriesToLayer()},_bindGeometriesToLayer:function(){var a=this.getLayer();
        this.forEach(function(b){b._bindLayer(a)})},_checkGeometries:function(a){if(a&&!c.Util.isArray(a)){if(a instanceof c.Geometry)return[a];throw Error("The geometry added to collection is invalid.");}if(c.Util.isArray(a)){for(var b=0,d=a.length;b<d;b++)if(!(a[b]instanceof c.Geometry))throw Error("The geometry added to collection is invalid. Index: "+b);return a}return null},_updateCache:function(){delete this._extent;this.isEmpty()||this.forEach(function(a){a&&a._updateCache&&a._updateCache()})},_removePainter:function(){this._painter&&
    this._painter.remove();delete this._painter;this.forEach(function(a){a._removePainter()})},_computeCenter:function(a){if(!a||this.isEmpty())return null;for(var b=0,d=0,e=0,f=this.getGeometries(),g=0,h=f.length;g<h;g++)if(f[g]){var k=f[g]._computeCenter(a);k&&(b+=k.x,d+=k.y,e++)}return 0===e?null:new c.Coordinate(b/e,d/e)},_containsPoint:function(a,b){if(this.isEmpty())return!1;var c,e,f=this.getGeometries();c=0;for(e=f.length;c<e;c++)if(f[c]._containsPoint(a,b))return!0;return!1},_computeExtent:function(a){if(this.isEmpty())return null;
        for(var b=this.getGeometries(),c=null,e=0,f=b.length;e<f;e++)if(b[e]){var g=b[e]._computeExtent(a);g&&(c=g.combine(c))}return c},_computeGeodesicLength:function(a){if(!a||this.isEmpty())return 0;for(var b=this.getGeometries(),c=0,e=0,f=b.length;e<f;e++)b[e]&&(c+=b[e]._computeGeodesicLength(a));return c},_computeGeodesicArea:function(a){if(!a||this.isEmpty())return 0;for(var b=this.getGeometries(),c=0,e=0,f=b.length;e<f;e++)b[e]&&(c+=b[e]._computeGeodesicArea(a));return c},_exportGeoJSONGeometry:function(){var a=
        [];if(!this.isEmpty())for(var b=this.getGeometries(),c=0,e=b.length;c<e;c++)b[c]&&a.push(b[c]._exportGeoJSONGeometry());return{type:"GeometryCollection",geometries:a}},_clearProjection:function(){if(!this.isEmpty())for(var a=this.getGeometries(),b=0,c=a.length;b<c;b++)a[b]&&a[b]._clearProjection()},_getConnectPoints:function(){var a=this.getExtent();return[new c.Coordinate(a.xmin,a.ymax),new c.Coordinate(a.xmax,a.ymin),new c.Coordinate(a.xmin,a.ymin),new c.Coordinate(a.xmax,a.ymax)]},_getExternalResources:function(){if(this.isEmpty())return null;
        var a,b,d,e,f=this.getGeometries(),g=[],h,k={},l;a=0;for(b=f.length;a<b;a++)if(f[a]&&(d=f[a]._getInternalSymbol(),h=c.Util.getExternalResources(d)))for(d=0,e=h.length;d<e;d++)l=h[d].join(),k[l]||(g.push(h[d]),k[l]=1);return g},startEdit:function(a){if(this.isEmpty())return this;a||(a={});a.symbol&&(this._originalSymbol=this.getSymbol(),this.setSymbol(a.symbol));this._draggbleBeforeEdit=this.options.draggable;this.config("draggable",!1);for(var b=this.getGeometries(),c=0,e=b.length;c<e;c++)b[c].startEdit(a);
        this._editing=!0;this.hide();var f=this;setTimeout(function(){f.fire("editstart")},1);return this},endEdit:function(){if(this.isEmpty())return this;for(var a=this.getGeometries(),b=0,c=a.length;b<c;b++)a[b].endEdit();this._originalSymbol&&(this.setSymbol(this._originalSymbol),delete this._originalSymbol);this._editing=!1;this.show();this.config("draggable",this._draggbleBeforeEdit);this.fire("editend");return this},isEditing:function(){return this._editing?!0:!1}});c.Geometry.MultiPoly={getCoordinates:function(){var a=
        [],b=this.getGeometries();if(!c.Util.isArray(b))return null;for(var d=0,e=b.length;d<e;d++)a.push(b[d].getCoordinates());return a},setCoordinates:function(a){if(c.Util.isArrayHasData(a)){for(var b=[],d=0,e=a.length;d<e;d++){var f=new this.GeometryType(a[d],this.config());b.push(f)}this.setGeometries(b)}else this.setGeometries([]);return this},_initData:function(a){c.Util.isArrayHasData(a)&&(a[0]instanceof this.GeometryType?this.setGeometries(a):this.setCoordinates(a))},_checkGeometries:function(a){if(c.Util.isArray(a))for(var b=
        0,d=a.length;b<d;b++)if(a[b]&&!(a[b]instanceof this.GeometryType))throw Error("Geometry is not valid for collection, index:"+b);return a},_exportGeoJSONGeometry:function(){var a=this.getCoordinates(),a=c.GeoJSON.toNumberArrays(a);return{type:this.getType(),coordinates:a}}};c.MultiPoint=c.GeometryCollection.extend({includes:[c.Geometry.MultiPoly],GeometryType:c.Marker,type:c.Geometry.TYPE_MULTIPOINT,initialize:function(a,b){this._initOptions(b);this._initData(a)}});c.MultiLineString=c.MultiPolyline=
        c.GeometryCollection.extend({includes:[c.Geometry.MultiPoly],GeometryType:c.Polyline,type:c.Geometry.TYPE_MULTILINESTRING,initialize:function(a,b){this._initOptions(b);this._initData(a)}});c.MultiPolygon=c.GeometryCollection.extend({includes:[c.Geometry.MultiPoly],GeometryType:c.Polygon,type:c.Geometry.TYPE_MULTIPOLYGON,initialize:function(a,b){this._initOptions(b);this._initData(a)}});c.GeoJSON={toGeometry:function(a){c.Util.isString(a)&&(a=c.Util.parseJSON(a));if(c.Util.isArray(a)){for(var b=[],
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         d=0,e=a.length;d<e;d++){var f=this._convert(a[d]);c.Util.isArray(f)?b=b.concat(f):b.push(f)}return b}return this._convert(a)},toNumberArrays:function(a){return c.Util.isArray(a)?c.Util.mapArrayRecursively(a,function(a){return[a.x,a.y]}):[a.x,a.y]},toCoordinates:function(a){if(c.Util.isNumber(a[0])&&c.Util.isNumber(a[1]))return new c.Coordinate(a);for(var b=[],d=0,e=a.length;d<e;d++){var f=a[d];c.Util.isArray(f)?c.Util.isNumber(f[0])?b.push(new c.Coordinate(f)):b.push(this.toCoordinates(f)):b.push(new c.Coordinate(f))}return b},
        _convert:function(a){if(!a||c.Util.isNil(a.type))return null;var b={},d=a.type;if("Feature"===d){b=this._convert(a.geometry);if(!b)return null;b.setId(a.id);b.setProperties(a.properties);return b}if("FeatureCollection"===d)return(b=a.features)?c.GeoJSON.toGeometry(b):null;if(0<=c.Util.indexOfArray(d,"Point LineString Polygon MultiPoint MultiLineString MultiPolygon".split(" ")))return new c["Point"===d?"Marker":d](a.coordinates,b);if("GeometryCollection"===d){a=a.geometries;if(!c.Util.isArrayHasData(a))return new c.GeometryCollection;
            for(var d=[],e=a.length,f=0;f<e;f++)d.push(this._convert(a[f]));return new c.GeometryCollection(d,b)}return"Circle"===d?new c.Circle(a.coordinates,a.radius,b):"Ellipse"===d||"Rectangle"===d?new c[d](a.coordinates,a.width,a.height,b):"Sector"===d?new c.Sector(a.coordinates,a.radius,a.startAngle,a.endAngle,b):null}};c.Geometry.Editor=c.Class.extend({includes:[c.Eventable],editStageLayerIdPrefix:c.internalLayerPrefix+"_edit_stage_",initialize:function(a,b){(this._geometry=a)&&c.Util.setOptions(this,
        b)},getMap:function(){return this._geometry.getMap()},prepare:function(){this.getMap()&&(this.options.symbol&&(this._originalSymbol=this._geometry.getSymbol(),this._geometry.setSymbol(this.options.symbol)),this._prepareEditStageLayer())},_prepareEditStageLayer:function(){var a=this.getMap(),b=c.Util.UID();this._editStageLayer=a.getLayer(this.editStageLayerIdPrefix+b);this._editStageLayer||(this._editStageLayer=new c.VectorLayer(this.editStageLayerIdPrefix+b),a.addLayer(this._editStageLayer))},start:function(){if(this._geometry&&
        this._geometry.getMap()&&!this._geometry.editing){this.editing=!0;var a=this._geometry;this._geometryDraggble=a.options.draggable;a.config("draggable",!1);this.prepare();var b=a.copy();b.setSymbol(a._getInternalSymbol());b.copyEventListeners(a);a._getParent()&&b.copyEventListeners(a._getParent());b.setId(null).config({draggable:!1});this._shadow=b;this._switchGeometryEvents("on");a.hide();(a instanceof c.Marker||a instanceof c.Circle||a instanceof c.Rectangle||a instanceof c.Ellipse)&&this._createOrRefreshOutline();
        this._editStageLayer.bringToFront().addGeometry(b);a instanceof c.Marker?(b.config("draggable",!0),b.on("dragend",this._onShadowDragEnd,this)):this._createCenterHandle();a instanceof c.Marker?this.createMarkerEditor():a instanceof c.Circle?this.createCircleEditor():a instanceof c.Rectangle?this.createEllipseOrRectEditor():a instanceof c.Ellipse?this.createEllipseOrRectEditor():a instanceof c.Sector||(a instanceof c.Polygon||a instanceof c.Polyline)&&this.createPolygonEditor()}},stop:function(){this._switchGeometryEvents("off");
        if(this.getMap()){this._shadow&&(this._update(),this._shadow._clearAllListeners(),this._shadow.remove(),delete this._shadow);this._geometry.config("draggable",this._geometryDraggble);delete this._geometryDraggble;this._geometry.show();this._editStageLayer.remove();if(c.Util.isArrayHasData(this._eventListeners)){for(var a=this._eventListeners.length-1;0<=a;a--){var b=this._eventListeners[a];b[0].off(b[1],b[2],this)}this._eventListeners=[]}this._refreshHooks=[];this.options.symbol&&(this._geometry.setSymbol(this._originalSymbol),
            delete this._originalSymbol);this.editing=!1}},isEditing:function(){return c.Util.isNil(this.editing)?!1:this.editing},_getGeometryEvents:function(){return{symbolchange:this._onGeometrySymbolChange}},_switchGeometryEvents:function(a){if(this._geometry){var b=this._getGeometryEvents(),c;for(c in b)this._geometry[a](c,b[c],this)}},_onGeometrySymbolChange:function(a){this._shadow&&this._shadow.setSymbol(a.target._getInternalSymbol())},_onShadowDragEnd:function(){this._update();this._refresh()},_update:function(){this._geometry.setCoordinates(this._shadow.getCoordinates());
        this._geometry.getRadius&&this._geometry.setRadius(this._shadow.getRadius());this._geometry.getWidth&&this._geometry.setWidth(this._shadow.getWidth());this._geometry.getHeight&&this._geometry.setHeight(this._shadow.getHeight());this._geometry.getStartAngle&&this._geometry.setStartAngle(this._shadow.getStartAngle());this._geometry.getEndAngle&&this._geometry.setEndAngle(this._shadow.getEndAngle())},_updateAndFireEvent:function(a){this._shadow&&(this._update(),this._geometry.fire(a))},_createOrRefreshOutline:function(){var a=
        this._geometry,b=this.getMap(),d=this._editOutline,e=a._getPainter().get2DExtent(),a=e.getSize(),e=b.pointToCoordinate(e.getMin()),f=b.pixelToDistance(a.width,0),b=b.pixelToDistance(0,a.height);d?(d.setCoordinates(e),d.setWidth(f),d.setHeight(b)):(d=new c.Rectangle(e,f,b,{symbol:{lineWidth:1,lineColor:"6b707b"}}),this._editStageLayer.addGeometry(d),this._editOutline=d,this._addRefreshHook(this._createOrRefreshOutline));return d},_createCenterHandle:function(){var a=this,b=this._shadow.getCenter(),
        d,e=a.createHandle(b,{markerType:"ellipse",dxdy:new c.Point(0,0),cursor:"move",onDown:function(){d=this._shadow.copy();var a=c.Util.lowerSymbolOpacity(d._getInternalSymbol(),.5);d.setSymbol(a).addTo(this._editStageLayer)},onMove:function(a,b){var c=b.dragOffset;d&&(d.translate(c),this._geometry.translate(c))},onUp:function(){d&&(this._shadow.setCoordinates(this._geometry.getCoordinates()),d.remove(),a._refresh())}});this._addRefreshHook(function(){var a=this._shadow.getCenter();e.setCoordinates(a)})},
        _createHandleInstance:function(a,b){var d={markerType:b.markerType,markerFill:"#ffffff",markerLineColor:"#000000",markerLineWidth:2,markerWidth:10,markerHeight:10,markerDx:b.dxdy.x,markerDy:b.dxdy.y};b.symbol&&c.Util.extend(d,b.symbol);return new c.Marker(a,{draggable:!0,dragShadow:!1,dragOnAxis:b.axis,cursor:b.cursor,symbol:d})},createHandle:function(a,b){b||(b={});var c=this.getMap(),e=this._createHandleInstance(a,b),f=this;e.on("dragstart",function(a){b.onDown&&b.onDown.call(f,a.viewPoint,a)},
            this);e.on("dragging",function(a){f._hideContext();var h=c._prjToViewPoint(e._getPrjCoordinates());b.onMove&&b.onMove.call(f,h,a)},this);e.on("dragend",function(a){b.onUp&&b.onUp.call(f,a)},this);b.onRefresh&&(e["maptalks--editor-refresh-fn"]=b.onRefresh);this._editStageLayer.addGeometry(e);return e},_createResizeHandles:function(a,b){function d(a){return[a.getMin(),new c.Point((a.xmax+a.xmin)/2,a.ymin),new c.Point(a.xmax,a.ymin),new c.Point(a.xmin,(a.ymax+a.ymin)/2),new c.Point(a.xmax,(a.ymax+a.ymin)/
            2),new c.Point(a.xmin,a.ymax),new c.Point((a.xmax+a.xmin)/2,a.ymax),a.getMax()]}var e="nw-resize n-resize ne-resize w-resize e-resize sw-resize s-resize se-resize".split(" "),f=[null,"y",null,"x","x",null,"y",null],g=this._geometry;a||(a=[]);var h=[],k={},l=this,m=this.getMap(),n=function(){for(var p=g._getPainter().get2DExtent(),p=d(p),n=0;n<p.length;n++){if(c.Util.isArrayHasData(a)){for(var q=!1,t=a.length-1;0<=t;t--)if(a[t]===n){q=!0;break}if(q)continue}q=m.pointToCoordinate(p[n]);h.length<p.length-
        a.length?(q=l.createHandle(q,{markerType:"square",dxdy:new c.Point(0,0),cursor:e[n],axis:f[n],onMove:function(a){return function(c){b(c,a)}}(n),onUp:function(){l._refresh()}}),q.setId(n),k[n]=h.length,h.push(q)):h[k[n]].setCoordinates(q)}};n();this._addRefreshHook(n);return h},createMarkerEditor:function(){function a(){if(c.Util.isArrayHasData(h))for(var a=h.length-1;0<=a;a--)h[a].hide();this._editOutline&&this._editOutline.hide()}function b(){this._refresh();if(c.Util.isArrayHasData(h))for(var a=
            h.length-1;0<=a;a--)h[a].show();this._editOutline&&this._editOutline.show()}var d=this,e=this._shadow,f=this._geometry,g=this.getMap(),h;if(e._canEdit()){var k=e._getInternalSymbol(),l=new c.Point(0,0);c.Util.isNumber(k.markerDx)&&(l.x=k.markerDx);c.Util.isNumber(k.markerDy)&&(l.y=k.markerDy);var m=null;if(c.symbolizer.VectorMarkerSymbolizer.test(k)){if("pin"===k.markerType||"pie"===k.markerType||"bar"===k.markerType)m=[5,6,7]}else if(c.symbolizer.ImageMarkerSymbolizer.test(k)||c.symbolizer.VectorPathMarkerSymbolizer.test(k))m=
            [5,6,7];var n=[2,1,2,0,0,2,1,2];h=this._createResizeHandles(null,function(a,b){if(m&&0<=c.Util.indexOfArray(b,m)){var k=g.viewPointToCoordinate(a.substract(l)),t=e.getCoordinates();k.x=t.x;e.setCoordinates(k);f.setCoordinates(k);a=g.coordinateToViewPoint(h[h.length-1-b].getCoordinates())}var u=g._pointToViewPoint(e._getCenter2DPoint()).add(l),k=e._getInternalSymbol(),t=a.substract(u);m&&a.y>u.y&&(t.y=0);var w;d.options.fixAspectRatio&&(w=e.getSize(),w=w.width/w.height);u=2*Math.abs(t.x);t=Math.abs(t.y)*
            (m?1:2);w&&(u=Math.max(u,t*w),t=u/w);var v=n[b];if(e instanceof c.TextMarker){if(w||0===v||2===v)f.config("boxMinWidth",u),e.config("boxMinWidth",u);if(w||1===v||2===v)f.config("boxMinHeight",t),e.config("boxMinHeight",t)}else{if(w||0===v||2===v)k.markerWidth=u;if(w||1===v||2===v)k.markerHeight=t;e.setSymbol(k);f.setSymbol(k)}});this._addListener([g,"zoomstart",a]);this._addListener([g,"zoomend",b])}else console&&console.warn("A marker can't be resized with symbol:",e.getSymbol())},createCircleEditor:function(){var a=
            this._shadow,b=this._geometry,c=this.getMap();this._createResizeHandles(null,function(e){var f=c._pointToViewPoint(a._getCenter2DPoint()),f=e.substract(f);e=Math.abs(f.x);f=Math.abs(f.y);e=e>f?c.pixelToDistance(e,0):c.pixelToDistance(0,f);a.setRadius(e);b.setRadius(e)})},createEllipseOrRectEditor:function(){var a=this,b=[2,1,2,0,0,2,1,2],d=this._shadow,e=this._geometry,f=this.getMap(),g=this._geometry instanceof c.Rectangle,h=this._createResizeHandles(null,function(k,l){var m,n,p,r,q;a.options.fixAspectRatio&&
        (q=e.getWidth()/e.getHeight());if(g){m=f.coordinateToViewPoint(h[7-l].getCoordinates());var t=e.getSize();if(q){n=k.substract(m);var u=n.abs();0!==n.x&&0!==n.y?(p=Math.max(u.x,u.y*q),r=p/q):0===n.x?(r=u.y,p=r*q):0===n.y&&(p=u.x,r=p/q);k.x=m.x+(0===n.x?-t.width/2:n.x/u.x*p);k.y=m.y+(0===n.y?-t.height/2:n.y/u.y*r);n=new c.Point(p,r)}else n=k.substract(m)._abs(),0===n.x&&(k.x=m.x-t.width/2),0===n.y&&(k.y=m.y-t.height/2);p=f.viewPointToCoordinate(new c.Point(Math.min(k.x,m.x),Math.min(k.y,m.y)));d.setCoordinates(p);
            e.setCoordinates(p);m=1}else m=2,n=f.coordinateToViewPoint(e.getCenter()),q?(n=n.substract(k)._abs(),p=Math.max(n.x,n.y*q),n.x=p,n.y=p/q):n=n.substract(k)._abs();t=b[l];p=f.pixelToDistance(n.x,0);r=f.pixelToDistance(0,n.y);if(q||0===t||2===t)d.setWidth(p*m),e.setWidth(p*m);if(q||1===t||2===t)d.setHeight(r*m),e.setHeight(r*m)})},createPolygonEditor:function(){function a(){if(k instanceof c.Polygon){var a=k.getCoordinates()[0];return a.slice(0,a.length-1)}return k.getCoordinates()}function b(){var a;
            for(a=p.length-1;0<=a;a--)p[a]["maptalks--editor-vertex-index"]=a;for(a=r.length-1;0<=a;a--)r[a]["maptalks--editor-vertex-index"]=a}function d(a){a=a.target["maptalks--editor-vertex-index"];var c=k._getPrjCoordinates();c.length<=n||(c.splice(a,1),k._setPrjCoordinates(c),k._updateCache(),p.splice(a,1)[0].remove(),a<r.length&&r.splice(a,1)[0].remove(),a=0===a?r.length-1:a-1,r.splice(a,1)[0].remove(),r.splice(a,0,g.call(l,a)),b())}function e(a,b){var c=k._getPrjCoordinates(),d=h._viewPointToPrj(a),c=
            c[b];c.x=d.x;c.y=d.y;k._updateCache();k.onShapeChanged();d=0===b?r.length-1:b-1;if(r[b])r[b]["maptalks--editor-refresh-fn"]();if(r[d])r[d]["maptalks--editor-refresh-fn"]();l._updateAndFireEvent("shapechange")}function f(b){var f=a()[b],g=l.createHandle(f,{markerType:"square",dxdy:new c.Point(0,0),cursor:"pointer",axis:null,onMove:function(a){e(a,g["maptalks--editor-vertex-index"])},onRefresh:function(){f=a()[g["maptalks--editor-vertex-index"]];g.setCoordinates(f)},onUp:function(){l._refresh()}});
            g["maptalks--editor-vertex-index"]=b;g.on("contextmenu",d);return g}function g(d){var h=a(),n=h[d].add(d+1>=h.length?h[0]:h[d+1]).multi(.5),q=l.createHandle(n,{markerType:"square",symbol:{opacity:.4},dxdy:new c.Point(0,0),cursor:"pointer",axis:null,onDown:function(){var a=k._getPrjCoordinates(),b=q["maptalks--editor-vertex-index"],c=m.project(q.getCoordinates());a.splice(b+1,0,c);k._setPrjCoordinates(a);k._updateCache();a=q.getSymbol();delete a.opacity;q.setSymbol(a);r.splice(b,0,g.call(l,b),g.call(l,
            b+1));l._updateAndFireEvent("shapechange")},onMove:function(a){e(a,q["maptalks--editor-vertex-index"]+1)},onUp:function(){var a=q["maptalks--editor-vertex-index"];c.Util.removeFromArray(q,r);q.remove();p.splice(a+1,0,f.call(l,a+1));b()},onRefresh:function(){h=a();var b=q["maptalks--editor-vertex-index"],b=h[b].add(h[b===h.length-1?0:b+1]).multi(.5);q.setCoordinates(b)}});q["maptalks--editor-vertex-index"]=d;return q}for(var h=this.getMap(),k=this._shadow,l=this,m=h.getProjection(),n=k instanceof c.Polygon?
            3:2,p=[],r=[],q=a(),t=0,u=q.length;t<u;t++)p.push(f.call(this,t)),t<u-1&&r.push(g.call(this,t));k instanceof c.Polygon&&r.push(g.call(this,q.length-1));this._addRefreshHook(function(){var a;for(a=r.length-1;0<=a;a--)r[a]["maptalks--editor-refresh-fn"]();for(a=p.length-1;0<=a;a--)p[a]["maptalks--editor-refresh-fn"]()})},_refresh:function(){if(this._refreshHooks)for(var a=this._refreshHooks.length-1;0<=a;a--)this._refreshHooks[a].call(this)},_hideContext:function(){this._geometry&&(this._geometry.closeMenu(),
            this._geometry.closeInfoWindow())},_addListener:function(a){this._eventListeners||(this._eventListeners=[]);this._eventListeners.push(a);a[0].on(a[1],a[2],this)},_addRefreshHook:function(a){a&&(this._refreshHooks||(this._refreshHooks=[]),this._refreshHooks.push(a))}});c.TextMarker.Editor={startEditText:function(){if(!this.getMap())return this;this.hide();this.endEditText();this._prepareEditor();this._fireEvent("edittextstart");return this},endEditText:function(){if(this._textEditor){var a=this._textEditor.innerText,
        a=this._filterContent(a);this.setContent(a);this.show();c.DomUtil.off(this._textEditor,"mousedown dblclick",c.DomUtil.stopPropagation);this.getMap().off("mousedown",this.endEditText,this);this._editUIMarker.remove();delete this._editUIMarker;this._textEditor.onkeyup=null;delete this._textEditor;this._fireEvent("edittextend")}return this},isEditingText:function(){return this._textEditor?!0:!1},getTextEditor:function(){return this._editUIMarker},_prepareEditor:function(){var a=this.getMap(),b=this._createEditor();
        this._textEditor=b;a.on("mousedown",this.endEditText,this);var d=this._getEditorOffset();this._editUIMarker=(new c.ui.UIMarker(this.getCoordinates(),{content:b,dx:d.dx,dy:d.dy})).addTo(a).show();this._setCursorToLast(this._textEditor)},_getEditorOffset:function(){var a=this._getInternalSymbol()||{},b=0,c=0;"middle"===a.textHorizontalAlignment?(b=a.textDx-2||0,c=a.textDy-2||0):(b=a.markerDx-2||0,c=a.markerDy-2||0);return{dx:b,dy:c}},_createEditor:function(){var a=this.getContent(),b=this.getSize(),
        d=this._getInternalSymbol()||{},e=a&&0<a.length?Math.max(b.width,this.options.boxMinWidth)||100:100,f=d.textFill||"#000000",g=d.textSize||12,b=Math.max(b.height,this.options.boxMinHeight)||1.5*g,h=d.markerLineColor||"#000",k=d.markerFill||"#3398CC",d=d.textLineSpacing||0,l=c.DomUtil.createEl("div");l.contentEditable=!0;l.style.cssText="background: "+k+";border: 1px solid "+h+";color: "+f+";font-size: "+g+"px;width: "+(e-2)+"px;height: "+(b-2)+"px;margin-left: auto;margin-right: auto;line-height: "+
        (g+d)+"px;outline: 0;word-wrap: break-word;overflow-x: hidden;overflow-y: hidden;-webkit-user-modify: read-write-plaintext-only;";l.innerText=a;c.DomUtil.on(l,"mousedown dblclick",c.DomUtil.stopPropagation);l.onkeyup=function(a){var b=l.style.height;b||(b=0);13===a.keyCode&&(l.style.height=parseInt(b)+g+"px")};return l},_setCursorToLast:function(a){var b;window.getSelection?(a.focus(),b=window.getSelection(),b.selectAllChildren(a),b.collapseToEnd()):document.selection&&(b=document.selection.createRange(),
            b.moveToElementText(a),b.collapse(!1),b.select())},_filterContent:function(a){a=a.replace(/\\[v f t b]{1}/gi,"");return a=a.replace(/[\r\n]+$/gi,"")}};c.TextBox.include(c.TextMarker.Editor);c.Label.include(c.TextMarker.Editor);c.View=function(a){a||(a={});this.options=a;this._initView()};c.Util.extend(c.View.prototype,{defaultView:{"EPSG:3857":{resolutions:function(){for(var a=[],b=12756274*Math.PI,c=0;21>c;c++)a[c]=b/(256*Math.pow(2,c));return a}(),fullExtent:{top:6378137*Math.PI,left:-6378137*Math.PI,
        bottom:-6378137*Math.PI,right:6378137*Math.PI}},"EPSG:4326":{fullExtent:{top:90,left:-180,bottom:-90,right:180},resolutions:function(){for(var a=[],b=0;21>b;b++)a[b]=180/(128*Math.pow(2,b));return a}()},BAIDU:{resolutions:function(){for(var a=Math.pow(2,18),b=[],c=0;20>c;c++)b[c]=a,a*=.5;b[0]=null;b[1]=null;b[2]=null;return b}(),fullExtent:{top:33554432,left:-33554432,bottom:-33554432,right:33554432}}},_initView:function(){var a=this.options.projection;if(a){if(c.Util.isString(a))for(var b in c.projection)if(c.projection.hasOwnProperty(b)){var d=
        c.projection[b].code;if(d&&d.toLowerCase()===a.toLowerCase()){a=c.projection[b];break}}}else a=c.projection.DEFAULT;if(!a||c.Util.isString(a))throw Error("must provide a valid projection in map's view.");a=c.Util.extend({},c.projection.Common,a);a.measureLength||c.Util.extend(a,c.MeasurerUtil.DEFAULT);this._projection=a;d=this.options.resolutions;if(!d&&(a.code&&(b=this.defaultView[a.code])&&(d=b.resolutions),!d))throw Error("must provide valid resolutions in map's view.");this._resolutions=d;d=this.options.fullExtent;
        if(!d&&(a.code&&(b=this.defaultView[a.code])&&(d=b.fullExtent),!d))throw Error("must provide a valid fullExtent in map's view.");c.Util.isNil(d.left)?(this._fullExtent=new c.Extent(d),d.left=d.xmin,d.right=d.xmax,d.top=d.ymax,d.bottom=d.ymin):this._fullExtent=new c.Extent(new c.Coordinate(d.left,d.top),new c.Coordinate(d.right,d.bottom));c.Util.extend(this._fullExtent,d);this._transformation=new c.Transformation([d.right>=d.left?1:-1,d.top>=d.bottom?-1:1,0,0])},getResolutions:function(){return this._resolutions},
        getResolution:function(a){0>a?a=0:a>this._resolutions.length-1&&(a=this._resolutions.length-1);return this._resolutions[a]},getProjection:function(){return this._projection},getFullExtent:function(){return this._fullExtent},getTransformation:function(){return this._transformation},getMinZoom:function(){for(var a=0;a<this._resolutions.length;a++)if(!c.Util.isNil(this._resolutions[a]))return a;return 0},getMaxZoom:function(){for(var a=this._resolutions.length-1;0<=a;a--)if(!c.Util.isNil(this._resolutions[a]))return a;
            return this._resolutions.length-1}});(function(){function a(a){for(var c=a.tileInfo,e={width:c.cols,height:c.rows},f=[],g=c.lods,h=0,k=g.length;h<k;h++)f.push(g[h].resolution);a=a.fullExtent;c=c.origin;c=[1,-1,c.x,c.y];delete a.spatialReference;return{view:{resolutions:f,fullExtent:a},tileSystem:c,tileSize:e}}c.View.loadArcgis=function(b,d,e){c.Util.isString(b)&&"{"!==b.substring(0,1)?c.Ajax.getJSON(b,function(b,c){if(b)e?d.call(e,b):d(b);else{var h=a(c);e?d.call(e,null,h):d(null,h)}}):(c.Util.isString(b)&&
        (b=c.Util.parseJSON(b)),b=a(b),e?d.call(e,null,b):d(null,b));return this}})();c.Map=c.Class.extend({includes:[c.Eventable,c.Handlerable],options:{centerCross:!1,clipFullExtent:!1,zoomAnimation:c.node?!1:!0,zoomAnimationDuration:330,zoomBackground:!0,layerZoomAnimation:!0,layerTransforming:!0,panAnimation:c.node?!1:!0,panAnimationDuration:600,zoomable:!0,enableInfoWindow:!0,hitDetect:!c.Browser.mobile,maxZoom:null,minZoom:null,maxExtent:null,checkSize:!0,renderer:"canvas"},initialize:function(a,b){if(!b)throw Error("Invalid options when creating map.");
        this._loaded=!1;if(c.Util.isString(a)){if(this._containerDOM=document.getElementById(a),!this._containerDOM)throw Error("invalid container when creating map: '"+a+"'");}else this._containerDOM=a,c.node&&(this.CanvasClass=this._containerDOM.constructor);if(!c.node&&this._containerDOM.childNodes&&0<this._containerDOM.childNodes.length&&"maptalks-wrapper"===this._containerDOM.childNodes[0].className)throw Error("Container is already loaded with another map instance, use map.remove() to clear it.");if(!b.center)throw Error("Invalid center when creating map.");
        this._panels={};this._baseLayer=null;this._layers=[];var d=c.Util.extend({},b);this._zoomLevel=d.zoom;delete d.zoom;this._center=new c.Coordinate(d.center);delete d.center;var e=d.baseLayer;delete d.baseLayer;var f=d.layers;delete d.layers;c.Util.setOptions(this,d);this.setView(d.view);e&&this.setBaseLayer(e);f&&this.addLayer(f);this._mapViewPoint=new c.Point(0,0);this._initRenderer();this._getRenderer().initContainer();this._updateMapSize(this._getContainerDomSize());this._Load()},isLoaded:function(){return this._loaded},
        isCanvasRender:function(){var a=this._getRenderer();return a?a.isCanvasRender():!1},getView:function(){return this._view?this._view:null},setView:function(a){var b=this.options.view;if(b&&!a)return this;this._center=this.getCenter();this.options.view=a;this._view=new c.View(a);this.options.view&&c.Util.isFunction(this.options.view.projection)&&(a=this._view.getProjection(),this.options.view.projection=a.code);this._resetMapStatus();this._fireEvent("viewchange",{old:b,"new":c.Util.extend({},this.options.view)});
            return this},onConfig:function(a){c.Util.isNil(a.view)||this.setView(a.view);return this},getProjection:function(){return this._view.getProjection()},getFullExtent:function(){return this._view.getFullExtent()},setCursor:function(a){delete this._cursor;this._trySetCursor(a);this._cursor=a;return this},getCenter:function(){return this._loaded&&this._prjCenter?this.getProjection().unproject(this._prjCenter):this._center},setCenter:function(a){if(!a)return this;a=new c.Coordinate(a);if(!this._verifyExtent(a))return this;
            if(!this._loaded)return this._center=a,this;this.onMoveStart();a=this.getProjection().project(a);this._setPrjCenterAndMove(a);this.onMoveEnd();return this},getSize:function(){return c.Util.isNil(this.width)||c.Util.isNil(this.height)?this._getContainerDomSize():new c.Size(this.width,this.height)},getContainerExtent:function(){return new c.PointExtent(0,0,this.width,this.height)},getExtent:function(){return this._pointToExtent(this._get2DExtent())},getProjExtent:function(){var a=this._get2DExtent();
            return new c.Extent(this._pointToPrj(a.getMin()),this._pointToPrj(a.getMax()))},getMaxExtent:function(){return this.options.maxExtent?new c.Extent(this.options.maxExtent):null},setMaxExtent:function(a){if(a){a=new c.Extent(a);this.options.maxExtent=a;var b=this.getCenter();this._verifyExtent(b)||this.panTo(a.getCenter())}else delete this.options.maxExtent;return this},getZoom:function(){return this._zoomLevel},getZoomForScale:function(a,b){c.Util.isNil(b)&&(b=this.getZoom());for(var d=this._getResolution(b),
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    e=this._getResolutions(),f=this.getMinZoom(),g=this.getMaxZoom(),h=Number.MAX_VALUE,k=-1,l=e.length-1;0<=l;l--){var m=Math.abs(d/e[l]-a);m<h&&(h=m,k=l)}c.Util.isNumber(f)&&k<f&&(k=f);c.Util.isNumber(g)&&k>g&&(k=g);return k},setZoom:function(a){var b=this;c.Util.executeWhen(function(){b._loaded&&b.options.zoomAnimation?b._zoomAnimation(a):b._zoom(a)},function(){return!b._zooming});return this},getMaxZoom:function(){if(!c.Util.isNil(this.options.maxZoom))return this.options.maxZoom;var a=this.getView();
            return a?a.getResolutions().length-1:null},setMaxZoom:function(a){var b=this._view.getMaxZoom();a>b&&(a=b);a<this._zoomLevel&&this.setZoom(a);this.options.maxZoom=a;return this},getMinZoom:function(){return c.Util.isNil(this.options.minZoom)?0:this.options.minZoom},setMinZoom:function(a){var b=this._view.getMinZoom();a<b&&(a=b);this.options.minZoom=a;return this},zoomIn:function(){var a=this;c.Util.executeWhen(function(){a.setZoom(a.getZoom()+1)},function(){return!a._zooming});return this},zoomOut:function(){var a=
            this;c.Util.executeWhen(function(){a.setZoom(a.getZoom()-1)},function(){return!a._zooming});return this},setCenterAndZoom:function(a,b){this._zoomLevel!==b?(this.setCenter(a),c.Util.isNil(b)||this.setZoom(b)):this.setCenter(a);return this},getFitZoom:function(a){if(!(a&&a instanceof c.Extent))return this._zoomLevel;if(a.xmin===a.xmax&&a.ymin===a.ymax)return this.getMaxZoom();for(var b=this.getProjection().project({x:Math.abs(a.xmin-a.xmax),y:Math.abs(a.ymin-a.ymax)}),d=this._getResolutions(),e=a=
            -1,f=this.getMinZoom(),g=this.getMaxZoom();f<g&&!(c.Util.round(b.x/d[f])>=this.width&&-1===a&&(a=f),c.Util.round(b.y/d[f])>=this.height&&-1===e&&(e=f),-1<a&&-1<e);f++);b=a<e?a:e;-1===b&&(b=a<e?e:a);return-1===b?this.getMaxZoom():b},getResolution:function(a){return this._getResolution(a)},getScale:function(a){a=void 0===a?this.getZoom():a;var b=this._getResolution(this.getMaxZoom());return this._getResolution(a)/b},fitExtent:function(a,b){if(!a)return this;b=b||0;var d=this.getFitZoom(a),d=d+b,e=(new c.Extent(a)).getCenter();
            return this.setCenterAndZoom(e,d)},getBaseLayer:function(){return this._baseLayer},setBaseLayer:function(a){var b=!1;this._baseLayer&&(b=!0,this._fireEvent("baselayerchangestart"),this._baseLayer.remove());if(!a)return delete this._baseLayer,this._fireEvent("baselayerchangeend"),this._fireEvent("setbaselayer"),this;a instanceof c.TileLayer&&(a.config({renderWhenPanning:!0}),a.options.tileSystem||a.config("tileSystem",c.TileSystem.getDefault(this.getProjection())));a._bindMap(this,-1);this._baseLayer=
            a;this._baseLayer.on("layerload",function(){this._fireEvent("baselayerload");b&&(b=!1,this._fireEvent("baselayerchangeend"))},this);this._loaded&&this._baseLayer.load();this._fireEvent("setbaselayer");return this},removeBaseLayer:function(){this._baseLayer&&(this._baseLayer.remove(),delete this._baseLayer,this._fireEvent("baselayerremove"));return this},getLayers:function(a){return this._getLayers(function(b){return b===this._baseLayer||0<=b.getId().indexOf(c.internalLayerPrefix)?!1:a?a(b):!0})},
        getLayer:function(a){return a&&this._layerCache&&this._layerCache[a]?this._layerCache[a]:null},addLayer:function(a){if(!a)return this;if(!c.Util.isArray(a))return this.addLayer([a]);this._layerCache||(this._layerCache={});for(var b=0,d=a.length;b<d;b++){var e=a[b],f=e.getId();if(c.Util.isNil(f))throw Error("Invalid id for the layer: "+f);if(this._layerCache[f])throw Error("Duplicate layer id in the map: "+f);this._layerCache[f]=e;e._bindMap(this,this._layers.length);this._layers.push(e);this._loaded&&
        e.load()}this._fireEvent("addlayer",{layers:a});return this},removeLayer:function(a){if(!a)return this;if(!c.Util.isArray(a))return this.removeLayer([a]);for(var b=0,d=a.length;b<d;b++){var e=a[b];e instanceof c.Layer||(e=this.getLayer(e));if(e){var f=e.getMap();f&&f===this&&(this._removeLayer(e,this._layers),this._loaded&&e._doRemove(),f=e.getId(),this._layerCache&&delete this._layerCache[f],e.fire("remove"))}}this._fireEvent("removelayer",{layers:a});return this},sortLayers:function(a){if(!a||!c.Util.isArray(a))return this;
            for(var b=[],d=Number.MAX_VALUE,e=0;e<a.length;e++){var f=a[e];c.Util.isString(a[e])&&(f=this.getLayer(f));if(!(f instanceof c.Layer&&f.getMap())||f.getMap()!==this)throw Error("It must be a layer added to this map to order.");f.getZIndex()<d&&(d=f.getZIndex());b.push(f)}for(a=0;a<b.length;a++)b[a].setZIndex(d+a);return this},toDataURL:function(a){a||(a={});var b=a.mimeType;b||(b="image/png");var c=a.save,e=this._getRenderer();return e&&e.toDataURL?((a=a.filename)||(a="export"),e=e.toDataURL(b),c&&
            e&&(c=document.createElement("a"),c.download=a,c.href=e,c.dataset.downloadurl=[b,c.download,c.href].join(":"),document.body.appendChild(c),c.click(),document.body.removeChild(c)),e):null},coordinateToPoint:function(a,b){var c=this.getProjection().project(a);return this._prjToPoint(c,b)},pointToCoordinate:function(a,b){var c=this._pointToPrj(a,b);return this.getProjection().unproject(c)},coordinateToViewPoint:function(a){return this._prjToViewPoint(this.getProjection().project(a))},viewPointToCoordinate:function(a){return this.getProjection().unproject(this._viewPointToPrj(a))},
        coordinateToContainerPoint:function(a){a=this.getProjection().project(a);return this._prjToContainerPoint(a)},containerPointToCoordinate:function(a){a=this._containerPointToPrj(a);return this.getProjection().unproject(a)},containerPointToViewPoint:function(a){return a.substract(this.offsetPlatform())},viewPointToContainerPoint:function(a){return a.add(this.offsetPlatform())},containerToExtent:function(a){a=new c.PointExtent(this._containerPointToPoint(a.getMin()),this._containerPointToPoint(a.getMax()));
            return this._pointToExtent(a)},checkSize:function(){var a=1500>c.Util.now()-this._initTime&&0===this.width||0===this.height,b=this._getContainerDomSize(),d=this.height,e=this.width;if(b.width===e&&b.height===d)return this;var f=this.getCenter();this._updateMapSize(b);b=new c.Point((e-b.width)/2,(d-b.height)/2);this._offsetCenterByPixel(b);a&&(this._eventSuppressed=!0,this.setCenter(f),this._eventSuppressed=!1);this._fireEvent("resize");return this},distanceToPixel:function(a,b){var d=this.getProjection();
            if(!d)return null;var e=this.getCenter(),f=d.locate(e,a,b),g=this._getResolution(),h=a?(d.project(new c.Coordinate(f.x,e.y)).x-d.project(e).x)/g:0,d=b?(d.project(new c.Coordinate(e.x,f.y)).y-d.project(e).y)/g:0;return new c.Size(Math.abs(h),Math.abs(d))},pixelToDistance:function(a,b){var d=this.getProjection();if(!d)return null;var e=this.getCenter(),f=this._getPrjCenter(),g=this._getResolution(),f=new c.Coordinate(f.x+a*g,f.y+b*g),f=d.unproject(f);return d.measureLength(f,e)},locate:function(a,b,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              d){return this.getProjection().locate(new c.Coordinate(a),b,d)},getMainPanel:function(){return this._getRenderer().getMainPanel()},getPanels:function(){return this._panels},remove:function(){this._registerDomEvents(!0);this._clearHandlers();this.removeBaseLayer();for(var a=this.getLayers(),b=0;b<a.length;b++)a[b].remove();this._getRenderer()&&this._getRenderer().remove();this._clearAllListeners();this._containerDOM&&this._containerDOM.innerHTML&&(this._containerDOM.innerHTML="");delete this._panels;
            delete this._containerDOM;return this},onMoveStart:function(a){this._originCenter=this.getCenter();this._enablePanAnimation=!1;this._moving=!0;this._trySetCursor("move");this._fireEvent("movestart",this._parseEvent(a?a.domEvent:null,"movestart"))},onMoving:function(a){this._fireEvent("moving",this._parseEvent(a?a.domEvent:null,"moving"))},onMoveEnd:function(a){this._moving=!1;this._trySetCursor("default");this._fireEvent("moveend",this._parseEvent(a?a.domEvent:null,"moveend"));this._verifyExtent(this.getCenter())||
        (a=this._originCenter,this._verifyExtent(a)||(a=this.getMaxExtent().getCenter()),this.panTo(a))},_isBusy:function(){return this._zooming},_trySetCursor:function(a){this._cursor||this._priorityCursor||(a||(a="default"),this._setCursorToPanel(a));return this},_setPriorityCursor:function(a){a?(this._priorityCursor=a,this._setCursorToPanel(a)):(a=!1,this._priorityCursor&&(a=!0),delete this._priorityCursor,a&&this.setCursor(this._cursor));return this},_setCursorToPanel:function(a){var b=this.getMainPanel();
            b&&b.style&&(b.style.cursor=a)},_get2DExtent:function(a){var b=this._containerPointToPoint(new c.Point(0,0),a),d=this._containerPointToPoint(new c.Point(this.width,0),a),e=this._containerPointToPoint(new c.Point(this.width,this.height),a);a=this._containerPointToPoint(new c.Point(0,this.height),a);return new c.PointExtent(Math.min(b.x,d.x,e.x,a.x),Math.min(b.y,d.y,e.y,a.y),Math.max(b.x,d.x,e.x,a.x),Math.max(b.y,d.y,e.y,a.y))},_pointToExtent:function(a){return new c.Extent(this.pointToCoordinate(a.getMin()),
            this.pointToCoordinate(a.getMax()))},_setPrjCenterAndMove:function(a){var b=this._getPixelDistance(a);this._setPrjCenter(a);this.offsetPlatform(b)},_removeLayer:function(a,b){if(a&&b){var d=c.Util.indexOfArray(a,b);if(-1<d){b.splice(d,1);for(var d=0,e=b.length;d<e;d++)b[d].setZIndex&&b[d].setZIndex(d)}}},_sortLayersByZIndex:function(a){a.sort(function(a,c){return a.getZIndex()-c.getZIndex()})},_genViewMatrix:function(a,b,d){d||(d=0);this._generatingMatrix=!0;a instanceof c.Coordinate&&(a=this.coordinateToContainerPoint(a));
            var e=this._containerPointToPoint(a);a=this.containerPointToViewPoint(a);b={"2dPoint":e,view:(new c.Matrix).translate(a.x,a.y).scaleU(b).rotate(d).translate(-a.x,-a.y),"2d":(new c.Matrix).translate(e.x,e.y).scaleU(b).rotate(d).translate(-e.x,-e.y)};b.inverse={"2d":b["2d"].inverse(),view:b.view.inverse()};this._generatingMatrix=!1;return b},_fillMatrices:function(a,b,d){d||(d=0);this._generatingMatrix=!0;var e=this._pointToContainerPoint(a["2dPoint"]);a.container=(new c.Matrix).translate(e.x,e.y).scaleU(b).rotate(d).translate(-e.x,
            -e.y);e=e.multi(2);a.retina=(new c.Matrix).translate(e.x,e.y).scaleU(b).rotate(d).translate(-e.x,-e.y);a.inverse.container=a.container.inverse();a.inverse.retina=a.retina.inverse();a.scale={x:b,y:b};this._generatingMatrix=!1},_generateMatrices:function(a,b,c){a=this._genViewMatrix(a,b,c);this._fillMatrices(a,b,c);return a},_getPixelDistance:function(a){var b=this._getPrjCenter(),b=this._prjToContainerPoint(b);a=this._prjToContainerPoint(a);return new c.Point(-a.x+b.x,b.y-a.y)},_fireEvent:function(a,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  b){this._eventSuppressed||(this.fire("_"+a,b),this.fire(a,b))},_Load:function(){this._resetMapStatus();this._registerDomEvents();this._loadAllLayers();this._getRenderer().onLoad();this._loaded=!0;this._callOnLoadHooks();this._initTime=c.Util.now();this._fireEvent("load")},_initRenderer:function(){this._renderer=new (c.Map.getRendererClass(this.options.renderer))(this)},_getRenderer:function(){return this._renderer},_loadAllLayers:function(){this._baseLayer&&this._baseLayer.load();this._eachLayer(function(a){a&&
        a.load()},this.getLayers())},_getLayers:function(a){for(var b=this._baseLayer?[this._baseLayer].concat(this._layers):this._layers,c=[],e=0;e<b.length;e++)a&&!a.call(this,b[e])||c.push(b[e]);return c},_eachLayer:function(a){if(!(2>arguments.length)){var b=Array.prototype.slice.call(arguments,1);b&&!c.Util.isArray(b)&&(b=[b]);for(var d=[],e=0,f=b.length;e<f;e++)d=d.concat(b[e]);b=0;for(e=d.length;b<e;b++)a.call(a,d[b])}},_resetMapStatus:function(){var a=this.getMaxZoom(),b=this.getMinZoom(),c=this._view.getMaxZoom(),
            e=this._view.getMinZoom();(!a||-1===a||a>c)&&this.setMaxZoom(c);(!b||-1===b||b<e)&&this.setMinZoom(e);a=this.getMaxZoom();b=this.getMinZoom();a<b&&this.setMaxZoom(b);if(!this._zoomLevel||this._zoomLevel>a)this._zoomLevel=a;this._zoomLevel<b&&(this._zoomLevel=b);delete this._prjCenter;this._prjCenter=this.getProjection().project(this._center)},_getContainerDomSize:function(){if(!this._containerDOM)return null;var a=this._containerDOM,b,d;if(c.Util.isNil(a.width)||c.Util.isNil(a.height)){if(c.Util.isNil(a.clientWidth)||
            c.Util.isNil(a.clientHeight))throw Error("can not get size of container");b=parseInt(a.clientWidth,0);d=parseInt(a.clientHeight,0)}else b=a.width,d=a.height,c.Browser.retina&&a[c.renderer.tilelayer.Canvas.prototype.propertyOfTileId]&&(b/=2,d/=2);return new c.Size(b,d)},_updateMapSize:function(a){this.width=a.width;this.height=a.height;this._getRenderer().updateMapSize(a);return this},_getPrjCenter:function(){return this._prjCenter},_setPrjCenter:function(a){this._prjCenter=a},_verifyExtent:function(a){if(!a)return!1;
            var b=this.getMaxExtent();return b?b.contains(a):!0},_offsetCenterByPixel:function(a){a=new c.Point(this.width/2-a.x,this.height/2-a.y);a=this._containerPointToPrj(a);this._setPrjCenter(a);return a},offsetPlatform:function(a){return a?(this._getRenderer().offsetPlatform(a),this._mapViewPoint=this._mapViewPoint.add(a),this):this._mapViewPoint},_resetMapViewPoint:function(){this._mapViewPoint=new c.Point(0,0)},_getResolution:function(a){c.Util.isNil(a)&&(a=this.getZoom());return this._view.getResolution(a)},
        _getResolutions:function(){return this._view.getResolutions()},_prjToPoint:function(a,b){b=void 0===b?this.getZoom():b;return this._view.getTransformation().transform(a,this._getResolution(b))},_pointToPrj:function(a,b){b=void 0===b?this.getZoom():b;return this._view.getTransformation().untransform(a,this._getResolution(b))},_containerPointToPrj:function(a){return this._pointToPrj(this._containerPointToPoint(a))},_viewPointToPrj:function(a){return this._containerPointToPrj(this.viewPointToContainerPoint(a))},
        _prjToContainerPoint:function(a){return this._pointToContainerPoint(this._prjToPoint(a))},_prjToViewPoint:function(a){a=this._prjToContainerPoint(a);return this._containerPointToViewPoint(a)},_containerPointToViewPoint:function(a){if(!a)return null;var b=this.offsetPlatform();return a._substract(b)},_pointToContainerPoint:function(a){var b=this._prjToPoint(this._getPrjCenter());return new c.Point(this.width/2+a.x-b.x,this.height/2+a.y-b.y)},_containerPointToPoint:function(a,b){var d=this._prjToPoint(this._getPrjCenter(),
            b),e=void 0!==b?this._getResolution()/this._getResolution(b):1;return new c.Point(d.x+e*(a.x-this.width/2),d.y+e*(a.y-this.height/2))},_viewPointToPoint:function(a){return this._containerPointToPoint(this.viewPointToContainerPoint(a))},_pointToViewPoint:function(a){return this._prjToViewPoint(this._pointToPrj(a))}});c.Map.prototype._callOnLoadHooks=function(){for(var a=c.Map.prototype,b=0,d=a._onLoadHooks.length;b<d;b++)a._onLoadHooks[b].call(this)};c.Map.addOnLoadHook=function(a){var b=Array.prototype.slice.call(arguments,
        1);this.prototype._onLoadHooks=this.prototype._onLoadHooks||[];this.prototype._onLoadHooks.push("function"===typeof a?a:function(){this[a].apply(this,b)});return this};c.Util.extend(c.Map,c.Renderable);c.Map.include({panTo:function(a,b){if(!a)return this;var d=this;a=new c.Coordinate(a);var e=this.coordinateToContainerPoint(a),f=this.coordinateToContainerPoint(this.getCenter());return this._panBy(e.substract(f),b,function(){var b=d.getProjection().project(a);d._setPrjCenterAndMove(b)})},panBy:function(a,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   b){return this._panBy(a,b)},_panBy:function(a,b,d){if(!a)return this;a=(new c.Point(a)).multi(-1);this.onMoveStart();b||(b={});"undefined"===typeof b.animation||b.animation?this._panAnimation(a,b.duration,d):(this.offsetPlatform(a),this._offsetCenterByPixel(a),this.onMoving(),d&&d(),this.onMoveEnd());return this},_panAnimation:function(a,b,c){this._getRenderer().panAnimation(a,b,c)}});c.Map.include({_zoom:function(a,b,d){if(this.options.zoomable&&!this._zooming){this._originZoomLevel=this.getZoom();
        a=this._checkZoomLevel(a);this.onZoomStart(a);var e;b&&(b=new c.Point(this.width/2,this.height/2),e=this._getZoomCenterOffset(a,b,d));this.onZoomEnd(a,e)}},_zoomAnimation:function(a,b,d){this.options.zoomable&&!this._zooming&&(c.Util.isNil(d)&&(d=1),c.Util.isNil(this._originZoomLevel)&&(this._originZoomLevel=this.getZoom()),a=this._checkZoomLevel(a),this._originZoomLevel!==a&&(this.onZoomStart(a),b||(b=new c.Point(this.width/2,this.height/2)),this._startZoomAnimation(d,b,a)))},_startZoomAnimation:function(a,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       b,d){var e=this,f=this._getResolutions(),f=f[this._originZoomLevel]/f[d],g=this._getZoomCenterOffset(d,b,a);0===g.x&&0===g.y&&(b=new c.Point(this.width/2,this.height/2));var h=this.options.zoomAnimationDuration*Math.abs(f-a)/Math.abs(f-1);this._getRenderer().animateZoom({startScale:a,endScale:f,origin:b,duration:h},function(){e.onZoomEnd(d,g)})},onZoomStart:function(a){this._zooming=!0;this._enablePanAnimation=!1;this._fireEvent("zoomstart",{from:this._originZoomLevel,to:a})},onZoomEnd:function(a,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           b){this._zoomLevel=a;!b||0===b.x&&0===b.y||this._offsetCenterByPixel(b._multi(-1));var c=this._originZoomLevel;this._originZoomLevel=a;this._getRenderer().onZoomEnd();this._zooming=!1;this._fireEvent("zoomend",{from:c,to:a})},_checkZoomLevel:function(a){var b=this.getMaxZoom(),c=this.getMinZoom();a<c&&(a=c);a>b&&(a=b);return a},_getZoomCenterOffset:function(a,b,d){c.Util.isNil(d)&&(d=1);var e=this._getResolutions();a<this._originZoomLevel?(a=e[a+1]/e[a],b=new c.Point(-(b.x-this.width/2)*(d-a),-(b.y-
            this.height/2)*(d-a))):(a=e[a-1]/e[a],b=new c.Point((b.x-this.width/2)*(a-d),(b.y-this.height/2)*(a-d)));d=this.containerPointToCoordinate(new c.Point(this.width/2+b.x,this.height/2+b.y));return this._verifyExtent(d)?b:new c.Point(0,0)},_getZoomMillisecs:function(){return 600}});c.Map.include({computeLength:function(a,b){if(!this.getProjection())return null;var d=new c.Coordinate(a),e=new c.Coordinate(b);return d.equals(e)?0:this.getProjection().measureLength(d,e)},computeGeometryLength:function(a){return a._computeGeodesicLength(this.getProjection())},
        computeGeometryArea:function(a){return a._computeGeodesicArea(this.getProjection())},identify:function(a,b){if(!a)return this;var d=a.layers;if(!c.Util.isArrayHasData(d))return this;var e=[],f,g;f=0;for(g=d.length;f<g;f++)c.Util.isString(d[f])?e.push(this.getLayer(d[f])):e.push(d[f]);d=this.coordinateToPoint(new c.Coordinate(a.coordinate));g=c.Util.extend({},a);var h=[];for(f=e.length-1;0<=f&&!(a.count&&h.length>=a.count);f--){var k=e[f];!(k&&k.getMap()&&k.isVisible())||!a.includeInternals&&0<=k.getId().indexOf(c.internalLayerPrefix)||
        (k=k.identify(d,g))&&(c.Util.isArray(k)?h=h.concat(k):h.push(k))}b.call(this,h);return this}});c.Map.include({_registerDomEvents:function(a){var b=this._panels.mapWrapper||this._containerDOM;a?c.DomUtil.removeDomEvent(b,"mousedown mouseup mouseover mouseout mousemove click dblclick contextmenu keypress touchstart touchmove touchend ",this._handleDOMEvent,this):c.DomUtil.addDomEvent(b,"mousedown mouseup mouseover mouseout mousemove click dblclick contextmenu keypress touchstart touchmove touchend ",
            this._handleDOMEvent,this)},_handleDOMEvent:function(a){var b=a.type;"mousedown"!==b&&"click"!==b||2!==a.button||(b="contextmenu");"contextmenu"===b&&c.DomUtil.preventDefault(a);if(!this._ignoreEvent(a)){if("mousedown"===b)this._mouseDownTime=c.Util.now();else if("click"===b&&this._mouseDownTime&&300<c.Util.now()-this._mouseDownTime)return;this._fireDOMEvent(this,a,b)}},_ignoreEvent:function(a){if(!a||!this._panels.control)return!1;if(a=a.srcElement||a.target)for(;a&&a!==this._containerDOM;){if(a.className&&
        a.className.indexOf&&(0<=a.className.indexOf("maptalks-control")||0<=a.className.indexOf("maptalks-ui")))return!0;a=a.parentNode}return!1},_parseEvent:function(a,b){if(!a)return null;var d={domEvent:a};if("keypress"!==b){var e=a.touches&&0<a.touches.length?a.touches[0]:a.changedTouches&&0<a.changedTouches.length?a.changedTouches[0]:a;e&&(e=c.DomUtil.getEventContainerPoint(e,this._containerDOM),d.coordinate=this.containerPointToCoordinate(e),d.containerPoint=e,d.viewPoint=this.containerPointToViewPoint(e),
        d.point2d=this._containerPointToPoint(e))}return d},_fireDOMEvent:function(a,b,c){a=this._parseEvent(b,c);this._fireEvent(c,a)}});c.Map.include({requestFullScreen:function(){this._fireEvent("fullscreenstart");this._requestFullScreen(this._containerDOM);this._fireEvent("fullscreenend");return this},cancelFullScreen:function(){this._cancelFullScreen(this._containerDOM);this._fireEvent("cancelfullscreen");return this},_requestFullScreen:function(a){a.requestFullScreen?a.requestFullScreen():a.mozRequestFullScreen?
            a.mozRequestFullScreen():a.webkitRequestFullScreen?a.webkitRequestFullScreen():a.msRequestFullScreen?a.msRequestFullScreen():null!==window.open(location.href,"_blank","fullscreen=1,status=no,resizable=yes,top=0,left=0,scrollbars=no,titlebar=no,menubar=no,location=no,toolbar=no,z-look=yes,width="+(screen.availWidth-8)+",height="+(screen.availHeight-45))&&(window.opener=null,window.close())},_cancelFullScreen:function(){document.cancelFullScreen?document.cancelFullScreen():document.mozCancelFullScreen?
            document.mozCancelFullScreen():document.webkitCancelFullScreen?document.webkitCancelFullScreen():null!==window.open(location.href,"_blank","fullscreen=no,status=yes,resizable=yes,scrollbars=no,titlebar=no,menubar=yes,location=yes,toolbar=yes,z-look=yes")&&(window.opener=null,window.close())}});c.Layer.fromJSON=function(a){if(!a)return null;var b=a.type;"vector"===b?b=a.type="VectorLayer":"dynamic"===b?b=a.type="DynamicLayer":"tile"===b&&(b=a.type="TileLayer");if("undefined"===typeof c[b]||!c[b].fromJSON)throw Error("unsupported layer type:"+
        b);return c[b].fromJSON(a)};c.Map.include({PROFILE_VERSION:"1.0",toJSON:function(a){a||(a={});var b={version:this.PROFILE_VERSION,extent:this.getExtent().toJSON()};b.options=this.config();b.options.center=this.getCenter();b.options.zoom=this.getZoom();var d=this.getBaseLayer();(c.Util.isNil(a.baseLayer)||a.baseLayer)&&d&&(b.baseLayer=d.toJSON(a.baseLayer));d={};a.clipExtent&&(d.clipExtent=!0===a.clipExtent?this.getExtent():a.clipExtent);var e,f,g,h,k=[];if(c.Util.isNil(a.layers)||a.layers&&!c.Util.isArray(a.layers)){g=
        this.getLayers();e=0;for(f=g.length;e<f;e++)g[e].toJSON&&(h=c.Util.extend({},c.Util.isObject(a.layers)?a.layers:{},d),k.push(g[e].toJSON(h)));b.layers=k}else if(c.Util.isArrayHasData(a.layers)){g=a.layers;for(e=0;e<g.length;e++)h=g[e],a=this.getLayer(h.id),a.toJSON&&(h=c.Util.extend({},h.options,d),k.push(a.toJSON(h)));b.layers=k}else b.layers=[];return b}});c.Map.fromJSON=function(a,b,d){if(!a||!b)return null;d||(d={});a=new c.Map(a,b.options);if(c.Util.isNil(d.baseLayer)||d.baseLayer){var e=c.Layer.fromJSON(b.baseLayer);
        e&&a.setBaseLayer(e)}if(c.Util.isNil(d.layers)||d.layers){d=[];b=b.layers;for(e=0;e<b.length;e++){var f=c.Layer.fromJSON(b[e]);d.push(f)}a.addLayer(d)}return a};c.Map.mergeOptions({draggable:!0});c.Map.Drag=c.Handler.extend({addHooks:function(){var a=this.target;a&&(this._dragHandler=new c.Handler.Drag(a._panels.mapWrapper||a._containerDOM,{cancelOn:c.Util.bind(this._cancelOn,this)}),this._dragHandler.on("mousedown",this._onMouseDown,this).on("dragstart",this._onDragStart,this).on("dragging",this._onDragging,
        this).on("dragend",this._onDragEnd,this).enable())},removeHooks:function(){this._dragHandler.off("mousedown",this._onMouseDown,this).off("dragstart",this._onDragStart,this).off("dragging",this._onDragging,this).off("dragend",this._onDragEnd,this).disable();this._dragHandler.remove();delete this._dragHandler},_cancelOn:function(a){return this._ignore(a)?!0:!1},_ignore:function(a){if(!a)return!1;a.domEvent&&(a=a.domEvent);return this.target._ignoreEvent(a)},_onMouseDown:function(a){this.target._panAnimating&&
    (this.target._enablePanAnimation=!1);c.DomUtil.preventDefault(a.domEvent)},_onDragStart:function(a){var b=this.target;this.startDragTime=c.Util.now();var d=b.offsetPlatform();this.startLeft=d.x;this.startTop=d.y;this.preX=a.mousePos.x;this.preY=a.mousePos.y;this.startX=this.preX;this.startY=this.preY;b.onMoveStart(a)},_onDragging:function(a){if(void 0!==this.startLeft){var b=this.target,d=this.startLeft+a.mousePos.x-this.startX,e=this.startTop+a.mousePos.y-this.startY,f=b.offsetPlatform(),d=(new c.Point(d,
        e))._substract(f);b.offsetPlatform(d);b._offsetCenterByPixel(d);b.onMoving(a)}},_onDragEnd:function(a){if(void 0!==this.startLeft){var b=this.target,d=c.Util.now()-this.startDragTime,e=b.offsetPlatform(),f=e.x-this.startLeft,e=e.y-this.startTop;delete this.startLeft;delete this.startTop;delete this.preX;delete this.preY;delete this.startX;delete this.startY;if(280>d&&5<Math.abs(e)+Math.abs(f))a=new c.Point(f,e),d=5*d*(Math.abs(a.x)+Math.abs(a.y))/500,b._panAnimation(a,d);else b.onMoveEnd(a)}}});c.Map.addInitHook("addHandler",
        "draggable",c.Map.Drag);c.Map.mergeOptions({autoBorderPanning:!1});c.Map.AutoBorderPanning=c.Handler.extend({threshold:10,step:4,addHooks:function(){this.dom=this.target._containerDOM;c.DomUtil.on(this.dom,"mousemove",this._onMouseMove,this);c.DomUtil.on(this.dom,"mouseout",this._onMouseOut,this)},removeHooks:function(){this._cancelPan();c.DomUtil.off(this.dom,"mousemove",this._onMouseMove,this);c.DomUtil.off(this.dom,"mouseout",this._onMouseOut,this)},_onMouseMove:function(a){a=this.target._parseEvent(a).containerPoint;
        var b=this.target.getSize();a=[a.x,b.width-a.x,a.y,b.height-a.y];var b=Math.min.apply(Math,a),d=Math.abs(b);if(0===d||d>this.threshold)this._cancelPan();else{var d=this.step,e=new c.Point(0,0);a[0]===b?e.x=-d:a[1]===b&&(e.x=d);a[2]===b?e.y=-d:a[3]===b&&(e.y=d);this._stepOffset=e;this._pan()}},_onMouseOut:function(){this._cancelPan()},_cancelPan:function(){delete this._stepOffset;this._animationId&&(c.Util.cancelAnimFrame(this._animationId),delete this._animationId)},_pan:function(){this._stepOffset&&
    (this.target.panBy(this._stepOffset,{animation:!1}),this._animationId=c.Util.requestAnimFrame(c.Util.bind(this._pan,this)))}});c.Map.addInitHook("addHandler","autoBorderPanning",c.Map.AutoBorderPanning);c.Map.mergeOptions({doubleClickZoom:!0});c.Map.DoubleClickZoom=c.Handler.extend({addHooks:function(){this.target.on("_dblclick",this._onDoubleClick,this)},removeHooks:function(){this.target.off("_dblclick",this._onDoubleClick,this)},_onDoubleClick:function(a){var b=this.target;if(b.options.doubleClickZoom){var c=
        b.getZoom();b._zoomAnimation(a.domEvent.shiftKey?Math.ceil(c)-1:Math.floor(c)+1,a.containerPoint)}}});c.Map.addInitHook("addHandler","doubleClickZoom",c.Map.DoubleClickZoom);c.Map.mergeOptions({scrollWheelZoom:!0});c.Map.ScrollWheelZoom=c.Handler.extend({addHooks:function(){c.DomUtil.addDomEvent(this.target._containerDOM,"mousewheel",this._onWheelScroll,this)},removeHooks:function(){c.DomUtil.removeDomEvent(this.target._containerDOM,"mousewheel",this._onWheelScroll)},_onWheelScroll:function(a){var b=
        this.target,d=b._containerDOM;c.DomUtil.preventDefault(a);c.DomUtil.stopPropagation(a);if(b._zooming)return!1;var e=0,e=e+(0<(a.wheelDelta?a.wheelDelta:a.detail)?1:-1);a.detail&&(e*=-1);var f=c.DomUtil.getEventContainerPoint(a,d);this._wheelExecutor&&clearTimeout(this._wheelExecutor);this._wheelExecutor=setTimeout(function(){b._zoomAnimation(b.getZoom()+e,f)},40);return!1}});c.Map.addInitHook("addHandler","scrollWheelZoom",c.Map.ScrollWheelZoom);c.Map.mergeOptions({touchZoom:!0,touchZoomOrigin:"center"});
    c.Map.TouchZoom=c.Handler.extend({addHooks:function(){c.DomUtil.addDomEvent(this.target._containerDOM,"touchstart",this._onTouchStart,this)},removeHooks:function(){c.DomUtil.removeDomEvent(this.target._containerDOM,"touchstart",this._onTouchStart)},_onTouchStart:function(a){var b=this.target;if(a.touches&&2===a.touches.length&&!b._zooming){var d=b._containerDOM,e=c.DomUtil.getEventContainerPoint(a.touches[0],d),d=c.DomUtil.getEventContainerPoint(a.touches[1],d);this._startDist=e.distanceTo(d);this._startZoom=
        b.getZoom();"pinch"===b.options.touchZoomOrigin?this._preOrigin=e.add(d)._multi(.5):(e=b.getSize(),this._preOrigin=new c.Point(e.width/2,e.height/2));b._zooming=!0;c.DomUtil.addDomEvent(document,"touchmove",this._onTouchMove,this).addDomEvent(document,"touchend",this._onTouchEnd,this);c.DomUtil.preventDefault(a);b._fireEvent("touchzoomstart")}},_onTouchMove:function(a){var b=this.target;if(a.touches&&2===a.touches.length&&b._zooming){var d=b._containerDOM,e=c.DomUtil.getEventContainerPoint(a.touches[0],
        d),d=c.DomUtil.getEventContainerPoint(a.touches[1],d);a=e.distanceTo(d)/this._startDist;"pinch"===b.options.touchZoomOrigin?e=e.add(d)._multi(.5):(e=b.getSize(),e=new c.Point(e.width/2,e.height/2));d=this._preOrigin.substract(e);b.offsetPlatform(d);b._offsetCenterByPixel(d);this._preOrigin=e;this._scale=a;d=b._getRenderer();a=b._generateMatrices(e,a);d.transform(a);b._fireEvent("touchzooming",{matrix:a})}},_onTouchEnd:function(){var a=this.target;if(a._zooming){a._zooming=!1;c.DomUtil.off(document,
        "touchmove",this._onTouchMove,this).off(document,"touchend",this._onTouchEnd,this);var b=a.getZoomForScale(this._scale);-1===b&&(b=a.getZoom());a._fireEvent("touchzoomend");b===a.getZoom()?a._getRenderer().transform(null):a._zoomAnimation(b,this._preOrigin,this._scale)}else a._zooming=!1}});c.Map.addInitHook("addHandler","touchZoom",c.Map.TouchZoom);c.Map.mergeOptions({geometryEvents:!0});c.Map.GeometryEvents=c.Handler.extend({EVENTS:"mousedown mouseup mousemove click dblclick contextmenu touchstart touchmove touchend",
        addHooks:function(){var a=this.target;if(a=a._panels.allLayers||a._containerDOM)c.DomUtil.on(a,this.EVENTS,this._identifyGeometryEvents,this)},removeHooks:function(){var a=this.target;(a=a._panels.allLayers||a._containerDOM)&&c.DomUtil.off(a,this.EVENTS,this._identifyGeometryEvents,this)},_identifyGeometryEvents:function(a){function b(b){var e=!0,g;if("mousemove"===f){var h={};if(c.Util.isArrayHasData(b))for(g=b.length-1;0<=g;g--)h[b[g]._getInternalId()]=b[g],b[g]._onEvent(a),e=b[g]._onMouseOver(a);
            d._setPriorityCursor(k);var l=n._prevMouseOverTargets;n._prevMouseOverTargets=b;if(c.Util.isArrayHasData(l))for(g=l.length-1;0<=g;g--){var m=l[g],v=l[g]._getInternalId();if(b&&0<b.length){var x=!0;h[v]&&(x=!1);x&&m._onMouseOut(a)}else m._onMouseOut(a)}}else{if(!b||0===b.length)return;e=b[b.length-1]._onEvent(a)}!1===e&&c.DomUtil.stopPropagation(a)}var d=this.target,e=d._getLayers(function(a){return a instanceof c.VectorLayer?!0:!1});if(!d._isBusy()&&e&&0!==e.length){var f=a.type;if("mousedown"===
            f)this._mouseDownTime=c.Util.now();else if("click"===f&&this._mouseDownTime&&300<c.Util.now()-this._mouseDownTime)return;for(var g=[],h=0;h<e.length;h++)e[h].options.geometryEvents&&g.push(e[h]);if(0!==g.length&&(e=a.touches&&0<a.touches.length?a.touches[0]:a.changedTouches&&0<a.changedTouches.length?a.changedTouches[0]:a)){e=c.DomUtil.getEventContainerPoint(e,d._containerDOM);e=d.containerPointToCoordinate(e);"touchstart"===f&&c.DomUtil.preventDefault(a);var k=null,l={includeInternals:!0,filter:function(b){var c=
            b._getEventTypeToFire(a);if("mousemove"===f){if(!k&&b.options.cursor&&(k=b.options.cursor),!b.listens("mousemove")&&!b.listens("mouseover"))return!1}else if(!b.listens(c))return!1;return!0},count:1,coordinate:e,layers:g},m=c.Util.bind(b,this),n=this;this._queryIdentifyTimeout&&c.Util.cancelAnimFrame(this._queryIdentifyTimeout);"mousemove"===f||"touchmove"===f?this._queryIdentifyTimeout=c.Util.requestAnimFrame(function(){d.identify(l,m)}):d.identify(l,m)}}}});c.Map.addInitHook("addHandler","geometryEvents",
        c.Map.GeometryEvents);c.renderer={};c.renderer.Canvas=c.Class.extend({isCanvasRender:function(){return!0},render:function(a){this.prepareRender();if(this.getMap())if(this.layer.isVisible())if(this.resources||(this.resources=new c.renderer.Canvas.Resources),this.checkResources&&a){var b=this,d=arguments,e=this.checkResources.apply(this,d);c.Util.isArrayHasData(e)?this.loadResources(e).then(function(){b.layer&&(b.layer.fire("resourceload"),b._tryToDraw.apply(b,d))}):this._tryToDraw.apply(this,d)}else this._tryToDraw.apply(this,
        arguments);else this.completeRender()},_tryToDraw:function(){this._clearTimeout();if(!this.canvas&&this.layer.isEmpty&&this.layer.isEmpty())this.completeRender();else{var a=this,b=arguments;this.layer.options.drawImmediate?this.draw.apply(this,b):this._animReqId=c.Util.requestAnimFrame(function(){a.layer&&a.draw.apply(a,b)})}},remove:function(){this._clearTimeout();if(this.onRemove)this.onRemove();delete this.canvas;delete this.context;delete this._extent2D;delete this.resources;c.renderer.Canvas.prototype.requestMapToRender.call(this);
        delete this.layer},getMap:function(){return this.layer?this.layer.getMap():null},getCanvasImage:function(){if(!this.canvas||this.layer.isEmpty&&this.layer.isEmpty()||!this._extent2D||this.isBlank&&this.isBlank())return null;var a=this.getMap(),b=this._extent2D.getSize(),c=this._extent2D.getMin(),a=a._pointToContainerPoint(c);return{image:this.canvas,layer:this.layer,point:a,size:b}},isLoaded:function(){return this._loaded?!0:!1},show:function(){var a=this.layer.getMask();if(a)a.onZoomEnd();this.render(!0)},
        hide:function(){this.clearCanvas();this.requestMapToRender()},setZIndex:function(){this.requestMapToRender()},getRenderZoom:function(){return this._renderZoom},hitDetect:function(a){if(!this.context||this.layer.isEmpty&&this.layer.isEmpty()||this._errorThrown)return!1;var b=this.getMap()._get2DExtent(),c=b.getSize(),b=b.getMin();a=a.substract(b);if(0>a.x||a.x>c.width||0>a.y||a.y>c.height)return!1;try{if(0<this.context.getImageData(a.x,a.y,1,1).data[3])return!0}catch(e){this._errorThrown||(console&&
        console.warn("hit detect failed with tainted canvas, some geometries have external resources in another domain:\n",e),this._errorThrown=!0)}return!1},loadResources:function(a){var b=this.resources,d=[];if(c.Util.isArrayHasData(a))for(var e={},f,g=a.length-1;0<=g;g--)(f=a[g])&&!e[f.join("-")]&&(e[f.join("-")]=1,b.isResourceLoaded(f,!0)||d.push(new c.Promise(this._promiseResource(f))));return c.Promise.all(d)},_promiseResource:function(a){var b=this,d=this.resources,e=this.layer.options.crossOrigin;
            return function(f){if(d.isResourceLoaded(a,!0))f(a);else{var g=new Image;e&&(g.crossOrigin=e);c.Util.isSVG(a[0])&&!c.node&&(a[1]&&(a[1]*=2),a[2]&&(a[2]*=2));g.onload=function(){b._cacheResource(a,g);f(a)};g.onabort=function(b){console&&console.warn("image loading aborted: "+a[0]);b&&console&&console.warn(b);f(a)};g.onerror=function(b){b&&!c.Browser.phantomjs&&console&&console.warn(b);d.markErrorResource(a);f(a)};c.Util.loadImage(g,a)}}},_cacheResource:function(a,b){if(this.layer&&this.resources){var d=
            a[1],e=a[2];if(this.layer.options.cacheSvgOnCanvas&&1===c.Util.isSVG(a[0])&&(c.Browser.edge||c.Browser.ie)){c.Util.isNil(d)&&(d=b.width||this.layer.options.defaultIconSize[0]);c.Util.isNil(e)&&(e=b.height||this.layer.options.defaultIconSize[1]);var f=c.Canvas.createCanvas(d,e);c.Canvas.image(f.getContext("2d"),b,0,0,d,e);b=f}this.resources.addResource(a,b)}},prepareRender:function(){this._renderZoom=this.getMap().getZoom();this._extent2D=this.getMap()._get2DExtent();this._loaded=!1},createCanvas:function(){if(!this.canvas){var a=
            this.getMap(),b=a.getSize(),d=c.Browser.retina?2:1;this.canvas=c.Canvas.createCanvas(d*b.width,d*b.height,a.CanvasClass);this.context=this.canvas.getContext("2d");this.layer.options.globalCompositeOperation&&(this.context.globalCompositeOperation=this.layer.options.globalCompositeOperation);c.Browser.retina&&this.context.scale(2,2);c.Canvas.setDefaultCanvasSetting(this.context);if(this.onCanvasCreate)this.onCanvasCreate()}},resizeCanvas:function(a){if(this.canvas){a=a?a:this.getMap().getSize();var b=
            c.Browser.retina?2:1;this.canvas.width>=b*a.width&&this.canvas.height>=b*a.height||(this.canvas.height=b*a.height,this.canvas.width=b*a.width,c.Browser.retina&&this.context.scale(2,2))}},clearCanvas:function(){this.canvas&&c.Canvas.clearRect(this.context,0,0,this.canvas.width,this.canvas.height)},prepareCanvas:function(){this._clipped&&(this.context.restore(),this._clipped=!1);this.canvas?this.clearCanvas():this.createCanvas();var a=this.layer.getMask();if(!a)return this.layer.fire("renderstart",
            {context:this.context}),null;var b=a._getPainter().get2DExtent();if(!b.intersects(this._extent2D))return this.layer.fire("renderstart",{context:this.context}),b;this.context.save();a._getPainter().paint();this.context.clip();this._clipped=!0;this.layer.fire("renderstart",{context:this.context});return b},get2DExtent:function(){return this._extent2D},requestMapToRender:function(){this.getMap()&&(this.context&&this.layer.fire("renderend",{context:this.context}),this.getMap()._getRenderer().render())},
        fireLoadedEvent:function(){this._loaded=!0;this.layer&&this.layer.fire("layerload")},completeRender:function(){this.requestMapToRender();this.fireLoadedEvent()},getPaintContext:function(){return this.context?[this.context,this.resources]:null},getEvents:function(){return{_zoomstart:this.onZoomStart,_zoomend:this.onZoomEnd,_resize:this.onResize,_movestart:this.onMoveStart,_moving:this.onMoving,_moveend:this.onMoveEnd}},onZoomStart:function(){},onZoomEnd:function(){this._drawOnEvent()},onMoveStart:function(){},
        onMoving:function(){},onMoveEnd:function(){this._drawOnEvent()},onResize:function(){this.resizeCanvas();this._drawOnEvent()},_drawOnEvent:function(){this.prepareRender();this.layer.isVisible()&&this.draw()},_clearTimeout:function(){this._animReqId&&c.Util.cancelAnimFrame(this._animReqId)}});c.renderer.Canvas.Resources=function(){this.resources={};this._errors={}};c.Util.extend(c.renderer.Canvas.Resources.prototype,{addResource:function(a,b){this.resources[a[0]]={image:b,width:+a[1],height:+a[2]}},
        isResourceLoaded:function(a,b){if(!a)return!1;if(this._errors[this._getImgUrl(a)])return!0;var d=this.resources[this._getImgUrl(a)];return!d||b&&c.Util.isSVG(a[0])&&(+a[1]>d.width||+a[2]>d.height)?!1:!0},getImage:function(a){return!this.isResourceLoaded(a)||this._errors[this._getImgUrl(a)]?null:this.resources[this._getImgUrl(a)].image},markErrorResource:function(a){this._errors[this._getImgUrl(a)]=1},merge:function(a){if(!a)return this;for(var b in a.resources){var c=a.resources[b];this.addResource([b,
            c.width,c.height],c.image)}return this},_getImgUrl:function(a){return c.Util.isArray(a)?a[0]:a}});c.renderer.map={};c.renderer.map.Renderer=c.Class.extend({panAnimation:function(a,b,d){a=new c.Point(a);var e=this.map;if(e.options.panAnimation){b=b?b:e.options.panAnimationDuration;e._enablePanAnimation=!0;e._panAnimating=!0;var f=null,g=c.Animation.animate({distance:a},{easing:"out",speed:b},function(a){if(e._enablePanAnimation)if("running"===g.playState&&a.styles.distance){a=a.styles.distance;f||
    (f=a);var b=a.substract(f);e.offsetPlatform(b);e._offsetCenterByPixel(b);f=a;e.onMoving()}else"finished"===g.playState&&(e._panAnimating=!1,d&&d(),e.onMoveEnd());else g.finish(),e._panAnimating=!1,e.onMoveEnd()});g.play()}else e.onMoveEnd()},offsetPlatform:function(a){if(!this.map._panels.mapPlatform)return this;a=this.map.offsetPlatform().add(a)._round();c.DomUtil.offsetDom(this.map._panels.mapPlatform,a);c.DomUtil.offsetDom(this.map._panels.canvasContainer,a.multi(-1));c.Browser.mobile&&c.DomUtil.offsetDom(this.map._panels.canvasContainer,
        a);return this},resetContainer:function(){this.map._resetMapViewPoint();if(this.map._panels.mapPlatform){var a=new c.Point(0,0);c.DomUtil.offsetDom(this.map._panels.mapPlatform,a);c.DomUtil.offsetDom(this.map._panels.canvasContainer,a);c.Browser.mobile&&c.DomUtil.offsetDom(this.map._panels.canvasContainer,a)}},onZoomEnd:function(){this.resetContainer()},onLoad:function(){this.render()}});c.renderer.map.Canvas=c.renderer.map.Renderer.extend({initialize:function(a){this.map=a;this._isCanvasContainer=
        !!a._containerDOM.getContext;this._registerEvents()},isCanvasRender:function(){return!0},render:function(){this.map._fireEvent("renderstart",{context:this.context});this.canvas||this.createCanvas();var a=this.map.getZoom(),b=this._getAllLayerToTransform();this._updateCanvasSize()||this.clearCanvas();this._drawBackground();for(var c=0,e=b.length;c<e;c++)if(b[c].isVisible()&&b[c].isCanvasRender()){var f=b[c]._getRenderer();f&&f.getRenderZoom()===a&&(f=this._getLayerImage(b[c]))&&f.image&&this._drawLayerCanvasImage(b[c],
        f)}this._drawCenterCross();this.map._fireEvent("renderend",{context:this.context})},animateZoom:function(a,b){if(c.Browser.ielt9)b.call(this);else{var d=this.map;this.clearCanvas();if(d.options.zoomAnimation){var e=d.getBaseLayer(),f=this._getLayerImage(e);f&&this._storeBackground(f);var g=d.options.layerZoomAnimation?null:[e],h;1===a.startScale&&this._beforeTransform();var k=c.Animation.animate({scale:[a.startScale,a.endScale]},{easing:"out",speed:a.duration},c.Util.bind(function(c){"finished"===
    k.playState?(this._afterTransform(h),this._drawCenterCross(),b.call(this)):"running"===k.playState&&(h=this._transformZooming(a.origin,c.styles.scale,g),d._fireEvent("zooming",{matrix:h}))},this)).play()}else b.call(this)}},transform:function(a,b){this.map._fireEvent("renderstart",{context:this.context});var d=b||this._getAllLayerToTransform();this.clearCanvas();var e=!c.Browser.mobile&&this.map.options.layerTransforming;e||(this.context.save(),this._applyTransform(a));for(var f=0,g=d.length;f<g;f++)if(d[f].isVisible()){var h=
        d[f]._getRenderer();if(h)if(h.isCanvasRender&&h.isCanvasRender()){var k=!1;e&&h.transform&&(k=h.transform(a));e&&!k&&(this.context.save(),this._applyTransform(a));(h=this._getLayerImage(d[f]))&&h.image&&this._drawLayerCanvasImage(d[f],h);e&&!k&&this.context.restore()}else h.transform&&h.transform(a)}e||this.context.restore();this._drawCenterCross();this.map._fireEvent("renderend",{context:this.context})},updateMapSize:function(a){if(a&&!this._isCanvasContainer){var b=a.width;a=a.height;var c=this.map._panels;
        c.mapWrapper.style.width=b+"px";c.mapWrapper.style.height=a+"px";c.canvasContainer.style.width=b+"px";c.canvasContainer.style.height=a+"px";this._updateCanvasSize()}},getMainPanel:function(){return this.map?this._isCanvasContainer?this.map._containerDOM:this.map._panels?this.map._panels.mapWrapper:null:null},toDataURL:function(a){return this.canvas?this.canvas.toDataURL(a):null},remove:function(){this._resizeInterval&&clearInterval(this._resizeInterval);this._resizeFrame&&c.Util.cancelAnimFrame(this._resizeFrame);
        delete this.context;delete this.canvas;delete this.map;delete this._canvasBgRes;delete this._canvasBgCoord;delete this._canvasBg;delete this._zoomingMatrix},_getLayerImage:function(a){return a&&a._getRenderer()&&a._getRenderer().getCanvasImage?a._getRenderer().getCanvasImage():null},_transformZooming:function(a,b,c){this._zoomingMatrix=a=this.map._generateMatrices(a,b);this.transform(a,c);return a},_beforeTransform:function(){var a=this.map;if(a.options.layerZoomAnimation)this.render();else{var a=
        a.getBaseLayer(),b=this._getLayerImage(a);b&&this._drawLayerCanvasImage(a,b)}},_afterTransform:function(a){this.clearCanvas();this._applyTransform(a);this._drawBackground();this.context.setTransform(1,0,0,1,0,0)},_applyTransform:function(a){a&&(a=c.Browser.retina?a.retina:a.container,a.applyToContext(this.context))},_getCountOfGeosToDraw:function(){for(var a=this._getAllLayerToTransform(),b,d,e=0,f=a.length-1;0<=f;f--)d=a[f]._getRenderer(),a[f]instanceof c.VectorLayer&&a[f].isVisible()&&!a[f].isEmpty()&&
    d._hasPointSymbolizer&&(b=d._geosToDraw)&&(e+=d._geosToDraw.length);return e},initContainer:function(){function a(a,d,e,f){d=c.DomUtil.createEl("div",d);e&&(d.style.cssText=e);b[a]=d;f||c.DomUtil.preventSelection(d);return d}var b=this.map._panels,d=this.map._containerDOM;if(!this._isCanvasContainer){d.innerHTML="";var e=a("control","maptalks-control",null,!0),f=a("mapWrapper","maptalks-wrapper","position:absolute;overflow:hidden;",!0),g=a("mapPlatform","maptalks-platform","position:absolute;top:0px;left:0px;will-change:transform;",
        !0),h=a("ui","maptalks-ui","position:absolute;top:0px;left:0px;border:none;",!0),k=a("allLayers","maptalks-all-layers","position:absolute;top:0px;left:0px;"),l=a("layer","maptalks-layer","position:absolute;left:0px;top:0px;"),m=a("frontLayer","maptalks-front-layer","position:absolute;left:0px;top:0px;"),n=a("canvasContainer","maptalks-layer-canvas","position:absolute;top:0px;left:0px;border:none;will-change:transform;");d.appendChild(f);g.appendChild(k);g.appendChild(h);f.appendChild(g);k.appendChild(l);
        k.appendChild(n);k.appendChild(m);f.appendChild(e);this.createCanvas();this.resetContainer();d=this.map._getContainerDomSize();this.updateMapSize(d)}},_drawLayerCanvasImage:function(a,b){if(a&&b){var d=b.point.multi(c.Browser.retina?2:1),e=b.image;if(!(0>=d.x+e.width||0>=d.y+e.height)){var f=a.options.opacity;c.Util.isNumber(f)||(f=1);if(!(0>=f)){var g=b.opacity;c.Util.isNumber(g)||(g=1);if(!(0>=g)){var h=this.context.globalAlpha;1>f&&(this.context.globalAlpha*=f);1>g&&(this.context.globalAlpha*=
        g);a.options.cssFilter&&(this.context.filter=a.options.cssFilter);c.node&&(f=e.getContext("2d"),f.getSvg&&(e=f));(a.options.dx||a.options.dy)&&d._add(a.options.dx,a.options.dy);this.context.drawImage(e,d.x,d.y);this.context.globalAlpha=h;"none"!==this.context.filter&&(this.context.filter="none")}}}}},_storeBackground:function(a){if(a){var b=this.map;this._canvasBg=c.DomUtil.copyCanvas(a.image);this._canvasBgRes=b._getResolution();this._canvasBgCoord=b.containerPointToCoordinate(a.point)}},_drawBackground:function(){var a=
        this.map;if(this._canvasBg){var b=this.map.getBaseLayer();b.options.cssFilter&&(this.context.filter=b.options.cssFilter);b=this._canvasBgRes/a._getResolution();a=a.coordinateToContainerPoint(this._canvasBgCoord)._multi(c.Browser.retina?2:1);c.Canvas.image(this.context,this._canvasBg,a.x,a.y,this._canvasBg.width*b,this._canvasBg.height*b);"none"!==this.context.filter&&(this.context.filter="none")}},_drawCenterCross:function(){if(this.map.options.centerCross){var a=new c.Point(this.canvas.width/2,this.canvas.height/
        2);this.context.strokeStyle="#ff0000";this.context.lineWidth=2;this.context.beginPath();this.context.moveTo(a.x-5,a.y);this.context.lineTo(a.x+5,a.y);this.context.moveTo(a.x,a.y-5);this.context.lineTo(a.x,a.y+5);this.context.stroke()}},_getAllLayerToTransform:function(){return this.map._getLayers()},clearCanvas:function(){this.canvas&&c.Canvas.clearRect(this.context,0,0,this.canvas.width,this.canvas.height)},_updateCanvasSize:function(){if(!this.canvas||this._isCanvasContainer)return!1;var a=this.map.getSize(),
        b=this.canvas,d=c.Browser.retina?2:1;if(a.width*d===b.width&&a.height*d===b.height)return!1;b.height=d*a.height;b.width=d*a.width;b.style&&(b.style.width=a.width+"px",b.style.height=a.height+"px");return!0},createCanvas:function(){this._isCanvasContainer?this.canvas=this.map._containerDOM:(this.canvas=c.DomUtil.createEl("canvas"),this._updateCanvasSize(),this.map._panels.canvasContainer.appendChild(this.canvas));this.context=this.canvas.getContext("2d")},_checkSize:function(){c.Util.cancelAnimFrame(this._resizeFrame);
        this.map._zooming||this.map._moving||this.map._panAnimating||(this._resizeFrame=c.Util.requestAnimFrame(c.Util.bind(function(){this.map._moving||this.map._isBusy()||this.map.checkSize()},this)))},_registerEvents:function(){var a=this.map;a.on("_baselayerchangestart",function(){delete this._canvasBg},this);a.on("_baselayerload",function(){var b=a.getBaseLayer();a.options.zoomBackground&&!b.getMask()||delete this._canvasBg},this);a.on("_resize",function(){delete this._canvasBg},this);a.on("_zoomstart",
        function(){delete this._canvasBg;this.clearCanvas()},this);a.options.checkSize&&!c.node&&"undefined"!==typeof window&&(this._resizeInterval=setInterval(c.Util.bind(function(){a._containerDOM.parentNode?this._checkSize():clearInterval(this._resizeInterval)},this),1E3));!c.Browser.mobile&&c.Browser.canvas&&(this._onMapMouseMove=function(b){a._isBusy()||a._moving||!a.options.hitDetect||(this._hitDetectTimeout&&c.Util.cancelAnimFrame(this._hitDetectTimeout),this._hitDetectTimeout=c.Util.requestAnimFrame(function(){for(var c=
        b.point2d,e=a._getLayers(),f=!1,g,h=e.length-1;0<=h;h--){var k=e[h];if(k._getRenderer()&&k._getRenderer().hitDetect&&"default"!==k.options.cursor&&k._getRenderer().hitDetect(c)){g=k.options.cursor;f=!0;break}}f?a._trySetCursor(g):a._trySetCursor("default")}))},a.on("_mousemove",this._onMapMouseMove,this));a.on("_moveend",function(){c.Browser.mobile&&c.DomUtil.offsetDom(this.canvas,a.offsetPlatform().multi(-1));this.render()},this);if(c.Browser.mobile)a.on("_zoomend",function(){c.DomUtil.offsetDom(this.canvas,
        new c.Point(0,0))},this);else a.on("_moving",function(){this.render()},this)}});c.Map.registerRenderer("canvas",c.renderer.map.Canvas);c.TileLayer.TileCache=function(a){this._queue=[];this._cache={};a||(a=128);this.capacity=a};c.Util.extend(c.TileLayer.TileCache.prototype,{add:function(a,b){this._cache[a]=b;this._queue.push(a);this._expireCache()},get:function(a){return this._cache[a]},remove:function(a){delete this._cache[a]},_expireCache:function(){this._expTimeout&&clearTimeout(this._expTimeout);
        var a=this;this._expTimeout=setTimeout(function(){var b=a._queue.length;if(b>a.capacity)for(var b=a._queue.splice(0,b-a.capacity),c=b.length-1;0<=c;c--)delete a._cache[b[c]]},1E3)}});c.renderer.tilelayer={};c.renderer.tilelayer.Canvas=c.renderer.Canvas.extend({propertyOfPointOnTile:"--maptalks-tile-point",propertyOfTileId:"--maptalks-tile-id",propertyOfTileZoom:"--maptalks-tile-zoom",initialize:function(a){this.layer=a;this._mapRender=a.getMap()._getRenderer();c.node&&this.layer.options.cacheTiles||
    (this._tileCache=new c.TileLayer.TileCache);this._tileQueue={}},clear:function(){this.clearCanvas();this.requestMapToRender()},clearExecutors:function(){clearTimeout(this._loadQueueTimeout)},draw:function(){var a=this.layer,b=a._getTiles();if(b){this._tileRended||(this._tileRended={});var d=this._tileRended;this._tileRended={};var e=b.tiles,f=this._tileCache,a=a.getTileSize();this._extent2D=b.fullExtent;this._viewExtent=b.viewExtent;this.canvas||this.createCanvas();this.resizeCanvas(b.fullExtent.getSize());
        if((b=this.prepareCanvas())&&!b.intersects(this._extent2D))this.completeRender();else{this._totalTileToLoad=this._tileToLoadCounter=0;for(var g,h,k,l=e.length-1;0<=l;l--)b=e[l],g=e[l].id,h=d[g]||f?f.get(g):null,k=new c.PointExtent(b["2dPoint"],b["2dPoint"].add(a.toPoint())),this._extent2D.intersects(k)&&(this._totalTileToLoad++,h?(this._drawTile(b.viewPoint,h),this._tileRended[g]=h):(this._tileToLoadCounter++,this._tileQueue[g+"@"+b.viewPoint.toString()]=b));0===this._tileToLoadCounter?this.completeRender():
            (this._tileToLoadCounter<this._totalTileToLoad&&this.requestMapToRender(),this._scheduleLoadTileQueue())}}else this.completeRender()},getCanvasImage:function(){if(this._renderZoom!==this.getMap().getZoom()||!this.canvas)return null;var a=null;this._gradualLoading&&this._totalTileToLoad&&this.layer.options.gradualLoading&&(a=(this._totalTileToLoad-this._tileToLoadCounter)/this._totalTileToLoad*1.5,1<a&&(a=1));var b=c.renderer.Canvas.prototype.getCanvasImage.apply(this,arguments);b.opacity=a;return b},
        _scheduleLoadTileQueue:function(){this._loadQueueTimeout&&c.Util.cancelAnimFrame(this._loadQueueTimeout);var a=this;this._loadQueueTimeout=c.Util.requestAnimFrame(function(){a._loadTileQueue()})},_loadTileQueue:function(){function a(){c.node||(d._tileCache&&d._tileCache.add(this[d.propertyOfTileId],this),d._tileRended[this[d.propertyOfTileId]]=this);d._drawTileAndRequest(this)}function b(){d._clearTileRectAndRequest(this)}var d=this,e,f,g;for(g in this._tileQueue)this._tileQueue.hasOwnProperty(g)&&
        (e=g.split("@")[0],f=this._tileQueue[g],delete this._tileQueue[g],this._tileCache&&this._tileCache[e]?this._drawTileAndRequest(this._tileCache[e]):this._loadTile(e,f,a,b))},_loadTile:function(a,b,d,e){var f=this.layer.options.crossOrigin,g=this.layer.getTileSize(),h=new Image;h.width=g.width;h.height=g.height;h[this.propertyOfTileId]=a;h[this.propertyOfPointOnTile]={viewPoint:b.viewPoint,"2dPoint":b["2dPoint"]};h[this.propertyOfTileZoom]=b.zoom;h.onload=d;h.onabort=e;h.onerror=e;f&&(h.crossOrigin=
            f);c.Util.loadImage(h,[b.url])},_drawTile:function(a,b){if(a){var d=this.layer.getTileSize(),e=this._viewExtent.getMin();c.Canvas.image(this.context,b,a.x-e.x,a.y-e.y,d.width,d.height);this.layer.options.debug&&(e=a.substract(e),this.context.save(),this.context.strokeStyle="rgb(0,0,0)",this.context.fillStyle="rgb(0,0,0)",this.context.strokeWidth=10,this.context.font="15px monospace",c.Canvas.rectangle(this.context,e,d,1,0),d=b[this.propertyOfTileId].split("__"),c.Canvas.fillText(this.context,"x:"+
            d[1]+",y:"+d[0]+",z:"+d[2],e.add(10,20),"rgb(0,0,0)"),this.context.restore())}},_drawTileAndRequest:function(a){if(this.getMap()&&this.getMap().getZoom()===a[this.propertyOfTileZoom]){this._tileToLoadCounter--;var b=a[this.propertyOfPointOnTile];this._drawTile(b.viewPoint,a);c.node||(a=this.layer.getTileSize(),this.getMap()._get2DExtent().intersects(new c.PointExtent(b["2dPoint"],b["2dPoint"].add(a.width,a.height)))&&this.requestMapToRender());0===this._tileToLoadCounter&&this._onTileLoadComplete()}},
        _onTileLoadComplete:function(){c.node&&this.requestMapToRender();this.fireLoadedEvent()},_clearTileRectAndRequest:function(a){this.getMap()&&this.getMap().getZoom()===a[this.propertyOfTileZoom]&&(c.node||this.requestMapToRender(),this._tileToLoadCounter--,0===this._tileToLoadCounter&&this._onTileLoadComplete())},requestMapToRender:function(){if(c.node)this.getMap()&&!this.getMap()._isBusy()&&this._mapRender.render();else{this._mapRenderRequest&&c.Util.cancelAnimFrame(this._mapRenderRequest);var a=
            this;this._mapRenderRequest=c.Util.requestAnimFrame(function(){a.getMap()&&!a.getMap()._isBusy()&&a._mapRender.render()})}},onMoveEnd:function(){this._gradualLoading=!1;c.renderer.Canvas.prototype.onMoveEnd.apply(this,arguments)},onZoomEnd:function(){this._gradualLoading=!0;c.renderer.Canvas.prototype.onZoomEnd.apply(this,arguments)},onRemove:function(){delete this._viewExtent;delete this._mapRender;delete this._tileCache;delete this._tileRended;delete this._tileQueue}});c.TileLayer.registerRenderer("canvas",
        c.renderer.tilelayer.Canvas);c.renderer.tilelayer.Dom=c.Class.extend({initialize:function(a){this.layer=a;this._tiles={};this._fadeAnimated=!c.Browser.mobile&&!0},getMap:function(){return this.layer.getMap()},show:function(){this._container&&(this.render(),this._container.style.display="")},hide:function(){this._container&&(this._container.style.display="none",this.clear())},remove:function(){delete this._tiles;delete this.layer;this._removeLayerContainer()},clear:function(){this._removeAllTiles();
        this._clearLayerContainer()},setZIndex:function(a){this._zIndex=a;this._container&&(this._container.style.zIndex=a)},isCanvasRender:function(){return!1},render:function(){var a=this.layer;this._container||this._createLayerContainer();if(a=a._getTiles()){var b=a.tiles,a=[];if(this._tiles)for(var c in this._tiles)this._tiles[c].current=!1;var e;for(c=b.length-1;0<=c;c--)e=b[c],this._tiles[e.id]?this._tiles[e.id].current=!0:(e.current=!0,a.push(e));e=this._getTileContainer();if(0<a.length){var f=document.createDocumentFragment();
        c=0;for(b=a.length;c<b;c++)f.appendChild(this._loadTile(a[c]));e.appendChild(f)}}},transform:function(a){if(!this._canTransform())return!1;var b=this.getMap().getZoom();this._levelContainers[b]&&(a?c.DomUtil.setTransformMatrix(this._levelContainers[b],a.view):c.DomUtil.removeTransform(this._levelContainers[b]));return!1},_loadTile:function(a){this._tiles[a.id]=a;return this._createTile(a,c.Util.bind(this._tileReady,this))},_createTile:function(a,b){var d=this.layer.getTileSize(),e=c.DomUtil.createEl("img");
        a.el=e;c.DomUtil.on(e,"load",c.Util.bind(this._tileOnLoad,this,b,a));c.DomUtil.on(e,"error",c.Util.bind(this._tileOnError,this,b,a));this.layer.options.crossOrigin&&(a.crossOrigin=this.layer.options.crossOrigin);e.style.position="absolute";e.style.left=Math.floor(a.viewPoint.x)+"px";e.style.top=Math.floor(a.viewPoint.y)+"px";e.alt="";e.width=d.width;e.height=d.height;c.DomUtil.setOpacity(e,0);this.layer.options.cssFilter&&(e.style[c.DomUtil.CSSFILTER]=this.layer.options.cssFilter);e.src=a.url;return e},
        _tileReady:function(a,b){if(this.layer){a&&this.layer.fire("tileerror",{error:a,tile:b});b.loaded=c.Util.now();var d=this.getMap();this._fadeAnimated?(c.Util.cancelAnimFrame(this._fadeFrame),this._fadeFrame=c.Util.requestAnimFrame(c.Util.bind(this._updateOpacity,this))):(c.DomUtil.setOpacity(b.el,1),b.active=!0);this.layer.fire("tileload",{tile:b});if(this._noTilesToLoad())if(this.layer.fire("layerload"),c.Browser.ielt9)c.Util.requestAnimFrame(this._pruneTiles,this);else{this._pruneTimeout&&clearTimeout(this._pruneTimeout);
            var e=d?d.options.zoomAnimationDuration:250,d=d&&this.layer===d.getBaseLayer()?!d.options.zoomBackground:!0;this._pruneTimeout=setTimeout(c.Util.bind(this._pruneTiles,this,d),e+100)}}},_tileOnLoad:function(a,b){c.Browser.ielt9?setTimeout(c.Util.bind(a,this,null,b),0):a.call(this,null,b)},_tileOnError:function(a,b){var c=this.layer.options.errorTileUrl;c?b.el.src=c:b.el.style.display="none";a.call(this,"error",b)},_updateOpacity:function(){if(this.getMap()&&!c.Browser.ielt9){c.DomUtil.setOpacity(this._container,
            this.layer.options.opacity);var a=c.Util.now(),b=!1,d,e,f;for(f in this._tiles)d=this._tiles[f],d.current&&d.loaded&&(e=Math.min(1,(a-d.loaded)/200),c.DomUtil.setOpacity(d.el,e),!b&&1>e&&(b=!0));b&&(c.Util.cancelAnimFrame(this._fadeFrame),this._fadeFrame=c.Util.requestAnimFrame(c.Util.bind(this._updateOpacity,this)))}},_noTilesToLoad:function(){for(var a in this._tiles)if(!this._tiles[a].loaded)return!1;return!0},_pruneTiles:function(a){var b=this.getMap();if(b){var d,b=b.getZoom();if(this.layer.isVisible()){for(d in this._tiles)this._tiles[d].zoom!==
        b||this._tiles[d].current||this._removeTile(d);if(a){for(d in this._tiles)this._tiles[d].zoom!==b&&this._removeTile(d);for(var e in this._levelContainers)+e!==b&&(c.DomUtil.removeDomNode(this._levelContainers[e]),this._removeTilesAtZoom(e),delete this._levelContainers[e])}}else this._removeAllTiles()}},_removeTile:function(a){var b=this._tiles[a];b&&(c.DomUtil.removeDomNode(b.el),delete this._tiles[a],this.layer.fire("tileunload",{tile:b}))},_removeTilesAtZoom:function(a){for(var b in this._tiles)+this._tiles[b].zoom===
        +a&&this._removeTile(b)},_removeAllTiles:function(){for(var a in this._tiles)this._removeTile(a)},_getTileContainer:function(){this._levelContainers||(this._levelContainers={});var a=this.getMap().getZoom();if(!this._levelContainers[a]){var b=this._levelContainers[a]=c.DomUtil.createEl("div","maptalks-tilelayer-level");b.style.cssText="position:absolute;left:0px;top:0px;";b.style.willChange="transform";this._container.appendChild(b)}return this._levelContainers[a]},_createLayerContainer:function(){var a=
            this._container=c.DomUtil.createEl("div","maptalks-tilelayer");a.style.cssText="position:absolute;left:0px;top:0px;";this._zIndex&&(a.style.zIndex=this._zIndex);this.getMap()._panels.layer.appendChild(a)},_clearLayerContainer:function(){this._container&&(this._container.innerHTML="");delete this._levelContainers},_removeLayerContainer:function(){this._container&&c.DomUtil.removeDomNode(this._container);delete this._container;delete this._levelContainers},getEvents:function(){var a={_zoomstart:this.onZoomStart,
            _touchzoomstart:this._onTouchZoomStart,_zoomend:this.onZoomEnd,"_moveend _resize":this.render,_movestart:this.onMoveStart};if(!this._onMapMoving&&this.layer.options.renderWhenPanning){var b=this.layer.options.updateInterval;c.Util.isNumber(b)&&0<=b&&(this._onMapMoving=0<b?c.Util.throttle(function(){this.render()},b,this):function(){this.render()})}this._onMapMoving&&(a._moving=this._onMapMoving);return a},_canTransform:function(){return c.Browser.any3d||c.Browser.ie9},onMoveStart:function(){},_onTouchZoomStart:function(){this._pruneTiles(!0)},
        onZoomStart:function(){this._fadeAnimated=!c.Browser.mobile&&!0;this._pruneTiles(!0);this._zoomStartPos=this.getMap().offsetPlatform();this._canTransform()||(this._container.style.display="none")},onZoomEnd:function(a){this._pruneTimeout&&clearTimeout(this._pruneTimeout);this.render();this._levelContainers&&(this._canTransform()?this._levelContainers[a.from]&&this._zoomStartPos&&(this._levelContainers[a.from].style.left=this._zoomStartPos.x+"px",this._levelContainers[a.from].style.top=this._zoomStartPos.y+
                "px"):(this._levelContainers[a.from]&&(this._levelContainers[a.from].style.display="none"),this._container.style.display=""))}});c.TileLayer.registerRenderer("dom",c.renderer.tilelayer.Dom);c.renderer.canvastilelayer={};c.renderer.canvastilelayer.Canvas=c.renderer.tilelayer.Canvas.extend({_loadTile:function(a,b,d,e){var f=this.layer.getTileSize(),g=this.canvas.constructor,h=this.getMap(),k=c.Browser.retina?2:1,l=c.Canvas.createCanvas(f.width*k,f.height*k,g);l[this.propertyOfTileId]=a;l[this.propertyOfPointOnTile]=
        b.viewPoint;l[this.propertyOfTileZoom]=b.zoom;this.layer.drawTile(l,{url:b.url,viewPoint:b.viewPoint,zoom:b.zoom,extent:h._pointToExtent(new c.PointExtent(b["2dPoint"],b["2dPoint"].add(f.toPoint())))},function(a){a?e.call(l):d.call(l)})}});c.CanvasTileLayer.registerRenderer("canvas",c.renderer.canvastilelayer.Canvas);c.renderer.vectorlayer={};c.renderer.overlaylayer={};c.renderer.overlaylayer.Canvas=c.renderer.Canvas.extend({checkResources:function(a){this._resourceChecked||c.Util.isArray(a)||(a=
        this.layer._geoList);if(!a||!c.Util.isArrayHasData(a))return[];for(var b=[],d,e=a.length-1;0<=e;e--)if(d=a[e]._getExternalResources(),c.Util.isArrayHasData(d))if(this.resources)for(var f=0;f<d.length;f++)this.resources.isResourceLoaded(d[f])||b.push(d[f]);else b=b.concat(d);this._resourceChecked=!0;return b},onGeometryAdd:function(a){this.render(a)},onGeometryRemove:function(){this.render()},onGeometrySymbolChange:function(a){this.render(a)},onGeometryShapeChange:function(){this.render()},onGeometryPositionChange:function(){this.render()},
        onGeometryZIndexChange:function(){this.render()},onGeometryShow:function(){this.render()},onGeometryHide:function(){this.render()},onGeometryPropertiesChange:function(){this.render()}});c.renderer.vectorlayer.Canvas=c.renderer.overlaylayer.Canvas.extend({initialize:function(a){this.layer=a;this._painted=!1},checkResources:function(){var a=this,b=c.renderer.overlaylayer.Canvas.prototype.checkResources.apply(this,arguments),d=this.layer.getStyle();d&&(c.Util.isArray(d)||(d=[d]),d.forEach(function(d){if(d=
            c.Util.getExternalResources(d.symbol,!0))for(var f=0;f<d.length;f++)a.resources.isResourceLoaded(d[f])||b.push(d[f])}));return b},draw:function(){this.getMap()&&(!this.layer.isVisible()||this.layer.isEmpty()?this.clearCanvas():this._drawGeos(),this.completeRender())},transform:function(a){if(c.Browser.mobile||this.layer.getMask()||!this._hasPointSymbolizer||this.getMap()._getRenderer()._getCountOfGeosToDraw()>this.layer.options.thresholdOfTransforming)return!1;this._drawGeos(a);return!0},isBlank:function(){return this._isBlank},
        show:function(){this.layer.forEach(function(a){a.onZoomEnd()});c.renderer.Canvas.prototype.show.apply(this,arguments)},_drawGeos:function(a){if(this.getMap()){var b=this.layer;if(b.isEmpty())this.fireLoadedEvent();else if(b.isVisible()){this._prepareToDraw();var b=this._extent2D,c=this.prepareCanvas();if(c){if(!c.intersects(b)){this.fireLoadedEvent();return}b=b.intersection(c)}this._displayExtent=b;this._forEachGeo(this._checkGeo,this);b=0;for(c=this._geosToDraw.length;b<c;b++)this._geosToDraw[b]._getPainter().paint(a)}else this.fireLoadedEvent()}},
        _prepareToDraw:function(){this._painted=this._isBlank=!0;this._hasPointSymbolizer=!1;this._geosToDraw=[]},_checkGeo:function(a){if(a&&a.isVisible()&&a.getMap()&&a.getLayer()&&a.getLayer().isCanvasRender()){var b=a._getPainter(),c=b.get2DExtent(this.resources);c&&c.intersects(this._displayExtent)&&(this._isBlank=!1,b.hasPointSymbolizer()&&(this._hasPointSymbolizer=!0),this._geosToDraw.push(a))}},_forEachGeo:function(a,b){this.layer.forEach(a,b)},onZoomEnd:function(){delete this._extent2D;this.layer.isVisible()&&
        this.layer.forEach(function(a){a.onZoomEnd()});this._painted?(this.prepareRender(),this.draw()):this.render(!0)},onMoveEnd:function(){this._painted?(this.prepareRender(),this.draw()):this.render(!0)},onResize:function(){this.resizeCanvas();this._painted?(delete this._extent2D,this.prepareRender(),this.draw()):this.render(!0)},onRemove:function(){this._forEachGeo(function(a){a.onHide()});delete this._geosToDraw},onGeometryPropertiesChange:function(a){a&&this.layer._styleGeometry(a.target)}});c.VectorLayer.registerRenderer("canvas",
        c.renderer.vectorlayer.Canvas);c.symbolizer={};c.Symbolizer=c.Class.extend({getMap:function(){return this.geometry.getMap()},getPainter:function(){return this.painter}});c.Symbolizer.resourceProperties=["markerFile","polygonPatternFile","linePatternFile","markerFillPatternFile","markerLinePatternFile"];c.Symbolizer.resourceSizeProperties=[["markerWidth","markerHeight"],[],[null,"lineWidth"],[],[null,"markerLineWidth"]];c.Symbolizer.colorProperties=["lineColor","polygonFill","markerFill","markerLineColor",
        "textFill"];c.Symbolizer.DEFAULT_STROKE_COLOR="#000";c.Symbolizer.DEFAULT_FILL_COLOR="rgba(255,255,255,0)";c.Symbolizer.DEFAULT_TEXT_COLOR="#000";c.Symbolizer.testColor=function(a){return a&&c.Util.isString(a)?0<=c.Util.indexOfArray(a,c.Symbolizer.colorProperties)?!0:!1:!1};c.symbolizer.CanvasSymbolizer=c.Symbolizer.extend({_prepareContext:function(a){c.Util.isNumber(this.symbol.opacity)?a.globalAlpha!==this.symbol.opacity&&(a.globalAlpha=this.symbol.opacity):1!==a.globalAlpha&&(a.globalAlpha=1)},
        refresh:function(){},remove:function(){},setZIndex:function(){},show:function(){},hide:function(){},_defineStyle:function(a){var b=this;return c.Util.loadFunctionTypes(a,function(){return[b.getMap().getZoom(),b.geometry.getProperties()]})}});c.symbolizer.StrokeAndFillSymbolizer=c.symbolizer.CanvasSymbolizer.extend({initialize:function(a,b,d){this.symbol=a;this.geometry=b;this.painter=d;b instanceof c.Marker||(this.style=this._defineStyle(this.translate()))},symbolize:function(a,b){if(!(this.geometry instanceof
        c.Marker)){var d=this.style;if(0!==d.polygonOpacity||0!==d.lineOpacity){var e=this._getPaintParams();if(e){this._prepareContext(a);var f=c.Util.isGradient(d.lineColor),g=this.geometry.constructor===c.Polygon||this.geometry instanceof c.LineString;!f||!d.lineColor.places&&g||(d.lineGradientExtent=this.getPainter().getContainerExtent()._expand(d.lineWidth));c.Util.isGradient(d.polygonFill)&&(d.polygonGradientExtent=this.getPainter().getContainerExtent());var h=e[0],k;if(this.geometry instanceof c.Polygon&&
        1<h.length&&c.Util.isArray(h[0][0])||this.geometry instanceof c.LineString&&1<h.length&&c.Util.isArray(h[0]))for(var l=0;l<h.length;l++)c.Canvas.prepareCanvas(a,d,b),f&&g&&!d.lineColor.places&&this._createGradient(a,h[l],d.lineColor),k=[a,h[l]],1<e.length&&k.push.apply(k,e.slice(1)),k.push(d.lineOpacity,d.polygonOpacity,d.lineDasharray),this.geometry._paintOn.apply(this.geometry,k);else c.Canvas.prepareCanvas(a,d,b),f&&g&&!d.lineColor.places&&this._createGradient(a,h,d.lineColor),k=[a],k.push.apply(k,
        e),k.push(d.lineOpacity,d.polygonOpacity,d.lineDasharray),this.geometry._paintOn.apply(this.geometry,k);a.setLineDash&&c.Util.isArrayHasData(d.lineDasharray)&&a.setLineDash([])}}}},get2DExtent:function(){if(this.geometry instanceof c.Marker)return null;var a=this.getMap(),b=this.geometry._getPrjExtent();if(!b)return null;this._extMin&&this._extMax||(this._extMin=new c.Coordinate(0,0),this._extMax=new c.Coordinate(0,0));this._extMin.x=b.xmin;this._extMin.y=b.ymin;this._extMax.x=b.xmax;this._extMax.y=
        b.ymax;b=a._prjToPoint(this._extMin);a=a._prjToPoint(this._extMax);this._pxExtent?(b.x<a.x?(this._pxExtent.xmin=b.x,this._pxExtent.xmax=a.x):(this._pxExtent.xmax=b.x,this._pxExtent.xmin=a.x),b.y<a.y?(this._pxExtent.ymin=b.y,this._pxExtent.ymax=a.y):(this._pxExtent.ymax=b.y,this._pxExtent.ymin=a.y)):this._pxExtent=new c.PointExtent(b,a);return this._pxExtent._expand(this.style.lineWidth/2)},_getPaintParams:function(){return this.getPainter().getPaintParams()},translate:function(){var a=this.symbol,
        a={lineColor:c.Util.getValueOrDefault(a.lineColor,"#000"),lineWidth:c.Util.getValueOrDefault(a.lineWidth,2),lineOpacity:c.Util.getValueOrDefault(a.lineOpacity,1),lineDasharray:c.Util.getValueOrDefault(a.lineDasharray,[]),lineCap:c.Util.getValueOrDefault(a.lineCap,"butt"),lineJoin:c.Util.getValueOrDefault(a.lineJoin,"miter"),linePatternFile:c.Util.getValueOrDefault(a.linePatternFile,null),polygonFill:c.Util.getValueOrDefault(a.polygonFill,null),polygonOpacity:c.Util.getValueOrDefault(a.polygonOpacity,
            1),polygonPatternFile:c.Util.getValueOrDefault(a.polygonPatternFile,null)};0===a.lineWidth&&(a.lineOpacity=0);this.geometry instanceof c.LineString&&!a.polygonFill&&(a.polygonFill=a.lineColor);return a},_createGradient:function(a,b,c){var e=b.length,f=a.createLinearGradient(b[0].x,b[0].y,b[e-1].x,b[e-1].y);c.colorStops.forEach(function(a){f.addColorStop.apply(f,a)});a.strokeStyle=f}});c.symbolizer.StrokeAndFillSymbolizer.test=function(a,b){if(!a||b&&b instanceof c.Marker)return!1;for(var d in a){var e=
        d.slice(0,4);if("line"===e||"poly"===e)return!0}return!1};c.symbolizer.PointSymbolizer=c.symbolizer.CanvasSymbolizer.extend({get2DExtent:function(a){var b=new c.PointExtent;a=this.getMarkerExtent(a);for(var d=this._getRenderPoints()[0],e=d.length-1;0<=e;e--)b._combine(d[e]);b.xmin+=a.xmin;b.ymin+=a.ymin;b.xmax+=a.xmax;b.ymax+=a.ymax;return b},_getRenderPoints:function(){return this.getPainter().getRenderPoints(this.getPlacement())},_getRenderContainerPoints:function(){var a=this.getPainter(),b=this._getRenderPoints()[0];
        if(a.isSpriting())return b;var d=a.getTransformMatrix(),a=d?d.container:null,d=d?d.scale:null,e=this.getDxDy(),f=this.geometry.getLayer()._getRenderer()._extent2D.getMin();a&&(e=new c.Point(e.x/d.x,e.y/d.y));b=c.Util.mapArrayRecursively(b,function(a){return a.substract(f)._add(e)});return a?a.applyToArray(b):b},_getRotationAt:function(a){var b=this.getRotation(),c=this._getRenderPoints()[1];if(!c)return b;b||(b=0);return c[a]+b},_rotate:function(a,b,d){return c.Util.isNil(d)?null:(a.save(),a.translate(b.x,
            b.y),a.rotate(d),new c.Point(0,0))}});c.symbolizer.ImageMarkerSymbolizer=c.symbolizer.PointSymbolizer.extend({initialize:function(a,b,c){this.symbol=a;this.geometry=b;this.painter=c;this.style=this._defineStyle(this.translate())},symbolize:function(a,b){var d=this.style;if(0!==d.markerWidth&&0!==d.markerHeight&&0!==d.markerOpacity){var e=this._getRenderContainerPoints();if(c.Util.isArrayHasData(e)){var f=this._getImage(b);if(f){this._prepareContext(a);var g=d.markerWidth,h=d.markerHeight;if(!c.Util.isNumber(g)||
        !c.Util.isNumber(h)){g=f.width;h=f.height;d.markerWidth=g;d.markerHeight=h;var k=[d.markerFile,d.markerWidth,d.markerHeight];b.isResourceLoaded(k)||b.addResource(k,f);k=this.getPainter();k.isSpriting()||k.removeCache()}var l;!(this instanceof c.symbolizer.VectorPathMarkerSymbolizer)&&c.Util.isNumber(d.markerOpacity)&&1>d.markerOpacity&&(l=a.globalAlpha,a.globalAlpha*=d.markerOpacity);for(var k=0,m=e.length;k<m;k++){var d=e[k],n=this._rotate(a,d,this._getRotationAt(k));n&&(d=n);c.Canvas.image(a,f,
        d.x-g/2,d.y-h,g,h);n&&a.restore()}void 0!==l&&(a.globalAlpha=l)}else!c.Browser.phantomjs&&console&&console.warn("no img found for "+(this.style.markerFile||this._url[0]))}}},_getImage:function(a){return a?a.getImage([this.style.markerFile,this.style.markerWidth,this.style.markerHeight]):null},getPlacement:function(){return this.symbol.markerPlacement},getRotation:function(){var a=this.style.markerRotation;return c.Util.isNumber(a)?a*Math.PI/180:null},getDxDy:function(){var a=this.style;return new c.Point(a.markerDx||
        0,a.markerDy||0)},getMarkerExtent:function(a){var b=this.style.markerFile,b=a?a.getImage(b):null;a=this.style.markerWidth||(b?b.width:0);var b=this.style.markerHeight||(b?b.height:0),d=this.getDxDy();return new c.PointExtent(d.add(-a/2,0),d.add(a/2,-b))},translate:function(){var a=this.symbol;return{markerFile:a.markerFile,markerOpacity:c.Util.getValueOrDefault(a.markerOpacity,1),markerWidth:c.Util.getValueOrDefault(a.markerWidth,null),markerHeight:c.Util.getValueOrDefault(a.markerHeight,null),markerDx:c.Util.getValueOrDefault(a.markerDx,
        0),markerDy:c.Util.getValueOrDefault(a.markerDy,0)}}});c.symbolizer.ImageMarkerSymbolizer.test=function(a){return a?c.Util.isNil(a.markerFile)?!1:!0:!1};c.symbolizer.VectorMarkerSymbolizer=c.symbolizer.PointSymbolizer.extend({padding:[2,2],initialize:function(a,b,d){this.symbol=a;this.geometry=b;this.painter=d;a=this.translate();this.style=this._defineStyle(a);this.strokeAndFill=this._defineStyle(c.symbolizer.VectorMarkerSymbolizer.translateLineAndFill(a))},symbolize:function(a,b){var d=this.style;
        0===d.markerWidth||0===d.markerHeight||0===d.polygonOpacity&&0===d.lineOpacity||(d=this._getRenderContainerPoints(),c.Util.isArrayHasData(d)&&(this._prepareContext(a),this.getPainter().isSpriting()||this.geometry.getLayer().getMask()===this.geometry||!1===this.geometry.getLayer().options.cacheVectorOnCanvas?this._drawMarkers(a,d,b):this._drawMarkersWithCache(a,d,b)))},_drawMarkers:function(a,b,d){var e=this.strokeAndFill,f;c.Util.isGradient(e.lineColor)||c.Util.isGradient(e.polygonFill)||c.Canvas.prepareCanvas(a,
        e,d);for(var g=b.length-1;0<=g;g--)e=b[g],(f=this._rotate(a,e,this._getRotationAt(g)))&&(e=f),this._drawVectorMarker(a,e,d),f&&a.restore()},_drawMarkersWithCache:function(a,b,d){var e=this._stampSymbol(),f=this.strokeAndFill.lineWidth?this.strokeAndFill.lineWidth:0,g=this.geometry.options.shadowBlur,h=this.style.markerWidth+f+2*g+this.padding[0],f=this.style.markerHeight+f+2*g+this.padding[1],g=d.getImage(e);g||(g=this._createMarkerImage(a,d),d.addResource([e,h,f],g));for(var k=this._getAnchor(),
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         l=b.length-1;0<=l;l--)d=b[l].substract(k),(e=this._rotate(a,d,this._getRotationAt(l)))&&(d=e),c.Canvas.image(a,g,d.x,d.y,h,f),e&&a.restore()},_createMarkerImage:function(a,b){var d=this.strokeAndFill.lineWidth?this.strokeAndFill.lineWidth:0,e=this.geometry.options.shadowBlur,d=c.Canvas.createCanvas(this.style.markerWidth+d+2*e+this.padding[0],this.style.markerHeight+d+2*e+this.padding[1],a.canvas.constructor),e=this._getAnchor(),f=d.getContext("2d");c.Util.isGradient(this.strokeAndFill.lineColor)||
    c.Util.isGradient(this.strokeAndFill.polygonFill)||c.Canvas.prepareCanvas(f,this.strokeAndFill,b);this._drawVectorMarker(f,e,b);return d},_stampSymbol:function(){this._stamp||(this._stamp=[this.style.markerType,c.Util.isGradient(this.style.markerFill)?c.Util.getGradientStamp(this.style.markerFill):this.style.markerFill,this.style.markerFillOpacity,this.style.markerFillPatternFile,c.Util.isGradient(this.style.markerLineColor)?c.Util.getGradientStamp(this.style.markerLineColor):this.style.markerLineColor,
        this.style.markerLineWidth,this.style.markerLineOpacity,this.style.markerLineDasharray?this.style.markerLineDasharray.join(","):"",this.style.markerLinePatternFile,this.style.markerWidth,this.style.markerHeight].join("_"));return this._stamp},_getAnchor:function(){var a=this.style.markerType.toLowerCase(),b=this.strokeAndFill.lineWidth?this.strokeAndFill.lineWidth:0,d=this.geometry.options.shadowBlur,e=this.style.markerWidth,f=this.style.markerHeight;return"bar"===a||"pie"===a||"pin"===a?new c.Point(e/
            2+b/2+d+this.padding[0]/2,f+b/2+d+this.padding[1]):new c.Point(e/2+b/2+d+this.padding[0]/2,f/2+b/2+d+this.padding[1]/2)},_getGraidentExtent:function(a){var b=new c.PointExtent,d=this.getMarkerExtent();if(c.Util.isArray(a))for(var e=a.length-1;0<=e;e--)b._combine(a[e]);else b._combine(a);b.xmin+=d.xmin;b.ymin+=d.ymin;b.xmax+=d.xmax;b.ymax+=d.ymax;return b},_drawVectorMarker:function(a,b,d){var e=this.style,f=this.strokeAndFill,g=e.markerType.toLowerCase(),h=c.symbolizer.VectorMarkerSymbolizer._getVectorPoints(g,
        e.markerWidth,e.markerHeight),k=f.lineOpacity,l=f.polygonOpacity,m;if(c.Util.isGradient(f.lineColor)||c.Util.isGradient(f.polygonFill))c.Util.isGradient(f.lineColor)&&(m=this._getGraidentExtent(b),f.lineGradientExtent=m.expand(f.lineWidth)),c.Util.isGradient(f.polygonFill)&&(m||(m=this._getGraidentExtent(b)),f.polygonGradientExtent=m),c.Canvas.prepareCanvas(a,f,d);f=e.markerWidth;d=e.markerHeight;if("ellipse"===g)c.Canvas.ellipse(a,b,f/2,d/2,k,l);else if("cross"===g||"x"===g){for(e=h.length-1;0<=
    e;e--)h[e]._add(b);c.Canvas.path(a,h.slice(0,2),k);c.Canvas.path(a,h.slice(2,4),k)}else if("diamond"===g||"bar"===g||"square"===g||"triangle"===g){"bar"===g&&(b=b.add(0,-e.markerLineWidth/2));for(e=h.length-1;0<=e;e--)h[e]._add(b);c.Canvas.polygon(a,h,k,l)}else if("pin"===g){b=b.add(0,-e.markerLineWidth/2);for(e=h.length-1;0<=e;e--)h[e]._add(b);e=a.lineCap;a.lineCap="round";c.Canvas.bezierCurveAndFill(a,h,k,l);a.lineCap=e}else if("pie"===g)b=b.add(0,-e.markerLineWidth/2),h=180*Math.atan(f/2/d)/Math.PI,
        e=a.lineCap,a.lineCap="round",c.Canvas.sector(a,b,d,[90-h,90+h],k,l),a.lineCap=e;else throw Error("unsupported markerType: "+g);},getPlacement:function(){return this.symbol.markerPlacement},getRotation:function(){var a=this.style.markerRotation;return c.Util.isNumber(a)?a*Math.PI/180:null},getDxDy:function(){var a=this.style;return new c.Point(a.markerDx,a.markerDy)},getMarkerExtent:function(){var a=this.getDxDy(),b=this.style,d=b.markerType.toLowerCase(),e=b.markerWidth,b=b.markerHeight,a="bar"===
    d||"pie"===d||"pin"===d?new c.PointExtent(a.add(-e/2,-b),a.add(e/2,0)):new c.PointExtent(a.add(-e/2,-b/2),a.add(e/2,b/2));this.style.markerLineWidth&&a._expand(this.style.markerLineWidth/2);return a},translate:function(){var a=this.symbol,b={markerType:c.Util.getValueOrDefault(a.markerType,"ellipse"),markerFill:c.Util.getValueOrDefault(a.markerFill,"#00f"),markerFillOpacity:c.Util.getValueOrDefault(a.markerFillOpacity,1),markerFillPatternFile:c.Util.getValueOrDefault(a.markerFillPatternFile,null),
        markerLineColor:c.Util.getValueOrDefault(a.markerLineColor,"#000"),markerLineWidth:c.Util.getValueOrDefault(a.markerLineWidth,1),markerLineOpacity:c.Util.getValueOrDefault(a.markerLineOpacity,1),markerLineDasharray:c.Util.getValueOrDefault(a.markerLineDasharray,[]),markerLinePatternFile:c.Util.getValueOrDefault(a.markerLinePatternFile,null),markerWidth:c.Util.getValueOrDefault(a.markerWidth,10),markerHeight:c.Util.getValueOrDefault(a.markerHeight,10),markerDx:c.Util.getValueOrDefault(a.markerDx,0),
        markerDy:c.Util.getValueOrDefault(a.markerDy,0)};c.Util.isNumber(a.markerOpacity)&&(b.markerFillOpacity*=a.markerOpacity,b.markerLineOpacity*=a.markerOpacity);return b}});c.symbolizer.VectorMarkerSymbolizer.translateLineAndFill=function(a){a={lineColor:a.markerLineColor,linePatternFile:a.markerLinePatternFile,lineWidth:a.markerLineWidth,lineOpacity:a.markerLineOpacity,lineDasharray:null,lineCap:"butt",lineJoin:"round",polygonFill:a.markerFill,polygonPatternFile:a.markerFillPatternFile,polygonOpacity:a.markerFillOpacity};
        0===a.lineWidth&&(a.lineOpacity=0);return a};c.symbolizer.VectorMarkerSymbolizer.test=function(a){return a?c.Util.isNil(a.markerFile)&&!c.Util.isNil(a.markerType)&&"path"!==a.markerType?!0:!1:!1};c.symbolizer.VectorMarkerSymbolizer.translateToSVGStyles=function(a){a={stroke:{stroke:a.markerLineColor,"stroke-width":a.markerLineWidth,"stroke-opacity":a.markerLineOpacity,"stroke-dasharray":null,"stroke-linecap":"butt","stroke-linejoin":"round"},fill:{fill:a.markerFill,"fill-opacity":a.markerFillOpacity}};
        "butt"===a.stroke["stroke-linecap"]&&c.Browser.vml&&(a.stroke["stroke-linecap"]="flat");0===a.stroke["stroke-width"]&&(a.stroke["stroke-opacity"]=0);return a};c.symbolizer.VectorMarkerSymbolizer._getVectorPoints=function(a,b,d){var e=d/2,f=b/2;return"triangle"===a?(a=new c.Point(0,0-e),b=new c.Point(0-f,0+e),d=new c.Point(0+f,0+e),[a,b,d]):"cross"===a?(a=new c.Point(0-f,0),b=new c.Point(0+f,0),d=new c.Point(0,0-e),e=new c.Point(0,0+e),[a,b,d,e]):"diamond"===a?(a=new c.Point(0-f,0),b=new c.Point(0,
                    0-e),d=new c.Point(0+f,0),e=new c.Point(0,0+e),[a,b,d,e]):"square"===a?(a=new c.Point(0-f,0+e),b=new c.Point(0+f,0+e),d=new c.Point(0+f,0-e),e=new c.Point(0-f,0-e),[a,b,d,e]):"x"===a?(a=new c.Point(0-f,0+e),b=new c.Point(0+f,0-e),d=new c.Point(0+f,0+e),e=new c.Point(0-f,0-e),[a,b,d,e]):"bar"===a?(a=new c.Point(0-f,0-d),b=new c.Point(0+f,0-d),d=new c.Point(0+f,0),e=new c.Point(0-f,0),[a,b,d,e]):"pin"===a?(e=d*Math.atan(f/e),a=new c.Point(0,0),b=new c.Point(0-e,0-d),d=new c.Point(0+e,0-d),e=new c.Point(0,
                                    0),[a,b,d,e]):null};c.symbolizer.VectorPathMarkerSymbolizer=c.symbolizer.ImageMarkerSymbolizer.extend({initialize:function(a,b,d){this.symbol=a;this.geometry=b;this.painter=d;this._url=[c.Geometry.getMarkerPathBase64(a),a.markerWidth,a.markerHeight];this.style=this._defineStyle(this.translate());c.Util.isNil(this.style.markerWidth)&&(this.style.markerWidth=80);c.Util.isNil(this.style.markerHeight)&&(this.style.markerHeight=80)},_prepareContext:function(){},_getImage:function(a){if(a&&a.isResourceLoaded(this._url))return a.getImage(this._url);
        var b=new Image;b.src=this._url[0];a&&a.addResource(this._url,b);return b}});c.symbolizer.VectorPathMarkerSymbolizer.test=function(a){return a?c.Util.isNil(a.markerFile)&&"path"===a.markerType?!0:!1:!1};c.symbolizer.TextMarkerSymbolizer=c.symbolizer.PointSymbolizer.extend({initialize:function(a,b,d){this.symbol=a;this.geometry=b;this.painter=d;a=this.translate();this.style=this._defineStyle(a);this.strokeAndFill=this._defineStyle(this.translateLineAndFill(a));a=c.StringUtil.replaceVariable(this.style.textName,
        this.geometry.getProperties());this._descText(a)},symbolize:function(a,b){if(0!==this.style.textSize&&0!==this.style.textOpacity){var d=this._getRenderContainerPoints();if(c.Util.isArrayHasData(d)){var e=this.style,f=this.strokeAndFill,g=c.StringUtil.replaceVariable(this.style.textName,this.geometry.getProperties());this._descText(g);this._prepareContext(a);c.Canvas.prepareCanvas(a,f,b);c.Canvas.prepareCanvasFont(a,e);for(var h=0,k=d.length;h<k;h++){var f=d[h],l=this._rotate(a,f,this._getRotationAt(h));
        l&&(f=l);c.Canvas.text(a,g,f,e,this.textDesc);l&&a.restore()}}}},getPlacement:function(){return this.symbol.textPlacement},getRotation:function(){var a=this.style.textRotation;return c.Util.isNumber(a)?a*Math.PI/180:null},getDxDy:function(){var a=this.style;return new c.Point(a.textDx,a.textDy)},getMarkerExtent:function(){var a=this.getDxDy(),b=this.style,d=this.textDesc.size,e=c.StringUtil.getAlignPoint(d,b.textHorizontalAlignment,b.textVerticalAlignment),b=e.x,e=e.y;return new c.PointExtent(a.add(b,
        e),a.add(b+d.width,e+d.height))},translate:function(){var a=this.symbol;return{textName:a.textName,textFaceName:c.Util.getValueOrDefault(a.textFaceName,"monospace"),textWeight:c.Util.getValueOrDefault(a.textWeight,"normal"),textStyle:c.Util.getValueOrDefault(a.textStyle,"normal"),textSize:c.Util.getValueOrDefault(a.textSize,10),textFont:c.Util.getValueOrDefault(a.textFont,null),textFill:c.Util.getValueOrDefault(a.textFill,"#000"),textOpacity:c.Util.getValueOrDefault(a.textOpacity,1),textHaloFill:c.Util.getValueOrDefault(a.textHaloFill,
        "#ffffff"),textHaloRadius:c.Util.getValueOrDefault(a.textHaloRadius,0),textHaloOpacity:c.Util.getValueOrDefault(a.textHaloOpacity,1),textWrapWidth:c.Util.getValueOrDefault(a.textWrapWidth,null),textWrapBefore:c.Util.getValueOrDefault(a.textWrapBefore,!1),textWrapCharacter:c.Util.getValueOrDefault(a.textWrapCharacter,null),textLineSpacing:c.Util.getValueOrDefault(a.textLineSpacing,0),textDx:c.Util.getValueOrDefault(a.textDx,0),textDy:c.Util.getValueOrDefault(a.textDy,0),textHorizontalAlignment:c.Util.getValueOrDefault(a.textHorizontalAlignment,
        "middle"),textVerticalAlignment:c.Util.getValueOrDefault(a.textVerticalAlignment,"middle"),textAlign:c.Util.getValueOrDefault(a.textAlign,"center")}},translateLineAndFill:function(a){return{lineColor:a.textHaloRadius?a.textHaloFill:a.textFill,lineWidth:a.textHaloRadius,lineOpacity:a.textOpacity,lineDasharray:null,lineCap:"butt",lineJoin:"round",polygonFill:a.textFill,polygonOpacity:a.textOpacity}},_descText:function(a){this.textDesc=this._loadFromCache(a,this.style);this.textDesc||(this.textDesc=
        c.StringUtil.splitTextToRow(a,this.style),this._storeToCache(a,this.style,this.textDesc))},_storeToCache:function(a,b,d){c.node||(this.geometry.___text_symbol_cache||(this.geometry.___text_symbol_cache={}),this.geometry.___text_symbol_cache[this._genCacheKey(b)]=d)},_loadFromCache:function(a,b){return this.geometry.___text_symbol_cache?this.geometry.___text_symbol_cache[this._genCacheKey(a,b)]:null},_genCacheKey:function(a,b){var c=[a],e;for(e in b)b.hasOwnProperty(e)&&4<e.length&&"text"===e.substring(0,
        4)&&c.push(e+"="+b[e]);return c.join("-")}});c.symbolizer.TextMarkerSymbolizer.test=function(a){return a?c.Util.isNil(a.textName)?!1:!0:!1};c.symbolizer.TextMarkerSymbolizer.getFont=function(a){return a.textFont?a.textFont:(a.textStyle?a.textStyle+" ":"")+(a.textWeight?a.textWeight+" ":"")+a.textSize+"px "+('"'===a.textFaceName[0]?a.textFaceName:'"'+a.textFaceName+'"')};c.symbolizer.DebugSymbolizer=c.symbolizer.PointSymbolizer.extend({styles:{lineColor:"#000",lineOpacity:1,lineWidth:1},initialize:function(a,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       b,c){this.symbol=a;this.geometry=b;this.painter=c},getPlacement:function(){return"point"},getDxDy:function(){return new c.Point(0,0)},symbolize:function(a){var b=this.geometry,d=b.getLayer();if((b.options.debug||!d||d.options.debug)&&(b=this.getMap())&&!b._zooming){c.Canvas.prepareCanvas(a,this.styles);var b=this.styles.lineOpacity,e=this.getPainter().getContainerExtent(),d=e.getMin(),e=e.getSize();c.Canvas.rectangle(a,d,e,b,0);for(var d=this._getRenderContainerPoints(),e=this.geometry.getId(),f=
        c.symbolizer.VectorMarkerSymbolizer._getVectorPoints("cross",10,10),g=0;g<d.length;g++){var h=d[g];c.Util.isNil(e)||c.Canvas.fillText(a,e,h.add(8,-4),"rgba(0,0,0,1)");for(var k=[],l=0;l<f.length;l++)k.push(f[l].add(h));c.Canvas.path(a,k.slice(0,2),b);c.Canvas.path(a,k.slice(2,4),b)}}}});var x;x={_getRenderPoints:function(){return[[this._getCenter2DPoint()],null]}};c.Marker.include(x);c.Ellipse.include(x,{_getRenderSize:function(){var a=this.getWidth(),b=this.getHeight();return this.getMap().distanceToPixel(a/
        2,b/2)}});c.Circle.include(x,{_getRenderSize:function(){var a=this.getRadius();return this.getMap().distanceToPixel(a,a)}});c.Sector.include(x,{_getRenderSize:function(){var a=this.getRadius();return this.getMap().distanceToPixel(a,a)}});c.Rectangle.include({_getRenderPoints:function(a){if("vertex"===a){a=this.getShell();for(var b=[],c=0,e=a.length;c<e;c++)b.push(this.getMap().coordinateToPoint(a[c]));return[b,null]}return[[this.getMap().coordinateToPoint(this.getCenter())],null]},_getRenderSize:function(){var a=
        this.getWidth(),b=this.getHeight();return this.getMap().distanceToPixel(a,b)}});x={_getRenderPoints:function(a){var b=this.getMap(),d=null;if("vertex"===a)(b=this._getPath2DPoints(this._getPrjCoordinates()))&&0<b.length&&c.Util.isArray(b[0])&&(b=b[0].concat(b[1]));else if("line"===a){b=[];d=[];a=this._getPath2DPoints(this._getPrjCoordinates());var e,f;if(0<a.length&&c.Util.isArray(a[0])){var g,h,k;e=1;for(f=a.length;e<f;e++)for(g=a[e],this instanceof c.Polygon&&0<g.length&&!g[0].equals(g[g.length-
    1])&&g.push(g[0]),h=1,k=g.length;h<k;h++)b.push(g[h].add(g[h-1])._multi(.5)),d.push(c.Util.computeDegree(g[h-1],g[h]))}else for(this instanceof c.Polygon&&0<a.length&&!a[0].equals(a[a.length-1])&&a.push(a[0]),e=1,f=a.length;e<f;e++)b.push(a[e].add(a[e-1])._multi(.5)),d.push(c.Util.computeDegree(a[e-1],a[e]))}else a="vertex-first"===a?this._getPrjCoordinates()[0]:"vertex-last"===a?this._getPrjCoordinates()[this._getPrjCoordinates().length-1]:this._getProjection().project(this.getCenter()),b=[b._prjToPoint(a)];
        return[b,d]}};c.Polyline.include(x);c.Polygon.include(x);c.Browser.canvas&&(x={_getPaintParams:function(){var a=this.getMap(),b=this._getPrjCoordinates(),a=a._prjToPoint(b),b=this._getRenderSize();return[a,b.width,b.height]},_paintOn:c.Canvas.ellipse},c.Ellipse.include(x),c.Circle.include(x),c.Rectangle.include({_getPaintParams:function(){var a=this.getMap()._prjToPoint(this._getPrjCoordinates()),b=this._getRenderSize();return[a,b]},_paintOn:c.Canvas.rectangle}),c.Sector.include({_getPaintParams:function(){var a=
        this.getMap()._prjToPoint(this._getPrjCoordinates()),b=this._getRenderSize();return[a,b.width,[this.getStartAngle(),this.getEndAngle()]]},_paintOn:c.Canvas.sector}),c.LineString.include({arrowStyles:{classic:[3,4]},_getArrowPoints:function(a,b,c,e,f){f||(f=0);var g=c*e[1]+f;c=c*e[0]/2+f;a=b.substract(a)._unit();g=b.add(a.multi(g));a._perp();e=b.add(a.multi(c));a._multi(-1);b=b.add(a.multi(c));return[e,g,b,e]},_getPaintParams:function(){var a=this._getPrjCoordinates();return[this._getPath2DPoints(a)]},
        _paintOn:function(a,b,d,e,f){c.Canvas.path(a,b,d,null,f);this._paintArrow(a,b,d)},_getArrowPlacement:function(){return this.options.arrowPlacement},_getArrowStyle:function(){var a=this.options.arrowStyle;return a?c.Util.isArray(a)?a:this.arrowStyles[a]:null},_getArrows:function(a,b,d){var e=this._getArrowStyle();if(!e||2>a.length)return null;a=0<a.length&&c.Util.isArray(a[0])?a:[a];for(var f=this._getArrowPlacement(),g=[],h=a.length-1;0<=h;h--)if("vertex-first"!==f&&"vertex-firstlast"!==f||g.push(this._getArrowPoints(a[h][1],
                a[h][0],b,e,d)),"vertex-last"===f||"vertex-firstlast"===f)g.push(this._getArrowPoints(a[h][a[h].length-2],a[h][a[h].length-1],b,e,d));else if("point"===f)for(var k=0,l=a[h].length-1;k<l;k++)g.push(this._getArrowPoints(a[h][k],a[h][k+1],b,e,d));return 0<g.length?g:null},_paintArrow:function(a,b,d){var e=this._getInternalSymbol().lineWidth;if(!e||3>e)e=3;if((b=this._getArrows(b,e))&&b)for(a.setLineDash&&a.setLineDash([]),e=b.length-1;0<=e;e--)a.fillStyle=a.strokeStyle,c.Canvas.polygon(a,b[e],d,d)}}),
        c.Polygon.include({_getPaintParams:function(){var a=this._getPrjCoordinates(),a=this._getPath2DPoints(a),b=0<a.length&&c.Util.isArray(a[0]);b&&(a=[[a[0]],[a[1]]]);var d=this._getPrjHoles(),e=[];if(c.Util.isArrayHasData(d))for(var f,g=0;g<d.length;g++)f=this._getPath2DPoints(d[g]),b?c.Util.isArray(f)?(a[0].push(f[0]),a[1].push(f[1])):a[0].push(f):e.push(f);return[b?a:[a].concat(e)]},_paintOn:c.Canvas.polygon}));c.Painter=c.Class.extend({initialize:function(a){this.geometry=a;this.symbolizers=this._createSymbolizers()},
        getMap:function(){return this.geometry.getMap()},_createSymbolizers:function(){var a=this.getSymbol(),b=[],d=c.Painter.registerSymbolizers,e=a;c.Util.isArray(a)||(e=[a]);for(var f,g,h=e.length-1;0<=h;h--){f=e[h];for(var k=d.length-1;0<=k;k--)d[k].test(f,this.geometry)&&(g=new d[k](f,this.geometry,this),b.push(g),g instanceof c.symbolizer.PointSymbolizer&&(this._hasPointSymbolizer=!0))}0===b.length&&console&&console.warn("invalid symbol for geometry("+(this.geometry?this.geometry.getType()+(this.geometry.getId()?
                    ":"+this.geometry.getId():""):"")+") to draw : "+JSON.stringify(a));this._debugSymbolizer=new c.symbolizer.DebugSymbolizer(f,this.geometry,this);this._hasShadow=0<this.geometry.options.shadowBlur;return b},hasPointSymbolizer:function(){return this._hasPointSymbolizer},getTransformMatrix:function(){return this._matrix?this._matrix:null},getRenderPoints:function(a){this._renderPoints||(this._renderPoints={});a||(a="point");this._renderPoints[a]||(this._renderPoints[a]=this.geometry._getRenderPoints(a));
            return this._renderPoints[a]},getPaintParams:function(){this._paintParams||(this._paintParams=this.geometry._getPaintParams());if(!this._paintParams)return null;var a=this.getTransformMatrix(),b=a?a.container:null,a=a?a.scale:null,d=this.geometry.getLayer()._getRenderer()._extent2D.getMin(),e=this._paintParams,f=[],g=e[0],h;c.Util.isArray(g)?h=c.Util.mapArrayRecursively(g,function(a){a=a.substract(d);return b?b.applyToPointInstance(a):a}):g instanceof c.Point&&(h=g.substract(d),b&&(h=b.applyToPointInstance(h)));
            f.push(h);h=1;for(g=e.length;h<g;h++)b?c.Util.isNumber(e[h])||e[h]instanceof c.Size?c.Util.isNumber(e[h])?f.push(a.x*e[h]):f.push(new c.Size(e[h].width*a.x,e[h].height*a.y)):f.push(e[h]):f.push(e[h]);return f},getSymbol:function(){return this.geometry._getInternalSymbol()},paint:function(a){var b=this.geometry.getLayer()._getRenderer().getPaintContext();b&&this.symbolizers&&(this._matrix=a,this.symbolize(a,b))},symbolize:function(a,b){this._prepareShadow(b[0]);for(var c=this.symbolizers.length-1;0<=
        c;c--)this.symbolizers[c].symbolize.apply(this.symbolizers[c],b);this._painted=!0;this._debugSymbolizer.symbolize.apply(this._debugSymbolizer,b)},getSprite:function(a){if(!(this.geometry instanceof c.Marker))return null;this._genSprite=!0;if(!this._sprite&&0<this.symbolizers.length){var b=new c.PointExtent;this.symbolizers.forEach(function(c){c=c.getMarkerExtent(a);b._combine(c)});var d=b.getMin().multi(-1),e=c.Canvas.createCanvas(b.getWidth(),b.getHeight(),this.getMap()?this.getMap().CanvasClass:
            null),f;this._renderPoints&&(f=this._renderPoints);var g=[e.getContext("2d"),a];this._prepareShadow(e.getContext("2d"));for(var h=this.symbolizers.length-1;0<=h;h--){var k=this.symbolizers[h].getDxDy();this._renderPoints={point:[[d.add(k)]]};this.symbolizers[h].symbolize.apply(this.symbolizers[h],g)}f&&(this._renderPoints=f);this._sprite={canvas:e,offset:b.getCenter()}}this._genSprite=!1;return this._sprite},isSpriting:function(){return this._genSprite},_prepareShadow:function(a){this._hasShadow?
            (a.shadowBlur=this.geometry.options.shadowBlur,a.shadowColor=this.geometry.options.shadowColor):a.shadowBlur&&(a.shadowBlur=null,a.shadowColor=null)},_eachSymbolizer:function(a,b){if(this.symbolizers){b||(b=this);for(var c=this.symbolizers.length-1;0<=c;c--)a.apply(b,[this.symbolizers[c]])}},get2DExtent:function(a){if(!this._extent2D&&this.symbolizers){for(var b=new c.PointExtent,d=this.symbolizers.length-1;0<=d;d--)b._combine(this.symbolizers[d].get2DExtent(a));this._extent2D=b}return this._extent2D},
        getContainerExtent:function(){var a=this.getMap(),b=this.getTransformMatrix(),d=this.get2DExtent(this.resources),d=new c.PointExtent(a._pointToContainerPoint(d.getMin()),a._pointToContainerPoint(d.getMax()));b&&(a=b.container.applyToPointInstance(d.getMin()),b=b.container.applyToPointInstance(d.getMax()),d=new c.PointExtent(a,b));return d},setZIndex:function(a){this._eachSymbolizer(function(b){b.setZIndex(a)})},show:function(){this._painted?(this.removeCache(),this._refreshSymbolizers(),this._eachSymbolizer(function(a){a.show()})):
            this.geometry.getLayer().isCanvasRender()||this.paint()},hide:function(){this._eachSymbolizer(function(a){a.hide()})},onZoomEnd:function(){this.removeCache();this._refreshSymbolizers()},repaint:function(){this.removeCache();this._refreshSymbolizers()},_refreshSymbolizers:function(){this._eachSymbolizer(function(a){a.refresh()})},refreshSymbol:function(){this.removeCache();this._removeSymbolizers();this.symbolizers=this._createSymbolizers();if(this.getMap()){var a=this.geometry.getLayer();this.geometry.isVisible()&&
        a instanceof c.VectorLayer&&(a.isCanvasRender()||this.paint())}},remove:function(){this.removeCache();this._removeSymbolizers()},_removeSymbolizers:function(){this._eachSymbolizer(function(a){delete a.painter;a.remove()});delete this.symbolizers},removeCache:function(){delete this._renderPoints;delete this._paintParams;delete this._extent2D;delete this._sprite}});c.Painter.registerSymbolizers=[c.symbolizer.StrokeAndFillSymbolizer,c.symbolizer.ImageMarkerSymbolizer,c.symbolizer.VectorPathMarkerSymbolizer,
        c.symbolizer.VectorMarkerSymbolizer,c.symbolizer.TextMarkerSymbolizer];c.CollectionPainter=c.Class.extend({initialize:function(a){this.geometry=a},_eachPainter:function(a){for(var b=this.geometry.getGeometries(),c,e=0,f=b.length;e<f&&(!(c=b[e]._getPainter())||!c||!1!==a.call(this,c));e++);},paint:function(a){this.geometry&&this._eachPainter(function(b){b.paint(a)})},get2DExtent:function(a){var b=new c.PointExtent;this._eachPainter(function(c){b=b.combine(c.get2DExtent(a))});return b},remove:function(){var a=
        arguments;this._eachPainter(function(b){b.remove.apply(b,a)})},setZIndex:function(){var a=arguments;this._eachPainter(function(b){b.setZIndex.apply(b,a)})},show:function(){var a=arguments;this._eachPainter(function(b){b.show.apply(b,a)})},hide:function(){var a=arguments;this._eachPainter(function(b){b.hide.apply(b,a)})},onZoomEnd:function(){var a=arguments;this._eachPainter(function(b){b.onZoomEnd.apply(b,a)})},repaint:function(){var a=arguments;this._eachPainter(function(b){b.repaint.apply(b,a)})},
        refreshSymbol:function(){var a=arguments;this._eachPainter(function(b){b.refreshSymbol.apply(b,a)})},hasPointSymbolizer:function(){var a=!1;this._eachPainter(function(b){return b.hasPointSymbolizer()?(a=!0,!1):!0});return a}});c.GeoJSONLayer=c.VectorLayer.extend({initialize:function(a,b,d){this.setId(a);!b||c.Util.isArray(b)||b.type||(d=b,b=null);c.Util.setOptions(this,d);b&&(a=this._parse(b),this.addGeometry(a))},addData:function(a){a=this._parse(a);this.addGeometry(a);return this},_parse:function(a){a=
        c.Util.parseJSON(a);return c.Geometry.fromJSON(a)},toJSON:function(a){a=c.VectorLayer.prototype.toJSON.call(this,a);a.type="GeoJSONLayer";var b=[];if(a.geometries){for(var d,e=0,f=a.geometries.length;e<f;e++)d=a.geometries[e].feature,d.id||d.properties||(d=d.geometry),b.push(d);delete a.geometries}a.geojson=b;return a}});c.GeoJSONLayer.fromJSON=function(a){if(!a||"GeoJSONLayer"!==a.type)return null;var b=new c.GeoJSONLayer(a.id,a.geojson,a.options);a.style&&b.setStyle(a.style);return b};c.CanvasLayer=
        c.Layer.extend({options:{doubleBuffer:!1,animation:!1,fps:70},prepareToDraw:function(){},draw:function(){},play:function(){this._getRenderer()&&this._getRenderer().startAnim();return this},pause:function(){this._getRenderer()&&this._getRenderer().pauseAnim();return this},isPlaying:function(){return this._getRenderer()?this._getRenderer().isPlaying():!1},clearCanvas:function(){this._getRenderer()&&this._getRenderer().clearCanvas();return this},requestMapToRender:function(){this._getRenderer()&&this._getRenderer().requestMapToRender();
            return this},completeRender:function(){this._getRenderer()&&this._getRenderer().completeRender();return this},onCanvasCreate:function(){return this},onZoomStart:function(){},onZoomEnd:function(){},onMoveStart:function(){},onMoveEnd:function(){},onResize:function(){},doubleBuffer:function(a){a.clearRect(0,0,a.canvas.width,a.canvas.height);return this}});c.CanvasLayer.registerRenderer("canvas",c.renderer.Canvas.extend({onCanvasCreate:function(){if(this.canvas&&this.layer.options.doubleBuffer){var a=
        this.getMap();this.buffer=c.Canvas.createCanvas(this.canvas.width,this.canvas.height,a.CanvasClass)}},draw:function(){this._predrawed||(this._drawContext=this.layer.prepareToDraw(this.context),this._drawContext||(this._drawContext=[]),Array.isArray(this._drawContext)||(this._drawContext=[this._drawContext]),this._predrawed=!0);this.prepareCanvas();this._drawLayer()},_drawLayer:function(){var a=[this.context];this._animTime&&a.push(c.Util.now()-this._animTime);a.push.apply(a,this._drawContext);this.layer.draw.apply(this.layer,
        a);this.completeRender();this._play()},getCanvasImage:function(){var a=c.renderer.Canvas.prototype.getCanvasImage.apply(this,arguments);if(a&&a.image&&this.layer.options.doubleBuffer){var b=a.image;if(this.buffer.width!==b.width||this.buffer.height!==b.height)this.buffer.width=b.width,this.buffer.height=b.height;var d=this.buffer.getContext("2d");this.layer.doubleBuffer(d,this.context);d.drawImage(b,0,0);a.image=this.buffer}return a},startAnim:function(){this._animTime=c.Util.now();this._paused=!1;
        this._play()},pauseAnim:function(){this._pause();this._paused=!0;delete this._animTime},isPlaying:function(){return!c.Util.isNil(this._frame)},hide:function(){this._pause();return c.renderer.Canvas.prototype.hide.call(this)},show:function(){return c.renderer.Canvas.prototype.show.call(this)},remove:function(){this._pause();delete this._drawContext;return c.renderer.Canvas.prototype.remove.call(this)},onZoomStart:function(a){this._pause();this.layer.onZoomStart(a);c.renderer.Canvas.prototype.onZoomStart.call(this)},
        onZoomEnd:function(a){this.layer.onZoomEnd(a);c.renderer.Canvas.prototype.onZoomEnd.call(this)},onMoveStart:function(a){this._pause();this.layer.onMoveStart(a);c.renderer.Canvas.prototype.onMoveStart.call(this)},onMoveEnd:function(a){this.layer.onMoveEnd(a);c.renderer.Canvas.prototype.onMoveEnd.call(this)},onResize:function(a){this.layer.onResize(a);c.renderer.Canvas.prototype.onResize.call(this)},_pause:function(){this._frame&&(c.Util.cancelAnimFrame(this._frame),delete this._frame);this._animTimeout&&
        (clearTimeout(this._animTimeout),delete this._animTimeout)},_play:function(){if(!this._paused&&this.layer&&this.layer.options.animation){this._animTime||(this._animTime=c.Util.now());var a=c.Util.bind(this._drawLayer,this);this._pause();62.5<=this.layer.options.fps?this._frame=c.Util.requestAnimFrame(a):this._animTimeout=setTimeout(function(){c.Browser.ie9?(a(),this._frame=1):this._frame=c.Util.requestAnimFrame(a)}.bind(this),1E3/this.layer.options.fps)}}}));c.ThreeLayer=c.CanvasLayer.extend({options:{renderWhenPanning:!0,
        camera:"perspective",renderer:"webgl"},coordinateToVector:function(a){var b=this.getMap();return b?b.coordinateToPoint(a,b.getMaxZoom()):null},distanceToVector:function(a,b){var c=this.getMap(),e=c.getScale(),c=c.distanceToPixel(a,b)._multi(e);return new THREE.Vector2(c.width,c.height)},toShape:function(a){if(!a)return null;var b=this;if(a instanceof c.MultiPolygon)return a.getGeometries().map(function(a){return b.toShape(a)});var d=a.getCenter(),e=this.coordinateToVector(d),d=a.getShell().map(function(a){a=
        b.coordinateToVector(a)._substract(e);return new THREE.Vector2(a.x,a.y)}),d=new THREE.Shape(d);(a=a.getHoles())&&0<a.length&&(d.holes=a.map(function(a){a=a.map(function(a){a=b.coordinateToVector(a)._substract(e);return new THREE.Vector2(a.x,a.y)});return new THREE.Shape(a)}));return d},toExtrudeGeometry:function(a,b,d){if(!a)return null;var e=this;if(a instanceof c.MultiPolygon)return a.getGeometries().map(function(a){return e.toExtrudeGeometry(a,b,d)});var f=this.toShape(a);a=this.coordinateToVector(a.getCenter());
        b=this.distanceToVector(b,b).x;f=new THREE.ExtrudeGeometry(f,{amount:b,bevelEnabled:!0});f=new THREE.Mesh(f,d);f.position.set(a.x,a.y,-b);return f},lookAt:function(a){var b=this._getRenderer();b&&b.context.lookAt(a);return this},getCamera:function(){var a=this._getRenderer();return a?a.camera:null},getScene:function(){var a=this._getRenderer();return a?a.scene:null},renderScene:function(){var a=this._getRenderer();return a?a.renderScene():this},getThreeRenderer:function(){var a=this._getRenderer();
        return a?a.context:null}});(function(){var a=c.CanvasLayer.getRendererClass("canvas").extend({initialize:function(a){this.layer=a},hitDetect:function(){return!1},createCanvas:function(){if(!this.canvas){var a=this.getMap(),d=a.getSize(),e=c.Browser.retina?2:1;this.canvas=c.Canvas.createCanvas(e*d.width,e*d.height);var e=this.layer.options.renderer,f;"webgl"===e?(f=new THREE.WebGLRenderer({canvas:this.canvas,alpha:!0,preserveDrawingBuffer:!0}),f.autoClear=!1,f.clear()):"canvas"===e&&(f=new THREE.CanvasRenderer({canvas:this.canvas,
            alpha:!0}));f.setSize(this.canvas.width,this.canvas.height);f.setClearColor(new THREE.Color(1,1,1),0);f.canvas=this.canvas;this.context=f;f=a.getScale(a.getMinZoom())/a.getScale(a.getMaxZoom());a=this.scene=new THREE.Scene;d=this.camera=new THREE.PerspectiveCamera(90,d.width/d.height,1,1E4*f);this.onCanvasCreate();this.layer.onCanvasCreate(this.context,this.scene,this.camera);a.add(d)}},resizeCanvas:function(a){if(this.canvas){a=a?a:this.getMap().getSize();var d=c.Browser.retina?2:1;this.canvas.height=
        d*a.height;this.canvas.width=d*a.width;this.camera.aspect=this.canvas.width/this.canvas.height;this.camera.updateProjectionMatrix();this.context.setSize(this.canvas.width,this.canvas.height)}},clearCanvas:function(){this.canvas&&this.context.clear()},prepareCanvas:function(){this.canvas?this.clearCanvas():this.createCanvas();this.layer.fire("renderstart",{context:this.context});return null},draw:function(){this.prepareCanvas();this._predrawed||(this._drawContext=this.layer.prepareToDraw(this.context,
        this.scene,this.camera),this._drawContext||(this._drawContext=[]),Array.isArray(this._drawContext)||(this._drawContext=[this._drawContext]),this._predrawed=!0);this._drawLayer()},_drawLayer:function(){this.layer.draw.apply(this.layer,[this.context,this.scene,this.camera].concat(this._drawContext));this.renderScene();this._play()},renderScene:function(){this._locateCamera();this.context.clear();this.context.render(this.scene,this.camera);this.completeRender()},remove:function(){delete this._drawContext;
        c.renderer.Canvas.prototype.remove.call(this)},onZoomStart:function(a){this.layer.onZoomStart(this.scene,this.camera,a);c.renderer.Canvas.prototype.onZoomStart.call(this)},onZoomEnd:function(a){this.layer.onZoomEnd(this.scene,this.camera,a);c.renderer.Canvas.prototype.onZoomEnd.call(this)},onMoveStart:function(a){this.layer.onMoveStart(this.scene,this.camera,a);c.renderer.Canvas.prototype.onMoveStart.call(this)},onMoving:function(){this.layer.options.renderWhenPanning&&(this.prepareRender(),this.draw())},
        onMoveEnd:function(a){this.layer.onMoveEnd(this.scene,this.camera,a);c.renderer.Canvas.prototype.onMoveEnd.call(this)},onResize:function(a){this.layer.onResize(this.scene,this.camera,a);c.renderer.Canvas.prototype.onResize.call(this)},_locateCamera:function(){var a=this.getMap(),c=a.getFullExtent(),e=a.getSize(),f=a.getScale(),g=this.camera,h=a.getCenter(),a=a.coordinateToPoint(h,a.getMaxZoom());g.position.set(a.x,a.y,-(f*e.height/2));g.up.set(0,c.top>=c.bottom?-1:1,0);g.lookAt(new THREE.Vector3(a.x,
            a.y,0));this.camera.updateProjectionMatrix()}});c.ThreeLayer.registerRenderer("canvas",a);c.ThreeLayer.registerRenderer("webgl",a)})();c.ParticleLayer=c.CanvasLayer.extend({options:{animation:!0,fps:70},getParticles:function(){},draw:function(a){var b=this.getMap().getContainerExtent(),d=this.getParticles(c.Util.now());if(d){for(var e,f=0,g=d.length;f<g;f++)e=d[f].point,b.contains(e)&&(a.fillStyle!==d[f].color&&(a.fillStyle=d[f].color||this.options.lineColor||"#fff"),a.fillRect(e.x-d[f].r/2,e.y-d[f].r/
        2,d[f].r,d[f].r));this._fillCanvas(a)}},_fillCanvas:function(a){var b=a.globalCompositeOperation;a.globalCompositeOperation="destination-out";a.fillStyle="rgba(0, 0, 0, "+1/(this.options.trail||30)+")";a.fillRect(0,0,a.canvas.width,a.canvas.height);a.globalCompositeOperation=b}});c.ui={};c.ui.UIComponent=c.Class.extend({includes:[c.Eventable],options:{eventsToStop:"mousedown dblclick",dx:0,dy:0,autoPan:!1,single:!0,animation:"scale",animationOnHide:!0,animationDuration:500,animationDelay:0},initialize:function(a){c.Util.setOptions(this,
        a)},addTo:function(a){this._owner=a;this.fire("add");return this},getMap:function(){return this._owner?this._owner instanceof c.Map?this._owner:this._owner.getMap():null},show:function(a){var b=this.getMap();if(!b)return this;if(!a)if(this._coordinate)a=this._coordinate;else throw Error("UI's show coordinate is invalid");this.fire("showstart");var d=this._getUIContainer();this.__uiDOM||this._switchEvents("on");this._coordinate=a;this._removePrevDOM();var e=this.__uiDOM=this.buildOn(b);if(!e)return this.fire("showend"),
        this;this._measureSize(e);this._singleton()&&(b[this._uiDomKey()]=e);a=this.getPosition();e.style.position="absolute";e.style.left=a.x+"px";e.style.top=a.y+"px";e.style[c.DomUtil.TRANSITION]=null;d.appendChild(e);var f=this._getAnimation();f.fade&&(e.style.opacity=0);f.scale&&(this.getTransformOrigin&&(d=this.getTransformOrigin(),e.style[c.DomUtil.TRANSFORMORIGIN]=d.x+"px "+d.y+"px"),e.style[c.DomUtil.TRANSFORM]="scale(0)");e.style.display="";if(this.options.eventsToStop)c.DomUtil.on(e,this.options.eventsToStop,
        c.DomUtil.stopPropagation);this.options.autoPan&&this._autoPan();var g=f.transition;g&&(d=function(){g&&(e.style[c.DomUtil.TRANSITION]=g);f.fade&&(e.style.opacity=1);f.scale&&(e.style[c.DomUtil.TRANSFORM]="scale(1)")},this.options.animationDelay?setTimeout(d,this.options.animationDelay):d());this.fire("showend");return this},hide:function(){if(!this.getDOM()||!this.getMap())return this;var a=this._getAnimation(),b=this.getDOM();this.options.animationOnHide||(a.anim=!1);a.fade&&(b.style.opacity=0);
        a.scale&&(b.style[c.DomUtil.TRANSFORM]="scale(0)");a.anim?setTimeout(function(){b.style.display="none"},this.options.animationDuration):b.style.display="none";this.fire("hide");return this},isVisible:function(){return this.getDOM()&&"none"!==this.getDOM().style.display},remove:function(){if(!this._owner)return this;this.hide();this._switchEvents("off");if(this.onRemove)this.onRemove();!this._singleton()&&this.__uiDOM&&this._removePrevDOM();delete this._owner;this.fire("remove");return this},getSize:function(){return this._size?
        this._size.copy():null},getOwner:function(){return this._owner},getDOM:function(){return this.__uiDOM},getPosition:function(){if(!this.getMap())return null;var a=this._getViewPoint();if(this.getOffset){var b=this.getOffset();b&&a._add(b)}return a},_getAnimation:function(){for(var a={fade:!1,scale:!1},b=this.options.animation?this.options.animation.split(","):[],d=0;d<b.length;d++){var e=c.StringUtil.trim(b[d]);"fade"===e?a.fade=!0:"scale"===e&&(a.scale=!0)}b=null;a.fade&&(b="opacity "+this.options.animationDuration+
        "ms");a.scale&&(b=(b?b+",":"")+("transform "+this.options.animationDuration+"ms"));a.transition=b;a.anim=null!==b;return a},_getViewPoint:function(){return this.getMap().coordinateToViewPoint(this._coordinate)._add(this.options.dx,this.options.dy)},_autoPan:function(){var a=this.getMap(),b=this.getDOM();if(!a._moving&&!a._panAnimating){var d=new c.Point(parseInt(b.style.left),parseInt(b.style.top)),e=a.getSize(),f=e.width,e=e.height,d=a.viewPointToContainerPoint(d),g=parseInt(b.clientWidth),b=parseInt(b.clientHeight),
        h=0,k=0;0>d.x?h=-(d.x-g/2):d.x+g-35>f&&(h=f-(d.x+3*g/2));0>d.y?k=-d.y+50:d.y>e&&(k=e-d.y-b-30);0===k&&0===h||a._panAnimation(new c.Point(h,k),600)}},_measureSize:function(a){var b=this._getUIContainer();a.style.position="absolute";a.style.left="-99999px";a.style.top="-99999px";a.style.display="";b.appendChild(a);this._size=new c.Size(a.clientWidth,a.clientHeight);a.style.display="none";return this._size},_removePrevDOM:function(){if(this.onDomRemove)this.onDomRemove();if(this._singleton()){var a=
        this.getMap(),b=this._uiDomKey();a[b]&&(c.DomUtil.removeDomNode(a[b]),delete a[b]);delete this.__uiDOM}else this.__uiDOM&&(c.DomUtil.removeDomNode(this.__uiDOM),delete this.__uiDOM)},_uiDomKey:function(){return"__ui_"+this._getClassName()},_singleton:function(){return this.options.single},_getUIContainer:function(){return this.getMap()._panels.ui},_getClassName:function(){for(var a in c.ui)if(c.ui.hasOwnProperty(a)&&"UIComponent"!==a&&this instanceof c.ui[a])return a;return null},_switchEvents:function(a){var b=
        this._getDefaultEvents();this.getEvents&&c.Util.extend(b,this.getEvents());var d;if(b){var e=this.getMap();for(d in b)if(b.hasOwnProperty(d))e[a](d,b[d],this)}b=this._getOwnerEvents();if(this._owner&&b)for(d in b)if(b.hasOwnProperty(d))this._owner[a](d,b[d],this)},_getDefaultEvents:function(){return{zooming:this.onZooming,zoomend:this.onZoomEnd}},_getOwnerEvents:function(){return this._owner&&this._owner instanceof c.Geometry?{positionchange:this.onGeometryPositionChange}:null},onGeometryPositionChange:function(a){this._owner&&
    this.getDOM()&&this.isVisible()&&this.show(a.target.getCenter())},onZooming:function(a){if(this.isVisible()&&this.getDOM()&&this.getMap()){var b=this.getDOM(),c=this.getMap().coordinateToViewPoint(this._coordinate);a=a.matrix.view.applyToPointInstance(c)._add(this.options.dx,this.options.dy);this.getOffset&&(c=this.getOffset())&&a._add(c);b.style.left=a.x+"px";b.style.top=a.y+"px"}},onZoomEnd:function(){if(this.isVisible()&&this.getDOM()&&this.getMap()){var a=this.getDOM(),b=this.getPosition();a.style.left=
        b.x+"px";a.style.top=b.y+"px"}}});c.ui.UIMarker=c.ui.UIComponent.extend({includes:[c.Handlerable],options:{draggable:!1,single:!1,content:null},initialize:function(a,b){this._markerCoord=new c.Coordinate(a);c.Util.setOptions(this,b)},setCoordinates:function(a){this._markerCoord=a;this.fire("positionchange");this.isVisible()&&this.show();return this},getCoordinates:function(){return this._markerCoord},setContent:function(a){var b=this.options.content;this.options.content=a;this.fire("contentchange",
        {old:b,"new":a});this.isVisible()&&this.show();return this},getContent:function(){return this.options.content},show:function(){return c.ui.UIComponent.prototype.show.call(this,this._markerCoord)},buildOn:function(){var a;c.Util.isString(this.options.content)?(a=c.DomUtil.createEl("div"),a.innerHTML=this.options.content):a=this.options.content;this._registerDOMEvents(a);return a},getOffset:function(){var a=this.getSize();return new c.Point(-a.width/2,-a.height/2)},getTransformOrigin:function(){var a=
        this.getSize();return new c.Point(a.width/2,a.height/2)},onDomRemove:function(){var a=this.getDOM();this._removeDOMEvents(a)},_domEvents:"mousedown mouseup mouseover mouseout mousemove click dblclick contextmenu keypress touchstart touchmove touchend",_registerDOMEvents:function(a){c.DomUtil.on(a,this._domEvents,this._onDomEvents,this)},_onDomEvents:function(a){try{var b=this.getMap()._parseEvent(a,a.type);this.fire(a.type,b)}catch(c){}},_removeDOMEvents:function(a){c.DomUtil.off(a,this._domEvents,
        this._onDomEvents,this)}});c.ui.UIMarker.Drag=c.Handler.extend({START:c.Browser.touch?["touchstart","mousedown"]:["mousedown"],addHooks:function(){this.target.on(this.START.join(" "),this._startDrag,this)},removeHooks:function(){this.target.off(this.START.join(" "),this._startDrag,this)},_startDrag:function(a){var b=a.domEvent;b.touches&&1<b.touches.length||this.isDragging()||(this.target.on("click",this._endDrag,this),this._lastPos=a.coordinate,this._prepareDragHandler(),this._dragHandler.onMouseDown(a.domEvent),
        this.target.fire("dragstart",a))},_prepareDragHandler:function(){this._dragHandler=new c.Handler.Drag(this.target.getDOM(),{cancelOn:c.Util.bind(this._cancelOn,this)});this._dragHandler.on("mousedown",this._onMouseDown,this);this._dragHandler.on("dragging",this._dragging,this);this._dragHandler.on("mouseup",this._endDrag,this);this._dragHandler.enable()},_cancelOn:function(a){a=(a.srcElement||a.target).tagName.toLowerCase();return"button"===a||"input"===a||"select"===a||"option"===a||"textarea"===
    a?!0:!1},_onMouseDown:function(a){c.DomUtil.stopPropagation(a.domEvent)},_dragging:function(a){var b=this.target;a=b.getMap()._parseEvent(a.domEvent);var c=a.domEvent;if(!(c.touches&&1<c.touches.length))if(this._isDragging){c=a.coordinate;this._lastPos||(this._lastPos=c);var e=c.substract(this._lastPos);this._lastPos=c;this.target.setCoordinates(this.target.getCoordinates().add(e));a.dragOffset=e;b.fire("dragging",a)}else this._isDragging=!0},_endDrag:function(a){var b=this.target,c=b.getMap();this._dragHandler&&
    (b.off("click",this._endDrag,this),this._dragHandler.disable(),delete this._dragHandler);delete this._lastPos;this._isDragging=!1;c&&(a=c._parseEvent(a.domEvent),b.fire("dragend",a))},isDragging:function(){return this._isDragging?!0:!1}});c.ui.UIMarker.addInitHook("addHandler","draggable",c.ui.UIMarker.Drag);c.ui.UIMarker.include({isDragging:function(){return this.draggable?this.draggable.isDragging():!1}});c.ui.InfoWindow=c.ui.UIComponent.extend({options:{autoPan:!0,width:300,minHeight:120,custom:!1,
        title:null,content:null},addTo:function(a){a instanceof c.Geometry&&(a.getInfoWindow()&&a.getInfoWindow()!==this&&a.removeInfoWindow(),a._infoWindow=this);return c.ui.UIComponent.prototype.addTo.apply(this,arguments)},setContent:function(a){var b=this.options.content;this.options.content=a;this.fire("contentchange",{old:b,"new":a});this.isVisible()&&this.show(this._coordinate);return this},getContent:function(){return this.options.content},setTitle:function(a){this.options.title=a;this.fire("contentchange",
        {old:a,"new":a});this.isVisible()&&this.show(this._coordinate);return this},getTitle:function(){return this.options.title},buildOn:function(){var a;if(this.options.custom)return c.Util.isString(this.options.content)?(a=c.DomUtil.createEl("div"),a.innerHTML=this.options.content,a):this.options.content;a=c.DomUtil.createEl("div");a.className="maptalks-msgBox";a.style.width=this._getWindowWidth()+"px";var b='<em class="maptalks-ico"></em>';this.options.title&&(b+="<h2>"+this.options.title+"</h2>");b+=
        '<a href="javascript:void(0);" onclick="this.parentNode.style.display=\'none\';return false;"  class="maptalks-close"></a><div class="maptalks-msgContent">'+this.options.content+"</div>";a.innerHTML=b;return a},getTransformOrigin:function(){var a=this.getSize(),a=new c.Point(a.width/2,a.height);this.options.custom||a._add(4,12);return a},getOffset:function(){var a=this.getSize(),a=new c.Point(-a.width/2,-a.height);this.options.custom||a._substract(4,12);if(this.getOwner()instanceof c.Marker){var b=
        this.getOwner().getSize();b&&a._add(0,-b.height)}return a},show:function(){return this.getMap()&&this.getMap().options.enableInfoWindow?c.ui.UIComponent.prototype.show.apply(this,arguments):this},_getWindowWidth:function(){var a=this.options.width;a||(a=300);return a}});(function(){var a={animation:null,animationDelay:10,animationOnHide:!1,eventsToStop:"mousedown dblclick click",autoPan:!1,width:160,custom:!1,items:[]};c.ui.Menu=c.ui.UIComponent.extend({options:a,addTo:function(a){a._menu&&a._menu!==
    this&&a.removeMenu();a._menu=this;return c.ui.UIComponent.prototype.addTo.apply(this,arguments)},setItems:function(a){this.options.items=a;return this},getItems:function(){return this.options.items},buildOn:function(){if(this.options.custom){if(c.Util.isString(this.options.items)){var a=c.DomUtil.createEl("div");a.innerHTML=this.options.items;return a}return this.options.items}a=c.DomUtil.createEl("div");c.DomUtil.addClass(a,"maptalks-menu");a.style.width=this._getMenuWidth()+"px";var d=this._createMenuItemDom();
        a.appendChild(d);return a},getOffset:function(){if(!this.getMap())return null;var a=this.getMap().getSize(),d=this.getMap().viewPointToContainerPoint(this._getViewPoint()),e=this.getSize(),f=0,g=0;d.x+e.width>a.width&&(f=-e.width);d.y+e.height>a.height&&(g=-e.height);return new c.Point(f,g)},getTransformOrigin:function(){return this.getOffset()._multi(-1)},getEvents:function(){return{"_zoomstart _zoomend _movestart _dblclick _click":this.hide}},_createMenuItemDom:function(){function a(b){return function(a){a=
        e._parseEvent(a,"click");a.target=d;a.owner=d._owner;a.index=b;!1!==this._callback(a)&&d.hide()}}var d=this,e=this.getMap(),f=c.DomUtil.createEl("ul");c.DomUtil.addClass(f,"maptalks-menu-items");for(var g=this.getItems(),h,k,l=0,m=g.length;l<m;l++){h=g[l];if("-"===h||"_"===h)k=c.DomUtil.createEl("li"),c.DomUtil.addClass(k,"maptalks-menu-splitter");else{k=c.DomUtil.createEl("li");var n=h.item;c.Util.isFunction(n)&&(n=n({owner:this._owner,index:l}));k.innerHTML=n;k._callback=h.click;c.DomUtil.on(k,
        "click",a(l))}f.appendChild(k)}return f},_getMenuWidth:function(){var a=this.options.width;a||(a=160);return a}});c.ui.Menu.Mixin={setMenu:function(b){this._menuOptions=b;if(this._menu)c.Util.setOptions(this._menu,c.Util.extend(a,b));else this.on("contextmenu",this._defaultOpenMenu,this);return this},openMenu:function(a){var d=this instanceof c.Map?this:this.getMap();a||(a=this.getCenter());this._menu?this._menu.show(a):this._menuOptions&&d&&(this._bindMenu(this._menuOptions),this._menu.show(a));
        return this},setMenuItems:function(a){this._menuOptions||(this._menuOptions={});c.Util.isArray(a)&&(this._menuOptions.custom=!1);this._menuOptions.items=a;this.setMenu(this._menuOptions);return this},getMenuItems:function(){return this._menu?this._menu.getItems():this._menuOptions?this._menuOptions.items:null},closeMenu:function(){this._menu&&this._menu.hide();return this},removeMenu:function(){this.off("contextmenu",this._defaultOpenMenu,this);this._unbindMenu();delete this._menuOptions;return this},
        _bindMenu:function(a){this._menu=new c.ui.Menu(a);this._menu.addTo(this);return this},_unbindMenu:function(){this._menu&&(this.closeMenu(),this._menu.remove(),delete this._menu);return this},_defaultOpenMenu:function(a){if(1<this.listens("contextmenu"))return!0;this.openMenu(a.coordinate);return!1}}})();c.Map.include(c.ui.Menu.Mixin);c.Geometry.include(c.ui.Menu.Mixin);c.Geometry.include({setInfoWindow:function(a){this._infoWinOptions=c.Util.extend({},a);this._infoWindow?c.Util.setOptions(this._infoWindow,
            a):this.getMap()&&this._bindInfoWindow(this._infoWinOptions);return this},getInfoWindow:function(){return this._infoWindow?this._infoWindow:null},openInfoWindow:function(a){if(!this.getMap())return this;a||(a=this.getCenter());this._infoWindow?this._infoWindow.show(a):this._infoWinOptions&&this.getMap()&&(this._bindInfoWindow(this._infoWinOptions),this._infoWindow.show(a));return this},closeInfoWindow:function(){this._infoWindow&&this._infoWindow.hide();return this},removeInfoWindow:function(){this._unbindInfoWindow();
        delete this._infoWinOptions;delete this._infoWindow;return this},_bindInfoWindow:function(a){this._infoWindow=new c.ui.InfoWindow(a);this._infoWindow.addTo(this);return this},_unbindInfoWindow:function(){this._infoWindow&&(this.closeInfoWindow(),this._infoWindow.remove(),delete this._infoWindow);return this}});c.control={};c.control.Control=c.Class.extend({includes:[c.Eventable],statics:{positions:{"top-left":{top:"20",left:"20"},"top-right":{top:"40",right:"60"},"bottom-left":{bottom:"20",left:"60"},
        "bottom-right":{bottom:"20",right:"60"}}},initialize:function(a){a&&a.position&&!c.Util.isString(a.position)&&(a.position=c.Util.extend({},a.position));c.Util.setOptions(this,a)},addTo:function(a){this.remove();this._map=a;a=a._panels.control;this.__ctrlContainer=c.DomUtil.createEl("div");c.DomUtil.setStyle(this.__ctrlContainer,"position:absolute");c.DomUtil.addStyle(this.__ctrlContainer,"z-index",a.style.zIndex);this.update();a.appendChild(this.__ctrlContainer);this.fire("add",{dom:a});return this},
        update:function(){this.__ctrlContainer.innerHTML="";if(this._controlDom=this.buildOn(this.getMap()))this._updatePosition(),this.__ctrlContainer.appendChild(this._controlDom);return this},getMap:function(){return this._map},getPosition:function(){return c.Util.extend({},this._parse(this.options.position))},setPosition:function(a){c.Util.isString(a)?this.options.position=a:this.options.position=c.Util.extend({},a);this._updatePosition();return this},getContainerPoint:function(){var a=this.getPosition(),
            b=this.getMap().getSize(),d,e;c.Util.isNil(a.top)?c.Util.isNil(a.bottom)||(d=b.height-a.bottom):d=a.top;c.Util.isNil(a.left)?c.Util.isNil(a.right)||(e=b.width-a.right):e=a.left;return new c.Point(d,e)},getContainer:function(){return this.__ctrlContainer},getDOM:function(){return this._controlDom},show:function(){this.__ctrlContainer.style.display="";return this},hide:function(){this.__ctrlContainer.style.display="none";return this},isVisible:function(){return this.__ctrlContainer&&""===this.__ctrlContainer.style.display},
        remove:function(){if(!this._map)return this;c.DomUtil.removeDomNode(this.__ctrlContainer);if(this.onRemove)this.onRemove();delete this._map;delete this.__ctrlContainer;delete this._controlDom;this.fire("remove");return this},_parse:function(a){var b=a;c.Util.isString(a)&&(b=c.control.Control.positions[b]);return b},_updatePosition:function(){var a=this.getPosition();a||(a={top:20,left:20});for(var b in a)a.hasOwnProperty(b)&&(a[b]=parseInt(a[b]),this.__ctrlContainer.style[b]=a[b]+"px");this.fire("positionchange",
            {position:c.Util.extend({},a)})}});c.Map.mergeOptions({control:!0});c.Map.include({addControl:function(a){if(!this.options.control||this._containerDOM.getContext)return this;a.addTo(this);return this},removeControl:function(a){if(!a||a.getMap()!==this)return this;a.remove();return this}});c.control.Zoom=c.control.Control.extend({options:{position:"top-left",slider:!0,zoomLevel:!0},buildOn:function(a){this._map=a;var b=this.options,d=c.DomUtil.createEl("div","maptalks-zoom");if(b.zoomLevel){var e=
        c.DomUtil.createEl("span","maptalks-zoom-zoomlevel");d.appendChild(e);this._levelDOM=e}var e=c.DomUtil.createEl("div","maptalks-zoom-slider"),f=c.DomUtil.createEl("a","maptalks-zoom-zoomin");f.href="javascript:;";f.innerHTML="+";e.appendChild(f);this._zoomInButton=f;if(b.slider){var b=c.DomUtil.createEl("div","maptalks-zoom-slider-box"),f=c.DomUtil.createEl("div","maptalks-zoom-slider-ruler"),g=c.DomUtil.createEl("span","maptalks-zoom-slider-reading"),h=c.DomUtil.createEl("span","maptalks-zoom-slider-dot");
        f.appendChild(g);f.appendChild(h);b.appendChild(f);e.appendChild(b);this._sliderBox=b;this._sliderRuler=f;this._sliderReading=g;this._sliderDot=h}b=c.DomUtil.createEl("a","maptalks-zoom-zoomout");b.href="javascript:;";b.innerHTML="-";e.appendChild(b);this._zoomOutButton=b;d.appendChild(e);a.on("_zoomend _zoomstart _viewchange",this._update,this);this._update();this._registerDomEvents();return d},_update:function(){var a=this.getMap();if(this._sliderBox){var b=10*(a.getMaxZoom()-a.getMinZoom());this._sliderBox.style.height=
        b+6+"px";this._sliderRuler.style.height=b+"px";b=10*(a.getZoom()-a.getMinZoom());this._sliderReading.style.height=b+"px";this._sliderDot.style.bottom=b+"px"}this._levelDOM&&(this._levelDOM.innerHTML=a.getZoom())},_registerDomEvents:function(){var a=this.getMap();if(this._zoomInButton)c.DomUtil.on(this._zoomInButton,"click",a.zoomIn,a);if(this._zoomOutButton)c.DomUtil.on(this._zoomOutButton,"click",a.zoomOut,a)},onRemove:function(){var a=this.getMap();this._zoomInButton&&c.DomUtil.off(this._zoomInButton,
        "click",a.zoomIn,a);this._zoomOutButton&&c.DomUtil.off(this._zoomOutButton,"click",a.zoomOut,a)}});c.Map.mergeOptions({zoomControl:!1});c.Map.addOnLoadHook(function(){this.options.zoomControl&&(this.zoomControl=new c.control.Zoom(this.options.zoomControl),this.addControl(this.zoomControl))});c.control.Attribution=c.control.Control.extend({options:{position:"bottom-left",content:'Powered By <a href="http://www.maptalks.org" target="_blank">MapTalks</a>'},buildOn:function(){this._attributionContainer=
        c.DomUtil.createEl("div","maptalks-attribution");this._update();return this._attributionContainer},setContent:function(a){this.options.content=a;this._update();return this},_update:function(){this.getMap()&&(this._attributionContainer.innerHTML=this.options.content)}});c.Map.mergeOptions({attributionControl:!1});c.Map.addOnLoadHook(function(){this.options.attributionControl&&(this.attributionControl=new c.control.Attribution(this.options.attributionControl),this.addControl(this.attributionControl))});
    c.control.Scale=c.control.Control.extend({options:{position:"bottom-left",maxWidth:100,metric:!0,imperial:!1},buildOn:function(a){this._map=a;this._scaleContainer=c.DomUtil.createEl("div");this._addScales();a.on("zoomend",this._update,this);this._map._loaded&&this._update();return this._scaleContainer},onRemove:function(){this.getMap().off("zoomend",this._update,this)},_addScales:function(){this.options.metric&&(this._mScale=c.DomUtil.createElOn("div","border: 2px solid #000000;border-top: none;line-height: 1.1;padding: 2px 5px 1px;color: #000000;font-size: 11px;text-align:center;white-space: nowrap;overflow: hidden;-moz-box-sizing: content-box;box-sizing: content-box;background: #fff; background: rgba(255, 255, 255, 0);",
        this._scaleContainer));this.options.imperial&&(this._iScale=c.DomUtil.createElOn("div","border: 2px solid #000000;border-top: none;line-height: 1.1;padding: 2px 5px 1px;color: #000000;font-size: 11px;text-align:center;white-space: nowrap;overflow: hidden;-moz-box-sizing: content-box;box-sizing: content-box;background: #fff; background: rgba(255, 255, 255, 0);",this._scaleContainer))},_update:function(){var a=this._map.pixelToDistance(this.options.maxWidth,0);this._updateScales(a)},_updateScales:function(a){this.options.metric&&
    a&&this._updateMetric(a);this.options.imperial&&a&&this._updateImperial(a)},_updateMetric:function(a){var b=this._getRoundNum(a);this._updateScale(this._mScale,1E3>b?b+" m":b/1E3+" km",b/a)},_updateImperial:function(a){a*=3.2808399;var b;5280<a?(a/=5280,b=this._getRoundNum(a),this._updateScale(this._iScale,b+" mile",b/a)):(b=this._getRoundNum(a),this._updateScale(this._iScale,b+" feet",b/a))},_updateScale:function(a,b,c){a.style.width=Math.round(this.options.maxWidth*c)+"px";a.innerHTML=b},_getRoundNum:function(a){var b=
        Math.pow(10,(Math.floor(a)+"").length-1);a/=b;return b*(10<=a?10:5<=a?5:3<=a?3:2<=a?2:1)}});c.Map.mergeOptions({scaleControl:!1});c.Map.addOnLoadHook(function(){this.options.scaleControl&&(this.scaleControl=new c.control.Scale(this.options.scaleControl),this.addControl(this.scaleControl))});c.control.Panel=c.control.Control.extend({options:{position:"top-right",draggable:!0,custom:!1,content:"",closeButton:!0},buildOn:function(){var a;if(this.options.custom)c.Util.isString(this.options.content)?(a=
            c.DomUtil.createEl("div"),a.innerHTML=this.options.content):a=this.options.content;else{a=c.DomUtil.createEl("div","maptalks-panel");if(this.options.closeButton){var b=c.DomUtil.createEl("a","maptalks-close");b.href="javascript:;";b.onclick=function(){a.style.display="none"};a.appendChild(b)}b=c.DomUtil.createEl("div","maptalks-panel-content");b.innerHTML=this.options.content;a.appendChild(b)}this.draggable=new c.Handler.Drag(a,{cancelOn:c.Util.bind(this._cancelOn,this)});this.draggable.on("dragstart",
        this._onDragStart,this).on("dragging",this._onDragging,this).on("dragend",this._onDragEnd,this);this.options.draggable&&this.draggable.enable();return a},update:function(){this.draggable&&(this.draggable.disable(),delete this.draggable);return c.control.Control.prototype.update.call(this)},setContent:function(a){var b=this.options.content;this.options.content=a;this.fire("contentchange",{old:b,"new":a});this.isVisible()&&this.update();return this},getContent:function(){return this.options.content},
        _cancelOn:function(a){a=(a.srcElement||a.target).tagName.toLowerCase();return"button"===a||"input"===a||"select"===a||"option"===a||"textarea"===a?!0:!1},_onDragStart:function(a){this._startPos=a.mousePos;this._startPosition=c.Util.extend({},this.getPosition())},_onDragging:function(a){a=a.mousePos.substract(this._startPos);var b=this._startPosition,d=this.getPosition();c.Util.isNil(d.top)||(d.top=+b.top+a.y);c.Util.isNil(d.bottom)||(d.bottom=+b.bottom-a.y);c.Util.isNil(d.left)||(d.left=+b.left+a.x);
            c.Util.isNil(d.right)||(d.right=+b.right-a.x);this.setPosition(d)},_onDragEnd:function(){delete this._startPos;delete this._startPosition},_getConnectPoints:function(){var a=this._map,b=this.getContainerPoint(),d=this.getDOM(),e=d.clientWidth,d=d.clientHeight;return[a.containerPointToCoordinate(b.add(new c.Point(Math.round(e/2),0))),a.containerPointToCoordinate(b.add(new c.Point(e,Math.round(d/2)))),a.containerPointToCoordinate(b.add(new c.Point(Math.round(e/2),d))),a.containerPointToCoordinate(b.add(new c.Point(0,
            Math.round(d/2))))]}});c.control.Toolbar=c.control.Control.extend({options:{height:28,vertical:!1,position:"top-right",items:{}},buildOn:function(a){function b(a,b,d,f){var g=e._getItems()[b];return function(e){c.DomUtil.stopPropagation(e);return a({target:g,index:b,childIndex:d,dom:f})}}this._map=a;a=c.DomUtil.createEl("div");var d=c.DomUtil.createEl("ul","maptalks-toolbar-hx");a.appendChild(d);this.options.vertical?c.DomUtil.addClass(a,"maptalks-toolbar-vertical"):c.DomUtil.addClass(a,"maptalks-toolbar-horizonal");
        var e=this,f=this.options.items;if(c.Util.isArrayHasData(f))for(var g=0,h=f.length;g<h;g++){var k=f[g],l=c.DomUtil.createEl("li");28!==this.options.height&&(l.style.lineHeight=this.options.height+"px");l.style.height=this.options.height+"px";l.style.cursor="pointer";if(c.DomUtil.isHTML(k.item)){l.style.textAlign="center";var m=c.DomUtil.measureDom("div",k.item);l.innerHTML='<div style="margin-top:'+(this.options.height-m.height)/2+'px;">'+k.item+"</div>"}else l.innerHTML=k.item;if(k.click)c.DomUtil.on(l,
            "click",b(k.click,g,null,l));c.Util.isArrayHasData(k.children)&&(k=this._createDropMenu(g),l.appendChild(k),l._menu=k,c.DomUtil.on(l,"mouseover",function(){this._menu.style.display=""}),c.DomUtil.on(l,"mouseout",function(){this._menu.style.display="none"}));d.appendChild(l)}return a},_createDropMenu:function(a){function b(a,b,e){var f=d._getItems()[b].children[e];return function(d){c.DomUtil.stopPropagation(d);return a({target:f,index:b,childIndex:e})}}var d=this,e=c.DomUtil.createEl("div","maptalks-dropMenu");
        e.style.display="none";e.appendChild(c.DomUtil.createEl("em","maptalks-ico"));var f=c.DomUtil.createEl("ul");e.appendChild(f);var g=this._getItems()[a].children,h=0,k,l;k=0;for(l=g.length;k<l;k++){var m=c.StringUtil.stringLength(g[k].item,"12px");m.width>h&&(h=m.width)}k=0;for(l=g.length;k<l;k++){var m=g[k],n=c.DomUtil.createEl("li");n.innerHTML='<a href="javascript:;">'+m.item+"</a>";n.style.cursor="pointer";n.style.width=h+24+"px";c.DomUtil.on(n.childNodes[0],"click",b(m.click,a,k));f.appendChild(n)}return e},
        _getItems:function(){return this.options.items}});c.control.Overview=c.control.Control.extend({loadDelay:1600,options:{level:4,position:"bottom-right",size:{width:300,height:200},style:{color:"#1bbc9b"}},buildOn:function(a){var b=c.DomUtil.createEl("div");b.style.cssText="border:1px solid #000;width:"+this.options.size.width+"px;height:"+this.options.size.height+"px;";if(a.isLoaded())this._initOverview();else a.on("load",this._initOverview,this);return b},_initOverview:function(){var a=this;setTimeout(function(){a._createOverview()},
        this.loadDelay)},_createOverview:function(a){var b=this.getMap();a=a||this.getDOM();var d=b.getExtent(),e=b.config();c.Util.extend(e,{center:b.getCenter(),zoom:this._getOverviewZoom(),scrollWheelZoom:!1,checkSize:!1,doubleClickZoom:!1,touchZoom:!1,control:!1});this._overview=new c.Map(a,e);this._updateBaseLayer();this._perspective=(new c.Polygon(d.toArray(),{draggable:!0,cursor:"move",symbol:{lineWidth:3,lineColor:this.options.style.color,polygonFill:this.options.style.color,polygonOpacity:.4}})).on("dragstart",
        this._onDragStart,this).on("dragend",this._onDragEnd,this);b.on("resize moveend zoomend",this._update,this).on("setbaselayer",this._updateBaseLayer,this);(new c.VectorLayer("v")).addGeometry(this._perspective).addTo(this._overview);this.fire("load")},onRemove:function(){this.getMap().off("load",this._initOverview,this).off("resize moveend zoomend",this._update,this).off("setbaselayer",this._updateBaseLayer,this)},_getOverviewZoom:function(){var a=this.getMap(),b=a.getZoom(),a=a.getMinZoom(),c=this.options.level;
        if(0<c)for(;0<c;c--){if(b-c>=a)return b-c}else for(;0>c;c++)if(b-c>=a)return b-c;return b},_onDragStart:function(){this._origDraggable=this.getMap().options.draggable;this.getMap().config("draggable",!1)},_onDragEnd:function(){var a=this._perspective.getCenter();this._overview.setCenter(a);this.getMap().panTo(a);this.getMap().config("draggable",this._origDraggable)},_update:function(){this._perspective.setCoordinates(this.getMap().getExtent().toArray());this._overview.setCenterAndZoom(this.getMap().getCenter(),
        this._getOverviewZoom())},_updateBaseLayer:function(){var a=this.getMap();a.getBaseLayer()?this._overview.setBaseLayer(c.Layer.fromJSON(a.getBaseLayer().toJSON())):this._overview.setBaseLayer(null)}});c.Map.mergeOptions({overviewControl:!1});c.Map.addOnLoadHook(function(){this.options.overviewControl&&(this.overviewControl=new c.control.Overview(this.options.overviewControl),this.addControl(this.overviewControl))});"undefined"!==typeof module&&module.exports?module.exports=c:"function"===typeof define&&
        define.amd&&define(c);"undefined"!==typeof window&&A(c)})();